export default(function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:0,exports:{}};e[i].call(r.exports,r,r.exports,n);r.l=1;return r.exports}n.m=e;n.c=t;n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:1,get:i})};n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:1})};n.t=function(e,t){1&t&&(e=n(e));if(8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);n.r(i);Object.defineProperty(i,"default",{enumerable:1,value:e});if(2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i};n.n=function(e){var t=e&&e.__esModule?function t(){return e["default"]}:function t(){return e};n.d(t,"a",t);return t};n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};n.p="";return n(n.s=51)}([function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getSpriteUv=t.SpriteAnimationSystem=t.createSpriteEntity=void 0;const i=n(1),r={time:.5,frames:[],init:1,position:void 0,scale:void 0},o=(e,{position:t=new Vector3(0,0,0),scale:n=new Vector3(1,1,1),uvs:r})=>{const o=new Entity,s=new PlaneShape;s.withCollisions=0;s.isPointerBlocker=0;const a=new Transform({position:t,scale:n});s.uvs=r;o.addComponent(s);o.addComponent(i.spriteMaterial);o.addComponent(a);o.setParent(e);return{show:()=>{s.visible=1},hide:()=>{s.visible=0},getEntity:()=>o,getShape:()=>s,getTransform:()=>a,updateUvs:e=>s.uvs=e}};t.createSpriteEntity=o;class s{constructor(e,t=r){const{scale:n,time:o,position:s,frames:a,init:c}=t;this.globalOptions=Object.assign(Object.assign({},r),t);this.root=e;this.setInitialState();this.sprite=new Entity;this.plane=new PlaneShape;this.sprite.addComponent(i.spriteMaterial);this.sprite.addComponent(this.plane);(s||n)&&this.sprite.addComponent(new Transform({scale:n,position:s}));this.plane.uvs=a[0].uvs;engine.addSystem(this)}setPosition(e){this.sprite.getComponent(Transform).position.set(e.x,e.y,e.z)}getPosition(){return this.sprite.getComponent(Transform).position}setRotation(e){this.sprite.getComponent(Transform).rotation.setEuler(0,0,e)}addComponentOrReplace(e){this.sprite.addComponentOrReplace(e)}addComponent(e){this.sprite.addComponent(e)}removeComponent(e){this.sprite.removeComponent(e)}init(){this.state.initialized=1;this.sprite.setParent(this.root)}nextFrame(){this.state.currentFrame++;this.state.currentFrame>=this.state.playtrack.length-1&&this.state.playing&&!this.state.loop&&(this.state.playing=0);this.state.currentFrame>=this.state.playtrack.length&&(this.state.loop?this.state.currentFrame=0:this.state.currentFrame=this.state.playtrack.length-1);this.plane.uvs=this.globalOptions.frames[this.state.playtrack[this.state.currentFrame]].uvs}update(e){if(this.state.initialized)if(this.state.playing){this.state.dtCount+=e;if(this.state.dtCount>=this.state.time){this.state.dtCount=0;this.nextFrame()}}else this.state.dtCount=0}play(e,t){this.state.playtrack=e;this.state.dtCount=0;this.state.currentFrame=-1;this.state.initialized=1;this.state.playing=1;this.state.end=e.length-1;this.state.time=(null==t?void 0:t.time)||this.globalOptions.time;this.state.loop=(null==t?void 0:t.loop)||0;this.nextFrame()}stop(e=0){this.plane.uvs=this.globalOptions.frames[0].uvs;this.state.playing=0}destroy(){engine.removeSystem(this)}setInitialState(){this.state={initialized:0,playing:0,currentFrame:0,dtCount:0,start:0,end:0,loop:0,time:this.globalOptions.time||.5,playtrack:[0]}}resetState(){this.state=Object.assign(Object.assign({},this.state),{playing:0})}}t.SpriteAnimationSystem=s;const a=(e,t=0,n=64,i=n)=>{let r=1024/n,o=1024/i,s=e+t,a=1/r,c=1/o,u=o-Math.floor((s-1)/r),l=Math.floor((s-1)%r);const h=l*a,d=(l+1)*a,p=(u-1)*c,f=u*c;return[0,0,0,0,0,0,0,0,d,p,h,p,h,f,d,f]};t.getSpriteUv=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.loadTexture=t.spriteMaterial=void 0;t.spriteMaterial=new Material;const i=()=>{const e=(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||"")+"images/sprite3.png",n=new Texture(e,{samplingMode:0,hasAlpha:1});t.spriteMaterial.albedoTexture=n;t.spriteMaterial.alphaTexture=n;t.spriteMaterial.emissiveTexture=n};t.loadTexture=i;void 0;const r=(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||"")+"images/sprite3.png";void 0;t.spriteMaterial.emissiveIntensity=.5;t.spriteMaterial.emissiveColor=new Color3(1,1,1);t.spriteMaterial.transparencyMode=1;t.spriteMaterial.specularIntensity=0;t.spriteMaterial.roughness=1},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.removeSoundsFromEntity=t.addSoundsToEntity=t.stopAllSounds=t.stopSound=t.isMusic=t.playOnce=t.playLoop=t.isPlaying=t.toggleMusic=t.setTotalMute=t.getTotalMute=t.loadSounds=void 0;let i={},r=[];const o=()=>{const e=""+(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||""),t=new AudioClip(e+"sounds/error.mp3"),n=new AudioClip(e+"sounds/music1.mp3"),o=new AudioClip(e+"sounds/music2b.mp3"),s=new AudioClip(e+"sounds/vs.mp3"),a=new AudioClip(e+"sounds/pwned.mp3"),c=new AudioClip(e+"sounds/race.mp3"),u=new AudioClip(e+"sounds/ok.mp3"),l=new AudioClip(e+"sounds/wow.mp3"),h=new AudioClip(e+"sounds/swing.mp3"),d=new AudioClip(e+"sounds/battle.mp3"),p=new AudioClip(e+"sounds/money.mp3"),f=new AudioClip(e+"sounds/jump.mp3"),m=new AudioClip(e+"sounds/readygo.mp3"),g=new AudioClip(e+"sounds/hit.mp3"),y=new AudioSource(t),v=new AudioSource(n),S=new AudioSource(o),b=new AudioSource(s),w=new AudioSource(a),T=new AudioSource(c),C=new AudioSource(u),_=new AudioSource(l),P=new AudioSource(h),E=new AudioSource(d),I=new AudioSource(p),O=new AudioSource(f),R=new AudioSource(m),A=new AudioSource(g);i={fail:y,music2:S,music1:v,vs:b,pwned:w,race:T,ok:C,wow:_,swing:P,battle:E,money:I,jump:O,readygo:R,hit:A};r=[i.music2,i.pwned,i.race,i.battle,i.money,i.music1];r.forEach(e=>{e.volume=.5})};t.loadSounds=o;const s={music:1,fx:1,totalMute:0},a=()=>s.totalMute;t.getTotalMute=a;const c=e=>{s.totalMute=e;e?Object.values(i).forEach(e=>{e.volume=0}):Object.values(i).forEach(e=>{(0,t.isMusic)(e)?e.volume=s.music?.5:0:e.volume=1})};t.setTotalMute=c;const u=()=>{s.music=!s.music;r.forEach(e=>{e.volume=!s.music||s.totalMute?0:.5})};t.toggleMusic=u;const l=e=>i[e].playing;t.isPlaying=l;const h=(e,{volume:t}={volume:void 0})=>{i[e].loop=1;i[e].playing=1;void 0===t||~r.indexOf(i[e])||(i[e].volume=t)};t.playLoop=h;const d=(e,{volume:t}={volume:void 0})=>{i[e].playOnce();void 0===t||~r.indexOf(i[e])||(i[e].volume=t)};t.playOnce=d;const p=e=>~r.indexOf(e);t.isMusic=p;const f=e=>{i[e].playing=0};t.stopSound=f;const m=()=>{Object.values(i).forEach(e=>e.playing=0)};t.stopAllSounds=m;const g=e=>{Object.values(i).forEach(t=>{const n=new Entity;n.setParent(e);n.addComponent(t);t.volume=1})};t.addSoundsToEntity=g;const y=e=>{Object.values(i).forEach(e=>{})};t.removeSoundsFromEntity=y},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.seedGen=void 0;t.seedGen={create:e=>{let t=e;return{random:()=>{t=16807*t%2147483647;return t/2147483647}}}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.sleep=t.createUI=t.createRoundResult=t.createTimeResult=t.createPlayerAnswer=void 0;const i=n(0),r={player1:{correct:1,wrong:3},player2:{correct:2,wrong:4}},o=2068,s=(e,{player:t,size:n=16})=>{const s=new Entity;s.addComponent(new Transform({scale:new Vector3(.5,.5,1),position:new Vector3(1===t?-.3:.3,-10,-.01)}));const a=(0,i.createSpriteEntity)(s,{uvs:(0,i.getSpriteUv)(r["player"+t].correct,o,16,16),position:new Vector3(0,0,-.001)});s.setParent(e);const c=e=>{let n=5;n=e?r["player"+t].correct:r["player"+t].wrong;a.getShape().uvs=(0,i.getSpriteUv)(n,o,16,16)},u=()=>{a.getShape().visible=1},l=()=>{a.getShape().visible=0};return{wrapperEntity:s,sprite:a,setSprite:c,show:u,hide:l}};t.createPlayerAnswer=s;const a=(e,{player:t,position:n=new Vector3(1===t?-2.4:2.4,.1,-.007),fontSize:r=2.5})=>{const o=new Entity,s=new TextShape,a=(0,i.createSpriteEntity)(o,{uvs:(0,i.getSpriteUv)(25,2048,16,16),scale:new Vector3(.25,.25,1),position:new Vector3(1===t?-.25:.25,.125,0)});s.isPointerBlocker=0;s.hTextAlign=1===t?"left":"right";s.vTextAlign="bottom";s.fontSize=r;s.font=new Font(Fonts.SanFrancisco_Heavy);s.shadowOffsetX=2;s.shadowOffsetY=2;s.shadowColor=Color3.FromHexString("#000000");s.withCollisions=0;const c=new Transform({position:n});o.addComponent(c);o.addComponent(s);o.setParent(e);const u=undefined,l=undefined,h=undefined;return{show:()=>{s.visible=1;a.getShape().visible=1},hide:()=>{s.visible=0;s.value="";a.getShape().visible=0},update:e=>{s.value=(Math.floor(1e4*e)/1e4/1e3).toString()},getTransform:()=>c,getEntity:()=>o}};t.createTimeResult=a;const c=(e,{player:t,position:n=new Vector3(1===t?-2:2,3,-.007)})=>{const r=104,o=4/128/2,s=(0,i.createSpriteEntity)(e,{uvs:(0,i.getSpriteUv)(12,r,128,32),scale:new Vector3(128*o,32*o,1),position:n}),a=undefined,c=undefined,u=undefined;return{show:()=>{s.getShape().visible=1},hide:()=>{s.getShape().visible=0},update:e=>{s.getShape().uvs=e?(0,i.getSpriteUv)(12,r,128,32):(0,i.getSpriteUv)(4,r,128,32)},getTransform:()=>s.getTransform(),getEntity:()=>s.getEntity()}};t.createRoundResult=c;const u=(e,{position:n}={position:void 0})=>{const r=(0,t.createTimeResult)(e,{player:1}),o=(0,t.createTimeResult)(e,{player:2});r.hide();o.hide();const s=new TextShape("0"),a=new TextShape("0");s.withCollisions=a.withCollisions=0;s.isPointerBlocker=a.isPointerBlocker=0;s.font=a.font=new Font(Fonts.SanFrancisco_Heavy);s.fontSize=a.fontSize=2.5;s.vTextAlign=a.vTextAlign="bottom";s.hTextAlign="right";a.hTextAlign="left";const c=new Entity,u=new Entity;c.addComponent(s);c.addComponent(new Transform({position:new Vector3(-.5,n?.1+n.y:.1,-.003)}));u.addComponent(a);u.addComponent(new Transform({position:new Vector3(.5,n?.1+n.y:.1,-.003)}));c.setParent(e);u.setParent(e);const l=(0,i.createSpriteEntity)(e,{position:new Vector3(0,n?.5+n.y:.5,-.001),scale:new Vector3(6,1,1),uvs:(0,i.getSpriteUv)(2,64,192,32)}),h=undefined,d=undefined,p=undefined,f=undefined,m=undefined,g=undefined,y=undefined;return{updateTime:({player:e,time:t})=>{if(1===e){r.update(t);r.show()}else{o.update(t);o.show()}},updateScore:({player:e,score:t})=>{"undefined"!=typeof t&&(1===e?s.value=t.toString():a.value=t.toString())},hideTime:()=>{r.hide();o.hide()},showTime:()=>{},hideScore:()=>{s.value=a.value=""},show:()=>{l.getShape().visible=1},hide:()=>{l.getShape().visible=0}}};t.createUI=u;function l(e){return new Promise(t=>setTimeout(t,e))}t.sleep=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.showSpritePanel=t.hideSpritePanel=t.updateSpritePanel=t.createSpritePanel=void 0;const i=n(0),r=n(1),o=new PlaneShape;o.withCollisions=0;o.isPointerBlocker=0;const s=new Transform({position:new Vector3(0,2,-.001),scale:new Vector3(6,4,1)}),a=e=>{const t=new Entity;t.addComponent(o);t.addComponent(r.spriteMaterial);t.addComponent(s);t.setParent(e)};t.createSpritePanel=a;const c=({uvs:e=null,width:t=null,height:n=null,col:r=null,row:a=null,canvasWidth:c=null,scale:u=null})=>{o.uvs=e||(0,i.getSpriteUv)(1024/t*a+r,0,t,n);c&&s.scale.set(c,s.scale.y,s.scale.z);u?s.scale.set(u.x,u.y,u.z):s.scale.set(6,4,1)};t.updateSpritePanel=c;const u=()=>{o.visible=0;s.scale.set(6,4,1)};t.hideSpritePanel=u;const l=()=>{o.visible=1};t.showSpritePanel=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getTextPanelValue=t.updateTextPanel=t.createTextPanel=void 0;let i=null;const r=new Transform({position:new Vector3(0,4,-.01)}),o=(e,t)=>{const n=new Entity;i=new TextShape;i.value=t;i.vTextAlign="top";i.fontSize=3;i.font=new Font(Fonts.SanFrancisco_Heavy);i.shadowOffsetX=2;i.shadowOffsetY=2;i.shadowColor=Color3.FromHexString("#000000");n.addComponent(r);n.addComponent(i);n.setParent(e)};t.createTextPanel=o;const s=e=>{if(e.bottom){i.vTextAlign="bottom";r.position.set(r.position.x,0,r.position.z)}else{i.vTextAlign="top";r.position.set(r.position.x,4,r.position.z)}if("left"===e.hTextAlign){i.hTextAlign="left";r.position.set(-3,r.position.y,r.position.z)}else{i.hTextAlign="center";r.position.set(0,r.position.y,r.position.z)}i.color=e.color||Color3.White();Object.assign(i,{hTextAlign:"center"},e,{value:""+e.value})};t.updateTextPanel=s;const a=()=>i.value;t.getTextPanelValue=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.OPERATION=t.TYPE_ID=t.SWITCH_TO_STRUCTURE=void 0;t.SWITCH_TO_STRUCTURE=255;t.TYPE_ID=213;var i;(function(e){e[e["ADD"]=128]="ADD";e[e["REPLACE"]=0]="REPLACE";e[e["DELETE"]=64]="DELETE";e[e["DELETE_AND_ADD"]=192]="DELETE_AND_ADD";e[e["TOUCH"]=1]="TOUCH";e[e["CLEAR"]=10]="CLEAR"})(i=t.OPERATION||(t.OPERATION={}))},function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i=n.call(e),r,o=[],s;try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(s)throw s.error}}return o};Object.defineProperty(t,"__esModule",{value:1});t.Schema=void 0;var o=n(7),s=n(22),a=n(46),c=n(47),u=n(14),l=n(23),h=n(49),d=n(50),p=n(12),f=n(98),m=n(99),g=n(15),y=function(e){i(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(Error);function v(e,t,n,i){var r,o=0;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":r="number";isNaN(e),0;break;case"string":r="string";o=1;break;case"boolean":return}if(typeof e!==r&&(!o||o&&null!==e)){var s="'"+JSON.stringify(e)+"'"+(e&&e.constructor&&" ("+e.constructor.name+")"||"");throw new y("a '"+r+"' was expected, but "+s+" was provided in "+n.constructor.name+"#"+i)}}function S(e,t,n,i){if(!(e instanceof t))throw new y("a '"+t.name+"' was expected, but '"+e.constructor.name+"' was provided in "+n.constructor.name+"#"+i)}function b(e,t,n,i,r){v(n,e,i,r);var o=a[e];if(!o)throw new y("a '"+e+"' was expected, but "+n+" was provided in "+i.constructor.name+"#"+r);o(t,n)}function w(e,t,n){return c[e](t,n)}var T=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new p.ChangeTree(this,void 0,new p.Root),enumerable:0,writable:1},$listeners:{value:{},enumerable:0,writable:1}});var n=this._definition.descriptors;n&&Object.defineProperties(this,n);e[0]&&this.assign(e[0])}e.onError=function(e){void 0};e.is=function(e){return e["_definition"]&&void 0!==e["_definition"].schema};e.prototype.assign=function(e){Object.assign(this,e);return this};Object.defineProperty(e.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:0,configurable:1});e.prototype.listen=function(e,t){var n=this;this.$listeners[e]||(this.$listeners[e]=new f.EventEmitter);this.$listeners[e].register(t);return function(){return n.$listeners[e].remove(t)}};e.prototype.decode=function(t,n,i,s){void 0===n&&(n={offset:0});void 0===i&&(i=this);void 0===s&&(s=new Map);var a=this.$changes.root,p=t.length,f=0,m=[];a.refs.set(f,this);s.set(f,m);for(;n.offset<p;){var y=t[n.offset++];if(y!=o.SWITCH_TO_STRUCTURE){var v=i["$changes"],S=void 0!==i["_definition"],b=S?y>>6<<6:y;if(b!==o.OPERATION.CLEAR){var T=S?y%(b||255):c.number(t,n),C=S?i["_definition"].fieldsByIndex[T]:"",_=v.getType(T),P=void 0,E=void 0,I=void 0;if(S)E=i["_"+C];else{E=i["getByIndex"](T);if((b&o.OPERATION.ADD)===o.OPERATION.ADD){I=i instanceof l.MapSchema?c.string(t,n):T;i["setIndex"](T,I)}else I=i["getIndex"](T)}if((b&o.OPERATION.DELETE)===o.OPERATION.DELETE){b!==o.OPERATION.DELETE_AND_ADD&&i["deleteByIndex"](T);E&&E["$changes"]&&a.removeRef(E["$changes"].refId);P=null}if(void 0!==C){if(b===o.OPERATION.DELETE);else if(e.is(_)){var O=c.number(t,n);P=a.refs.get(O);if(b!==o.OPERATION.REPLACE){var R=this.getSchemaType(t,n,_);if(!P){(P=this.createTypeInstance(R)).$changes.refId=O;if(E){P.onChange=E.onChange;P.onRemove=E.onRemove;P.$listeners=E.$listeners;E["$changes"].refId&&O!==E["$changes"].refId&&a.removeRef(E["$changes"].refId)}}a.addRef(O,P,P!==E)}}else if("string"==typeof _)P=w(_,t,n);else{var A=g.getType(Object.keys(_)[0]),x=c.number(t,n),k=a.refs.has(x)?E:new A.constructor;(P=k.clone(1)).$changes.refId=x;if(E){P.onAdd=E.onAdd;P.onRemove=E.onRemove;P.onChange=E.onChange;if(E["$changes"].refId&&x!==E["$changes"].refId){a.removeRef(E["$changes"].refId);for(var M=[],N=E.entries(),D=void 0;(D=N.next())&&!D.done;){var F=r(D.value,2),U=F[0],$=F[1];M.push({op:o.OPERATION.DELETE,field:U,value:void 0,previousValue:$})}s.set(E["$changes"].refId,M)}}a.addRef(x,P,k!==E);A.getProxy&&(P=A.getProxy(P))}var j=E!==P;if(null!=P){P["$changes"]&&P["$changes"].setParent(v.ref,v.root,T);if(i instanceof e)i[C]=P;else if(i instanceof l.MapSchema){var U=I;i["$items"].set(U,P)}else if(i instanceof u.ArraySchema)i.setAt(T,P);else if(i instanceof h.CollectionSchema||i instanceof d.SetSchema){var B=i.add(P);i["setIndex"](T,B)}}j&&m.push({op:b,field:C,dynamicIndex:I,value:P,previousValue:E})}else{void 0;for(var V={offset:n.offset};n.offset<p;){if(c.switchStructureCheck(t,n)){V.offset=n.offset+1;if(a.refs.has(c.number(t,V)))break}n.offset++}}}else i.clear(1)}else{f=c.number(t,n);var z=a.refs.get(f);if(!z)throw new Error('"refId" not found: '+f);i=z;m=[];s.set(f,m)}}this._triggerChanges(s);a.garbageCollectDeletedRefs();return s};e.prototype.encode=function(t,n,i){void 0===t&&(t=0);void 0===n&&(n=[]);void 0===i&&(i=0);for(var r=this.$changes,s=new WeakSet,c=[r],u=1,h=0;h<u;h++){var d=c[h],p=d.ref,f=p instanceof e;d.ensureRefId();s.add(d);if(d!==r&&(d.changed||t)){a.uint8(n,o.SWITCH_TO_STRUCTURE);a.number(n,d.refId)}for(var m=t?Array.from(d.allChanges):Array.from(d.changes.values()),y=0,v=m.length;y<v;y++){var w=t?{op:o.OPERATION.ADD,index:m[y]}:m[y],T=w.index,C=f?p["_definition"].fieldsByIndex&&p["_definition"].fieldsByIndex[T]:T,_=n.length;if(w.op!==o.OPERATION.TOUCH)if(f)a.uint8(n,T|w.op);else{a.uint8(n,w.op);if(w.op===o.OPERATION.CLEAR)continue;a.number(n,T)}if(!f&&(w.op&o.OPERATION.ADD)==o.OPERATION.ADD&&p instanceof l.MapSchema){var P=d.ref["$indexes"].get(T);a.string(n,P)}if(w.op!==o.OPERATION.DELETE){var E=d.getType(T),I=d.getValue(T);if(I&&I["$changes"]&&!s.has(I["$changes"])){c.push(I["$changes"]);I["$changes"].ensureRefId();u++}if(w.op!==o.OPERATION.TOUCH){if(e.is(E)){S(I,E,p,C);a.number(n,I.$changes.refId);(w.op&o.OPERATION.ADD)===o.OPERATION.ADD&&this.tryEncodeTypeId(n,E,I.constructor)}else if("string"==typeof E)b(E,n,I,p,C);else{var O=g.getType(Object.keys(E)[0]);S(p["_"+C],O.constructor,p,C);a.number(n,I.$changes.refId)}i&&d.cache(T,n.slice(_))}}}t||i||d.discard()}return n};e.prototype.encodeAll=function(e){return this.encode(1,[],e)};e.prototype.applyFilters=function(t,n){void 0===n&&(n=0);for(var i=this,r=new Set,s=m.ClientState.get(t),c=[this.$changes],u=1,h=[],d=function(d){var p=c[d];if(r.has(p.refId))return"continue";var f=p.ref,m=f instanceof e;a.uint8(h,o.SWITCH_TO_STRUCTURE);a.number(h,p.refId);var g=s.refIds.has(p),y=n||!g;s.addRefId(p);var v=s.containerIndexes.get(p),S=y?Array.from(p.allChanges):Array.from(p.changes.values());if(!n&&m&&f._definition.indexesWithFilters){var b;f._definition.indexesWithFilters.forEach((function(e){!v.has(e)&&p.allChanges.has(e)&&(y?S.push(e):S.push({op:o.OPERATION.ADD,index:e}))}))}for(var w=0,T=S.length;w<T;w++){var C=y?{op:o.OPERATION.ADD,index:S[w]}:S[w];if(C.op!==o.OPERATION.CLEAR){var _=C.index;if(C.op!==o.OPERATION.DELETE){var P=p.getValue(_),E=p.getType(_);if(m){var I;if((I=f._definition.filters&&f._definition.filters[_])&&!I.call(f,t,P,i)){P&&P["$changes"]&&r.add(P["$changes"].refId);continue}}else{var O=p.parent,I;if((I=p.getChildrenFilter())&&!I.call(O,t,f["$indexes"].get(_),P,i)){P&&P["$changes"]&&r.add(P["$changes"].refId);continue}}if(P["$changes"]){c.push(P["$changes"]);u++}if(C.op!==o.OPERATION.TOUCH)if(C.op===o.OPERATION.ADD||m){h=h.concat(p.caches[_]);v.add(_)}else if(v.has(_))h=h.concat(p.caches[_]);else{v.add(_);a.uint8(h,o.OPERATION.ADD);a.number(h,_);if(f instanceof l.MapSchema){var R=p.ref["$indexes"].get(_);a.string(h,R)}P["$changes"]?a.number(h,P["$changes"].refId):a[E](h,P)}else if(P["$changes"]&&!m){a.uint8(h,o.OPERATION.ADD);a.number(h,_);if(f instanceof l.MapSchema){var R=p.ref["$indexes"].get(_);a.string(h,R)}a.number(h,P["$changes"].refId)}}else if(m)a.uint8(h,C.op|_);else{a.uint8(h,C.op);a.number(h,_)}}else a.uint8(h,C.op)}},p=0;p<u;p++)d(p);return h};e.prototype.clone=function(){var e=new this.constructor,t=this._definition.schema;for(var n in t)"object"==typeof this[n]&&"function"==typeof this[n].clone?e[n]=this[n].clone():e[n]=this[n];return e};e.prototype.triggerAll=function(){if(0!==this.$changes.root.refs.size){var t=new Map;e.prototype._triggerAllFillChanges.call(this,this,t);try{e.prototype._triggerChanges.call(this,t)}catch(t){e.onError(t)}}};e.prototype.toJSON=function(){var e=this._definition.schema,t=this._definition.deprecated,n={};for(var i in e)t[i]||null===this[i]||"undefined"==typeof this[i]||(n[i]="function"==typeof this[i]["toJSON"]?this[i]["toJSON"]():this["_"+i]);return n};e.prototype.discardAllChanges=function(){this.$changes.discardAll()};e.prototype.getByIndex=function(e){return this[this._definition.fieldsByIndex[e]]};e.prototype.deleteByIndex=function(e){this[this._definition.fieldsByIndex[e]]=void 0};e.prototype.tryEncodeTypeId=function(e,t,n){if(t._typeid!==n._typeid){a.uint8(e,o.TYPE_ID);a.number(e,n._typeid)}};e.prototype.getSchemaType=function(e,t,n){var i;if(e[t.offset]===o.TYPE_ID){t.offset++;i=this.constructor._context.get(c.number(e,t))}return i||n};e.prototype.createTypeInstance=function(e){var t=new e;t.$changes.root=this.$changes.root;return t};e.prototype._triggerAllFillChanges=function(t,n){if(!n.has(t["$changes"].refId)){var i=[];n.set(t["$changes"].refId||0,i);if(t instanceof e){var s=t._definition.schema;for(var a in s){var c,u;if(void 0!==(u=t["_"+a])){i.push({op:o.OPERATION.ADD,field:a,value:u,previousValue:void 0});void 0!==u["$changes"]&&e.prototype._triggerAllFillChanges.call(this,u,n)}}}else for(var l=t.entries(),h=void 0;(h=l.next())&&!h.done;){var d=r(h.value,2),p=d[0],u=d[1];i.push({op:o.OPERATION.ADD,field:p,dynamicIndex:p,value:u,previousValue:void 0});void 0!==u["$changes"]&&e.prototype._triggerAllFillChanges.call(this,u,n)}}};e.prototype._triggerChanges=function(t){var n=this;t.forEach((function(t,i){var r,s,a,c,u,l,h,d,p,f,m,g;if(t.length>0){for(var y=n.$changes.root.refs.get(i),v=y instanceof e,S=0;S<t.length;S++){var b=t[S],w=y["$listeners"]&&y["$listeners"][b.field];if(!v)if(b.op===o.OPERATION.ADD&&void 0===b.previousValue)null===(s=(r=y).onAdd)||void 0===s?void 0:s.call(r,b.value,null!==(a=b.dynamicIndex)&&void 0!==a?a:b.field);else if(b.op===o.OPERATION.DELETE)void 0!==b.previousValue&&(null===(u=(c=y).onRemove)||void 0===u?void 0:u.call(c,b.previousValue,null!==(l=b.dynamicIndex)&&void 0!==l?l:b.field));else if(b.op===o.OPERATION.DELETE_AND_ADD){void 0!==b.previousValue&&(null===(d=(h=y).onRemove)||void 0===d?void 0:d.call(h,b.previousValue,b.dynamicIndex));null===(f=(p=y).onAdd)||void 0===f?void 0:f.call(p,b.value,b.dynamicIndex)}else b.op!==o.OPERATION.REPLACE&&b.value===b.previousValue||(null===(g=(m=y).onChange)||void 0===g?void 0:g.call(m,b.value,b.dynamicIndex));(b.op&o.OPERATION.DELETE)===o.OPERATION.DELETE&&b.previousValue instanceof e&&b.previousValue.onRemove&&b.previousValue.onRemove();if(w)try{w.invoke(b.value,b.previousValue)}catch(t){e.onError(t)}}if(v&&y.onChange)try{y.onChange(t)}catch(t){e.onError(t)}}}))};e._definition=s.SchemaDefinition.create();return e}();t.Schema=T},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.TransformSystem=void 0;const i=n(19),r=n(27),o=n(28),s=n(29),a=n(30);class c{static createAndAddToEngine(){if(null==this._instance){this._instance=new c;engine.addSystem(this._instance)}return this._instance}static registerCustomComponent(e){this.createAndAddToEngine()._components.push(e)}constructor(){this._components=[];c._instance=this;this._components.push(i.MoveTransformComponent);this._components.push(r.RotateTransformComponent);this._components.push(o.ScaleTransformComponent);this._components.push(s.FollowPathComponent);this._components.push(a.KeepRotatingComponent)}update(e){this._components.forEach(t=>{this.updateComponent(e,t)})}updateComponent(e,t){const n=undefined;engine.getComponentGroup(t,Transform).entities.forEach(n=>{const i=n.getComponent(Transform),r=n.getComponent(t);r.update(e);r.assignValueToTransform(i);if(r.hasFinished()){n.removeComponent(r);null!=r.onFinishCallback&&r.onFinishCallback()}})}}t.TransformSystem=c;c._instance=null},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getTimeSinceStart=void 0;const i=e=>Date.now()-e;t.getTimeSinceStart=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.PART_TYPE_OFFSET_Y=t.PART_OFFSET_INDEX=t.PART_SIZE_HEIGHT=t.PART_SIZE_WIDTH=void 0;t.PART_SIZE_WIDTH={shirt:64,pants:64,hair:64,glasses:64};t.PART_SIZE_HEIGHT={shirt:64,pants:64,hair:64,glasses:64};t.PART_OFFSET_INDEX={shirt:64,pants:80,hair:224,glasses:208};t.PART_TYPE_OFFSET_Y={shirt:-.2,pants:.2,hair:0,glasses:0}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.ChangeTree=t.Root=void 0;var i=n(7),r=n(8),o=function(){function e(){this.refs=new Map;this.refCounts={};this.deletedRefs=new Set;this.nextUniqueId=0}e.prototype.getNextUniqueId=function(){return this.nextUniqueId++};e.prototype.addRef=function(e,t,n){void 0===n&&(n=1);this.refs.set(e,t);n&&(this.refCounts[e]=(this.refCounts[e]||0)+1)};e.prototype.removeRef=function(e){this.refCounts[e]=this.refCounts[e]-1;this.deletedRefs.add(e)};e.prototype.clearRefs=function(){this.refs.clear();this.deletedRefs.clear();this.refCounts={}};e.prototype.garbageCollectDeletedRefs=function(){var e=this;this.deletedRefs.forEach((function(t){if(e.refCounts[t]<=0){var n=e.refs.get(t);if(n instanceof r.Schema)for(var i in n["_definition"].schema)"string"!=typeof n["_definition"].schema[i]&&n[i]&&n[i]["$changes"]&&e.removeRef(n[i]["$changes"].refId);else{var o=n["$changes"].parent._definition,s=o.schema[o.fieldsByIndex[n["$changes"].parentIndex]];"function"==typeof Object.values(s)[0]&&Array.from(n.values()).forEach((function(t){return e.removeRef(t["$changes"].refId)}))}e.refs.delete(t);delete e.refCounts[t]}}));this.deletedRefs.clear()};return e}();t.Root=o;var s=function(){function e(e,t,n){this.changed=0;this.changes=new Map;this.allChanges=new Set;this.caches={};this.currentCustomOperation=0;this.ref=e;this.setParent(t,n)}e.prototype.setParent=function(e,t,n){var i=this;this.indexes||(this.indexes=this.ref instanceof r.Schema?this.ref["_definition"].indexes:{});this.parent=e;this.parentIndex=n;if(t){this.root=t;if(this.ref instanceof r.Schema){var o=this.ref["_definition"];for(var s in o.schema){var a=this.ref[s];if(a&&a["$changes"]){var c=o.indexes[s];a["$changes"].setParent(this.ref,t,c)}}}else"object"==typeof this.ref&&this.ref.forEach((function(e,t){if(e instanceof r.Schema){var n=e["$changes"],o=i.ref["$changes"].indexes[t];n.setParent(i.ref,i.root,o)}}))}};e.prototype.operation=function(e){this.changes.set(--this.currentCustomOperation,e)};e.prototype.change=function(e,t){void 0===t&&(t=i.OPERATION.ADD);var n="number"==typeof e?e:this.indexes[e];this.assertValidIndex(n,e);var r=this.changes.get(n);r&&r.op!==i.OPERATION.DELETE&&r.op!==i.OPERATION.TOUCH||this.changes.set(n,{op:r&&r.op===i.OPERATION.DELETE?i.OPERATION.DELETE_AND_ADD:t,index:n});this.allChanges.add(n);this.changed=1;this.touchParents()};e.prototype.touch=function(e){var t="number"==typeof e?e:this.indexes[e];this.assertValidIndex(t,e);this.changes.has(t)||this.changes.set(t,{op:i.OPERATION.TOUCH,index:t});this.allChanges.add(t);this.touchParents()};e.prototype.touchParents=function(){this.parent&&this.parent["$changes"].touch(this.parentIndex)};e.prototype.getType=function(e){if(this.ref["_definition"]){var t;return(t=this.ref["_definition"]).schema[t.fieldsByIndex[e]]}var t,n=(t=this.parent["_definition"]).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(n)[0]};e.prototype.getChildrenFilter=function(){var e=this.parent["_definition"].childFilters;return e&&e[this.parentIndex]};e.prototype.getValue=function(e){return this.ref["getByIndex"](e)};e.prototype.delete=function(e){var t="number"==typeof e?e:this.indexes[e];if(void 0!==t){var n=this.getValue(t);this.changes.set(t,{op:i.OPERATION.DELETE,index:t});this.allChanges.delete(t);delete this.caches[t];n&&n["$changes"]&&(n["$changes"].parent=void 0);this.changed=1;this.touchParents()}else void 0};e.prototype.discard=function(e,t){var n=this;void 0===e&&(e=0);void 0===t&&(t=0);this.ref instanceof r.Schema||this.changes.forEach((function(e){if(e.op===i.OPERATION.DELETE){var t=n.ref["getIndex"](e.index);delete n.indexes[t]}}));this.changes.clear();this.changed=e;t&&this.allChanges.clear();this.currentCustomOperation=0};e.prototype.discardAll=function(){var e=this;this.changes.forEach((function(t){var n=e.getValue(t.index);n&&n["$changes"]&&n["$changes"].discardAll()}));this.discard()};e.prototype.cache=function(e,t){this.caches[e]=t};e.prototype.clone=function(){return new e(this.ref,this.parent,this.root)};e.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())};e.prototype.assertValidIndex=function(e,t){if(void 0===e)throw new Error('ChangeTree: missing index for field "'+t+'"')};return e}();t.ChangeTree=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.Interpolate=t.InterpolationType=void 0;var i;(function(e){e[e["LINEAR"]=0]="LINEAR";e[e["EASEINQUAD"]=1]="EASEINQUAD";e[e["EASEOUTQUAD"]=2]="EASEOUTQUAD";e[e["EASEQUAD"]=3]="EASEQUAD"})(i=t.InterpolationType||(t.InterpolationType={}));function r(e,t){switch(e){case i.LINEAR:return o(t);case i.EASEINQUAD:return s(t);case i.EASEOUTQUAD:return a(t);case i.EASEQUAD:return c(t);default:return o(t)}}t.Interpolate=r;function o(e){return e}function s(e){return e*e}function a(e){return e*(2-e)}function c(e){return e*e/(2*(e*e-e)+1)}},function(e,t,n){var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i=n.call(e),r,o=[],s;try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(s)throw s.error}}return o},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:1});t.ArraySchema=t.getArrayProxy=void 0;var o=n(12),s=n(7),a=n(8),c=function(e,t){var n=e.toString(),i=t.toString();return n<i?-1:n>i?1:0};function u(e){e["$proxy"]=1;return e=new Proxy(e,{get:function(e,t){return"symbol"==typeof t||isNaN(t)?e[t]:e.at(t)},set:function(e,t,n){if("symbol"==typeof t||isNaN(t))e[t]=n;else{var i=Array.from(e["$items"].keys()),r=parseInt(i[t]||t);null==n?e.deleteAt(r):e.setAt(r,n)}return 1},deleteProperty:function(e,t){"number"==typeof t?e.deleteAt(t):delete e[t];return 1}})}t.getArrayProxy=u;var l=function(){function e(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.$changes=new o.ChangeTree(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;this.push.apply(this,r(e))}e.is=function(e){return Array.isArray(e)};Object.defineProperty(e.prototype,"length",{get:function(){return this.$items.size},set:function(e){0===e?this.clear():this.splice(e,this.length-e)},enumerable:0,configurable:1});e.prototype.push=function(){for(var e=this,t=[],n=0,i;n<arguments.length;n++)t[n]=arguments[n];t.forEach((function(t){i=e.$refId++;e.setAt(i,t)}));return i};e.prototype.pop=function(){var e=Array.from(this.$indexes.values()).pop();if(void 0!==e){this.$changes.delete(e);this.$indexes.delete(e);var t=this.$items.get(e);this.$items.delete(e);return t}};e.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)};e.prototype.setAt=function(e,t){var n,i;void 0!==t["$changes"]&&t["$changes"].setParent(this,this.$changes.root,e);var r=null!==(i=null===(n=this.$changes.indexes[e])||void 0===n?void 0:n.op)&&void 0!==i?i:s.OPERATION.ADD;this.$changes.indexes[e]=e;this.$indexes.set(e,e);this.$items.set(e,t);this.$changes.change(e,r)};e.prototype.deleteAt=function(e){var t=Array.from(this.$items.keys())[e];return void 0===t?0:this.$deleteAt(t)};e.prototype.$deleteAt=function(e){this.$changes.delete(e);this.$indexes.delete(e);return this.$items.delete(e)};e.prototype.clear=function(e){var t=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){t.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:s.OPERATION.CLEAR});this.$changes.touchParents()};e.prototype.concat=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return new(e.bind.apply(e,r([void 0],(t=Array.from(this.$items.values())).concat.apply(t,r(n)))))};e.prototype.join=function(e){return Array.from(this.$items.values()).join(e)};e.prototype.reverse=function(){var e=this,t=Array.from(this.$items.keys()),n;Array.from(this.$items.values()).reverse().forEach((function(n,i){e.setAt(t[i],n)}));return this};e.prototype.shift=function(){var e,t=Array.from(this.$items.keys()).shift();if(void 0!==t){var n=this.$items.get(t);this.$deleteAt(t);return n}};e.prototype.slice=function(t,n){return new(e.bind.apply(e,r([void 0],Array.from(this.$items.values()).slice(t,n))))};e.prototype.sort=function(e){var t=this;void 0===e&&(e=c);var n=Array.from(this.$items.keys()),i;Array.from(this.$items.values()).sort(e).forEach((function(e,i){t.setAt(n[i],e)}));return this};e.prototype.splice=function(e,t){void 0===t&&(t=this.length-e);for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];for(var r=Array.from(this.$items.keys()),o=[],s=e;s<e+t;s++){o.push(this.$items.get(r[s]));this.$deleteAt(r[s])}return o};e.prototype.unshift=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=this.length,r=t.length,o=Array.from(this.$items.values());t.forEach((function(t,n){e.setAt(n,t)}));o.forEach((function(t,n){e.setAt(r+n,t)}));return i+r};e.prototype.indexOf=function(e,t){return Array.from(this.$items.values()).indexOf(e,t)};e.prototype.lastIndexOf=function(e,t){void 0===t&&(t=this.length-1);return Array.from(this.$items.values()).lastIndexOf(e,t)};e.prototype.every=function(e,t){return Array.from(this.$items.values()).every(e,t)};e.prototype.some=function(e,t){return Array.from(this.$items.values()).some(e,t)};e.prototype.forEach=function(e,t){Array.from(this.$items.values()).forEach(e,t)};e.prototype.map=function(e,t){return Array.from(this.$items.values()).map(e,t)};e.prototype.filter=function(e,t){return Array.from(this.$items.values()).filter(e,t)};e.prototype.reduce=function(e,t){return Array.from(this.$items.values()).reduce(e,t)};e.prototype.reduceRight=function(e,t){return Array.from(this.$items.values()).reduceRight(e,t)};e.prototype.find=function(e,t){return Array.from(this.$items.values()).find(e,t)};e.prototype.findIndex=function(e,t){return Array.from(this.$items.values()).findIndex(e,t)};e.prototype.fill=function(e,t,n){throw new Error("ArraySchema#fill() not implemented")};e.prototype.copyWithin=function(e,t,n){throw new Error("ArraySchema#copyWithin() not implemented")};e.prototype.toString=function(){return this.$items.toString()};e.prototype.toLocaleString=function(){return this.$items.toLocaleString()};e.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()};e.prototype[Symbol.unscopables]=function(){return this.$items[Symbol.unscopables]()};e.prototype.entries=function(){return this.$items.entries()};e.prototype.keys=function(){return this.$items.keys()};e.prototype.values=function(){return this.$items.values()};e.prototype.includes=function(e,t){return Array.from(this.$items.values()).includes(e,t)};e.prototype.flatMap=function(e,t){throw new Error("ArraySchema#flatMap() is not supported.")};e.prototype.flat=function(e){throw new Error("ArraySchema#flat() is not supported.")};e.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};e.prototype.getIndex=function(e){return this.$indexes.get(e)};e.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};e.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};e.prototype.toArray=function(){return Array.from(this.$items.values())};e.prototype.toJSON=function(){return this.toArray().map((function(e){return"function"==typeof e["toJSON"]?e["toJSON"]():e}))};e.prototype.clone=function(t){var n;return n=t?new(e.bind.apply(e,r([void 0],Array.from(this.$items.values())))):new(e.bind.apply(e,r([void 0],this.map((function(e){return e["$changes"]?e.clone():e})))))};e.prototype.triggerAll=function(){a.Schema.prototype.triggerAll.apply(this)};return e}();t.ArraySchema=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getType=t.registerType=void 0;var i={};function r(e,t){i[e]=t}t.registerType=r;function o(e){return i[e]}t.getType=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.HTTP_HOST=t.WS_HOST=void 0;t.WS_HOST="ws://localhost:8080";t.HTTP_HOST="http://localhost:8080"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getHostData=t.setHostData=void 0;let i=null;const r=e=>{i=e};t.setHostData=r;const o=()=>i;t.getHostData=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.removeVideoPanel=t.reproduceVideo=void 0;const i=new Transform({position:new Vector3(0,1.975,-.001),scale:new Vector3(-5.95,3.95,1)}),r=new Entity;r.addComponent(i);const o=(e,t)=>{const n=~t.indexOf("http"),i=""+(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||""),o=new VideoClip(n?t:`${i}video/${t}.mp4`),s=new VideoTexture(o),a=new Material;a.transparencyMode=1;a.specularIntensity=1;a.roughness=1;a.albedoTexture=s;const c=new PlaneShape;c.withCollisions=c.isPointerBlocker=0;r.addComponentOrReplace(c);r.addComponentOrReplace(a);r.setParent(e);s.playing=1;s.loop=1};t.reproduceVideo=o;const s=()=>{r.setParent(null);engine.removeEntity(r)};t.removeVideoPanel=s},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.MoveTransformComponent=void 0;const r=n(9),o=n(13);let s=class e{constructor(e,t,n,i,s=o.InterpolationType.LINEAR){this.start=e;this.end=t;this.normalizedTime=0;this.lerpTime=0;this.onFinishCallback=i;this.interpolationType=s;if(0!=n)this.speed=1/n;else{this.speed=0;this.normalizedTime=1;this.lerpTime=1}r.TransformSystem.createAndAddToEngine()}update(e){this.normalizedTime=Scalar.Clamp(this.normalizedTime+e*this.speed,0,1);this.lerpTime=(0,o.Interpolate)(this.interpolationType,this.normalizedTime)}hasFinished(){return this.normalizedTime>=1}assignValueToTransform(e){e.position=Vector3.Lerp(this.start,this.end,this.lerpTime)}};s=i([Component("moveTransformComponent")],s);t.MoveTransformComponent=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.TimerSystem=void 0;const i=n(32),r=n(31),o=n(33);class s{static createAndAddToEngine(){if(null==this._instance){this._instance=new s;engine.addSystem(this._instance)}return this._instance}static registerCustomComponent(e){this.createAndAddToEngine()._components.push(e)}constructor(){this._components=[];s._instance=this;this._components.push(i.Interval);this._components.push(r.Delay);this._components.push(o.ExpireIn)}update(e){this._components.forEach(t=>{this.updateComponent(e,t)})}updateComponent(e,t){let n=engine.getEntitiesWithComponent(t);for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],o=r.getComponent(t);o.elapsedTime+=e;o.elapsedTime>=o.targetTime&&o.onTargetTimeReached(r)}}}t.TimerSystem=s;s._instance=null},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.BaseGame=t.GameScene=void 0;let r=class e{};r=i([Component("game_scene")],r);t.GameScene=r;class o{constructor(){this.entity={};this.callbacks={onFinish:null,onShareState:null};const e=engine.getEntitiesWithComponent("game_scene");void 0;Object.keys(e).forEach(t=>{engine.removeEntity(e[t])})}init(){}destroy(){}block(){}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onShareState(){}shareState(e){}update(e){}}t.BaseGame=o},function(e,t,n){var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i=n.call(e),r,o=[],s;try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(s)throw s.error}}return o},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:1});t.defineTypes=t.deprecated=t.filterChildren=t.filter=t.type=t.globalContext=t.Context=t.hasFilter=t.SchemaDefinition=void 0;var o=n(8),s=n(14),a=n(23),c=n(15),u=function(){function e(){this.indexes={};this.fieldsByIndex={};this.deprecated={};this.descriptors={}}e.create=function(t){var n=new e;n.schema=Object.assign({},t&&t.schema||{});n.indexes=Object.assign({},t&&t.indexes||{});n.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{});n.descriptors=Object.assign({},t&&t.descriptors||{});n.deprecated=Object.assign({},t&&t.deprecated||{});return n};e.prototype.addField=function(e,t){var n=this.getNextFieldIndex();this.fieldsByIndex[n]=e;this.indexes[e]=n;this.schema[e]=Array.isArray(t)?{array:t[0]}:t};e.prototype.addFilter=function(e,t){if(!this.filters){this.filters={};this.indexesWithFilters=[]}this.filters[this.indexes[e]]=t;this.indexesWithFilters.push(this.indexes[e]);return 1};e.prototype.addChildrenFilter=function(e,t){var n=this.indexes[e],i=this.schema[e];if(c.getType(Object.keys(i)[0])){this.childFilters||(this.childFilters={});this.childFilters[n]=t;return 1}void 0};e.prototype.getChildrenFilter=function(e){return this.childFilters&&this.childFilters[this.indexes[e]]};e.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length};return e}();t.SchemaDefinition=u;function l(e){return e._context&&e._context.useFilters}t.hasFilter=l;var h=function(){function e(){this.types={};this.schemas=new Map;this.useFilters=0}e.prototype.has=function(e){return this.schemas.has(e)};e.prototype.get=function(e){return this.types[e]};e.prototype.add=function(e,t){void 0===t&&(t=this.schemas.size);e._definition=u.create(e._definition);e._typeid=t;this.types[t]=e;this.schemas.set(e,t)};e.create=function(t){void 0===t&&(t=new e);return function(e){return d(e,t)}};return e}();t.Context=h;t.globalContext=new h;function d(e,n){void 0===n&&(n=t.globalContext);return function(t,i){var c=t.constructor;c._context=n;n.has(c)||n.add(c);var u=c._definition;u.addField(i,e);if(!u.descriptors[i]){var l=s.ArraySchema.is(e),h=!l&&a.MapSchema.is(e);if("string"!=typeof e&&!o.Schema.is(e)){var d=Object.values(e)[0];"string"==typeof d||n.has(d)||n.add(d)}var p="_"+i;u.descriptors[p]={enumerable:0,configurable:0,writable:1};u.descriptors[i]={get:function(){return this[p]},set:function(e){if(e!==this[p]){if(null!=e){!l||e instanceof s.ArraySchema||(e=new(s.ArraySchema.bind.apply(s.ArraySchema,r([void 0],e))));!h||e instanceof a.MapSchema||(e=new a.MapSchema(e));void 0===e["$proxy"]&&(h?e=a.getMapProxy(e):l&&(e=s.getArrayProxy(e)));this.$changes.change(i);e["$changes"]&&e["$changes"].setParent(this,this.$changes.root,this._definition.indexes[i])}else this.$changes.delete(i);this[p]=e}},enumerable:1,configurable:1}}}}t.type=d;function p(e){return function(t,n){var i=t.constructor,r;i._definition.addFilter(n,e)&&(i._context.useFilters=1)}}t.filter=p;function f(e){return function(t,n){var i=t.constructor,r;i._definition.addChildrenFilter(n,e)&&(i._context.useFilters=1)}}t.filterChildren=f;function m(e,n){void 0===e&&(e=1);void 0===n&&(n=t.globalContext);return function(t,n){var i,r=t.constructor._definition;r.deprecated[n]=1;e&&(r.descriptors[n]={get:function(){throw new Error(n+" is deprecated.")},set:function(e){},enumerable:0,configurable:1})}}t.deprecated=m;function g(e,n,i){void 0===i&&(i=e._context||t.globalContext);for(var r in n)d(n[r],i)(e.prototype,r);return e}t.defineTypes=g},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.MapSchema=t.getMapProxy=void 0;var i=n(12),r=n(7),o=n(8);function s(e){e["$proxy"]=1;return e=new Proxy(e,{get:function(e,t){return"symbol"!=typeof t&&"undefined"==typeof e[t]?e.get(t):e[t]},set:function(e,t,n){"symbol"!=typeof t&&-1===t.indexOf("$")&&"onAdd"!==t&&"onRemove"!==t&&"onChange"!==t?e.set(t,n):e[t]=n;return 1},deleteProperty:function(e,t){e.delete(t);return 1}})}t.getMapProxy=s;var a=function(){function e(e){var t=this;this.$changes=new i.ChangeTree(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;if(e)if(e instanceof Map)e.forEach((function(e,n){return t.set(n,e)}));else for(var n in e)this.set(n,e[n])}e.is=function(e){return void 0!==e["map"]};e.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()};Object.defineProperty(e.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:0,configurable:1});e.prototype.set=function(e,t){var n="undefined"!=typeof this.$changes.indexes[e],i=n?this.$changes.indexes[e]:this.$refId++,o=n?r.OPERATION.REPLACE:r.OPERATION.ADD,s=void 0!==t["$changes"];s&&t["$changes"].setParent(this,this.$changes.root,i);if(n)s&&this.$items.get(e)!==t&&(o=r.OPERATION.ADD);else{this.$changes.indexes[e]=i;this.$indexes.set(i,e)}this.$items.set(e,t);this.$changes.change(e,o);return this};e.prototype.get=function(e){return this.$items.get(e)};e.prototype.delete=function(e){this.$changes.delete(e);return this.$items.delete(e)};e.prototype.clear=function(e){var t=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){t.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:r.OPERATION.CLEAR});this.$changes.touchParents()};e.prototype.has=function(e){return this.$items.has(e)};e.prototype.forEach=function(e){this.$items.forEach(e)};e.prototype.entries=function(){return this.$items.entries()};e.prototype.keys=function(){return this.$items.keys()};e.prototype.values=function(){return this.$items.values()};Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:0,configurable:1});e.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};e.prototype.getIndex=function(e){return this.$indexes.get(e)};e.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};e.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};e.prototype.toJSON=function(){var e={};this.forEach((function(t,n){e[n]="function"==typeof t["toJSON"]?t["toJSON"]():t}));return e};e.prototype.clone=function(t){var n;if(t)n=Object.assign(new e,this);else{var i=new e;this.forEach((function(e,t){e["$changes"]?i.set(t,e["clone"]()):i.set(t,e)}))}return n};e.prototype.triggerAll=function(){o.Schema.prototype.triggerAll.apply(this)};return e}();t.MapSchema=a},function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});t.generateTrack=void 0;const r=i(n(25)),o=n(37),s=n(36),a=n(26),c=n(38),u=n(3),l=n(39),h=n(34),d=n(40);function p(e,t){const n=u.seedGen.create(e.toString()),i=t,o=Object.values(r.default);let s=[];for(;s.length<i;){const e=a(0,o.length-1,s.map(e=>o.indexOf(e)));s.push(o[e]);s=Array.from(new Set(s))}void 0;return s.map((e,t)=>({Game:e}));function a(e,t,i){let r=Math.floor(n.random()*(t+1-e));if(!i)return r;for(;~i.indexOf(r);)r=e+Math.floor(n.random()*(t+1-e));return r}}t.generateTrack=p},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});const i=n(26),r=n(34),o=n(62),s=n(36),a=n(37),c=n(71),u=n(38),l=n(39),h=n(40);t.default={DifferentGame:u.DifferentGame,AttackGame:r.AttackGame,RotationGame:i.RotationGame,CostumeGame:o.CostumeGame,ObstacleGame:s.ObstacleGame,MathGame:a.MathGame,SammichGame:c.SammichGame,FroggerGame:l.FroggerGame,InvadersGame:h.InvadersGame}},function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});t.RotationGame=void 0;const r=i(n(58)),o=n(3),s=n(21),a=n(10),c=n(1),u=n(5),l=n(2),h=n(0),d=n(4),p=5;class f{constructor(e,{currentPlayer:t,seed:n,level:i=1,gameIndex:r}){this.state={startTime:Number.MAX_VALUE,roundStartTime:Number.MAX_VALUE,lastRoundStartTime:Number.MAX_VALUE,waitingRound:0,started:0,roundStarted:0,round:0,finished:0,score1:0,score2:0,idle:1,currentRotation:0,answered:0};this.entity={};this.callbacks={onFinish:null,onShareState:null,onFinishRound:null};this.root=e;this.gameSetup={currentPlayer:t,seed:n,level:i,gameIndex:r};this.randomizer=o.seedGen.create(n.toString());this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,0,-.002)}));this.ui=(0,d.createUI)(this.scene);this.scene.addComponent(new s.GameScene);this.player1=(0,d.createPlayerAnswer)(this.scene,{player:1});this.player2=(0,d.createPlayerAnswer)(this.scene,{player:2});this.player1.hide();this.player2.hide();this.roundResult1=(0,d.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,d.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();const a=this.entity.image=new Entity,u=undefined;m(this.entity.box=new Entity,c.spriteMaterial,(0,h.getSpriteUv)(10,144,64,64));m(a,c.spriteMaterial,(0,h.getSpriteUv)(9,144,64,64));this.state.rotationSerie=this.getRotationSerie(this.gameSetup.level);this.state.solution=this.state.rotationSerie.reduce((e,t)=>e+t,0);const l=this.state.correctSolution=this.getRandomInt(1,3);this.state.solutions=[1,2,3].map(e=>e===l?this.state.solution:90*this.getRandomInt(1,4,this.state.solution/90));this.entity.solutions=this.state.solutions.map((e,t)=>{const n=new Entity;this.buildSolution(n,t,e);n.setParent(this.scene);return n});engine.addSystem(this);this.onClickAnswer=this.onClickAnswer.bind(this);this.buildSolution=this.buildSolution.bind(this)}setStartTime(e){this.state.startTime=e}setRoundStartTime(e){this.state.roundStartTime=e}reset(){}getRotationSerie(e){let t=3;e>=3&&e<5?t=4:e>=5&&(t=5);let n=t;const i=[];for(;n--;){const e=this.randomizer.random();i.push(Math.floor(2*e)?90:-90)}return i}finish({winner:e}){this.state.blocked=1;const t=1===e?2:1;e===this.gameSetup.currentPlayer?(0,l.playOnce)("wow"):(0,l.playOnce)("fail");this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}finishRound({winner:e}){this.state.blocked=1;const t=1===e?2:1;this.state["score"+e]+=1;this.ui.updateScore({player:e,score:this.state["score"+e]});e===this.gameSetup.currentPlayer?(0,l.playOnce)("wow"):(0,l.playOnce)("fail");this.entity.box.getComponent(Transform).rotation.setEuler(0,0,0);this.entity.box.getComponent(PlaneShape).visible=0;this.entity.image.getComponent(PlaneShape).visible=1;this["roundResult"+e].update(1);this["roundResult"+t].update(0);this.roundResult1.show();this.roundResult2.show();this.state.waitingRound=1}shareState(e){this.state.shared=e;const{round:t}=e;if(t===this.state.round&&"election"===e.type&&e.player!==this.gameSetup.currentPlayer){const{x:t,y:n,z:i}=this.entity.solutions[e.election-1].getComponent(Transform).position,r=this.getIsWinner(this.state,e.election);this["player"+e.player].wrapperEntity.getComponent(Transform).position.set(t+(1===e.player?-.3:.3),n,i);this["player"+e.player].show();this["player"+e.player].setSprite(r);this.ui.updateTime({player:e.player,time:e.timeSinceAnswers})}}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}init(){(0,l.playLoop)("money",{volume:.5});(0,u.updateSpritePanel)({uvs:(0,h.getSpriteUv)(2,0,192,128)});(0,u.showSpritePanel)();this.entity.image.setParent(this.scene);this.entity.box.setParent(this.scene);this.entity.box.getComponent(PlaneShape).visible=0;this.state.initialized=1;this.scene.setParent(this.root)}destroy(){(0,l.stopSound)("money");(0,u.hideSpritePanel)();this.scene.setParent(null);engine.removeEntity(this.scene);engine.removeSystem(this);this.callbacks.onFinish=null;this.callbacks.onShareState=null}update(e){if(!this.state.initialized)return;const t=this.state.round<2?.4:this.state.round<3?.3:.2,n=.2;if(!this.state.started&&Date.now()>=this.state.startTime)this.start(e);else if(!this.state.started||this.state.waitingRound||this.state.roundStarted){if(this.state.started&&!this.state.waitingRound&&this.state.roundStarted){this.state.nextTime+=e;if(this.state.nextTime>=t+n){this.state.nextTime=0;if(this.state.currentRotation<this.state.rotationSerie.length){const e=Quaternion.Euler(0,0,0),n=Quaternion.Euler(0,0,this.state.rotationSerie[this.state.currentRotation]);(0,l.playOnce)("swing");this.entity.box.addComponentOrReplace(new r.default.RotateTransformComponent(e,n,t));this.state.nextTime=0;this.state.currentRotation++;this.entity.solutions.forEach(e=>e.getComponent(PlaneShape).visible=0);this.state.answersShown=0}else if(!this.state.waitingRound&&!this.state.answersShown){this.state.blocked=0;this.state.answersShown=1;this.state.shownAnswersTime=Date.now();this.entity.solutions.forEach(e=>e.getComponent(PlaneShape).visible=1)}}}}else{this.state.nextTime+=e;if(this.state.nextTime>=t+n){this.state.nextTime=0;if(this.state.currentRotation<this.state.rotationSerie.length){const e=Quaternion.Euler(0,0,0),n=Quaternion.Euler(0,0,this.state.rotationSerie[this.state.currentRotation]);(0,l.playOnce)("swing");this.entity.box.addComponentOrReplace(new r.default.RotateTransformComponent(e,n,t));this.state.nextTime=0;this.state.currentRotation++;this.entity.solutions.forEach(e=>e.getComponent(PlaneShape).visible=0);this.state.answersShown=0}else if(!this.state.waitingRound&&!this.state.answersShown){this.state.answersShown=1;this.state.shownAnswersTime=Date.now();this.entity.solutions.forEach(e=>e.getComponent(PlaneShape).visible=1)}}}this.state.started&&this.state.waitingRound&&Date.now()>=this.state.roundStartTime&&this.startRound()}block(){this.state.blocked=1}start(e){setTimeout(()=>{this.state.idle=0;this.state.started=1;this.state.finished=0;this.state.nextTime=0;this.entity.box.getComponent(PlaneShape).visible=1;this.entity.image.getComponent(PlaneShape).visible=0},1e3)}startRound(){this.state.round++;this.ui.hideTime();this.entity.solutions.forEach(e=>{e.getComponent(PlaneShape).visible=0});this.player1.hide();this.player2.hide();this.roundResult1.hide();this.roundResult2.hide();this.state.lastRoundStartTime=this.state.roundStartTime;this.state.roundStartTime=Number.MAX_VALUE;setTimeout(()=>{this.state.blocked=0;this.state.waitingRound=0;this.state.answered=0;this.state.roundStarted=1;this.state.nextTime=0;this.entity.box.getComponent(PlaneShape).visible=1;this.entity.image.getComponent(PlaneShape).visible=0;this.state.rotationSerie=this.getRotationSerie(this.state.round+1);this.state.solution=this.state.rotationSerie.reduce((e,t)=>e+t,0);const e=this.state.correctSolution=this.getRandomInt(1,3);this.state.solutions=[1,2,3].map(t=>t===e?this.state.solution:90*this.getRandomInt(1,4,this.state.solution/90));this.state.currentRotation=0;this.entity.solutions.forEach((e,t)=>{e.getComponent(Transform).rotation.setEuler(0,0,0);e.getComponent(Transform).rotate(new Vector3(0,0,1),this.state.solutions[t])})},1e3/(500*this.state.round)*1e3)}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onFinishRound(e){this.callbacks.onFinishRound=e;return()=>this.callbacks.onFinishRound=null}getIsWinner(e,t){const n=this.entity.solutions[t-1],i=undefined;if(r(this.entity.solutions[e.correctSolution-1])===r(n))return 1;void 0;return 0;function r(e){const t=Math.round(e.getComponent(Transform).rotation.eulerAngles.z)%360;return t<0?360-t:t}}buildSolution(e,t,n){const i=new PlaneShape;i.visible=0;i.withCollisions=0;const r={x:1.1*t-1.1,y:1.15,z:0},o=new Transform({position:new Vector3(r.x,r.y,r.z),scale:new Vector3(1,1,1e-7)});o.rotate(new Vector3(0,0,1),n);e.addComponent(c.spriteMaterial);i.withCollisions=0;i.uvs=(0,h.getSpriteUv)(12,480,32,32);e.addComponent(i);e.addComponent(o);this.gameSetup.currentPlayer&&e.addComponent(new OnClick(()=>this.onClickAnswer(e,r,t)))}onClickAnswer(e,t,n){if(this.state.answered)return;if(this.state.blocked)return;if(!this.state.initialized)return;if(this.state.finished)return;(0,l.playOnce)("swing");this["player"+this.gameSetup.currentPlayer].wrapperEntity.getComponent(Transform).position.set(t.x+(1===this.gameSetup.currentPlayer?-.2:.2),t.y,t.z);this["player"+this.gameSetup.currentPlayer].show();this.state.blocked=1;this.state.answered=1;const i=this.getIsWinner(this.state,n+1);this["player"+this.gameSetup.currentPlayer].setSprite(i);const r=(0,a.getTimeSinceStart)(0===this.state.round?this.state.startTime:this.state.lastRoundStartTime),o=i?r:999999999-r,s=Date.now()-this.state.shownAnswersTime;this.ui.updateTime({player:this.gameSetup.currentPlayer,time:s});this.callbacks.onShareState({type:"election",player:this.gameSetup.currentPlayer,election:n+1,time:r,timeSinceAnswers:s,round:this.state.round});this.state.round<p-1?this.callbacks.onFinishRound({time:o,player:this.gameSetup.currentPlayer,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round}):this.callbacks.onFinish({time:o,isWinner:i,round:this.state.round,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round})}getRandomInt(e,t,n){const i=Math.floor(this.randomizer.random()*(t-e+1))+e;return i===n?this.getRandomInt(e,t,n):i}}t.RotationGame=f;f.id="Rotation";f.timeToWaitForOtherAnswer=2;f.instructions="Image is hidden and start rotating\n    Click the correct solution";function m(e,t,n){const i=new PlaneShape;i.withCollisions=0;i.uvs=n;const r=new Transform({scale:new Vector3(2,2,1e-6),position:new Vector3(0,2.7,0)});e.addComponent(i);e.addComponent(t);e.addComponent(r)}},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.RotateTransformComponent=void 0;const r=n(9),o=n(13);let s=class e{constructor(e,t,n,i,s=o.InterpolationType.LINEAR){this.start=e;this.end=t;this.normalizedTime=0;this.lerpTime=0;this.onFinishCallback=i;this.interpolationType=s;if(0!=n)this.speed=1/n;else{this.speed=0;this.normalizedTime=1;this.lerpTime=1}r.TransformSystem.createAndAddToEngine()}update(e){this.normalizedTime=Scalar.Clamp(this.normalizedTime+e*this.speed,0,1);this.lerpTime=(0,o.Interpolate)(this.interpolationType,this.normalizedTime)}hasFinished(){return this.normalizedTime>=1}assignValueToTransform(e){e.rotation=Quaternion.Slerp(this.start,this.end,this.lerpTime)}};s=i([Component("rotateTransformComponent")],s);t.RotateTransformComponent=s},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.ScaleTransformComponent=void 0;const r=n(9),o=n(13);let s=class e{constructor(e,t,n,i,s=o.InterpolationType.LINEAR){this.start=e;this.end=t;this.normalizedTime=0;this.lerpTime=0;this.onFinishCallback=i;this.interpolationType=s;if(0!=n)this.speed=1/n;else{this.speed=0;this.normalizedTime=1;this.lerpTime=1}r.TransformSystem.createAndAddToEngine()}update(e){this.normalizedTime=Scalar.Clamp(this.normalizedTime+e*this.speed,0,1);this.lerpTime=(0,o.Interpolate)(this.interpolationType,this.normalizedTime)}hasFinished(){return this.normalizedTime>=1}assignValueToTransform(e){e.scale=Vector3.Lerp(this.start,this.end,this.lerpTime)}};s=i([Component("scaleTransformComponent")],s);t.ScaleTransformComponent=s},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.FollowPathComponent=void 0;const r=n(9);let o=class e{constructor(e,t,n,i){this.speed=[];this.normalizedTime=0;this.currentIndex=0;this.points=e;this.onFinishCallback=n;this.onPointReachedCallback=i;if(e.length<2)throw new Error("At least 2 points are needed for FollowPathComponent.");if(t>0){let n=0,i=[];for(let t=0;t<e.length-1;t++){let r=Vector3.DistanceSquared(e[t],e[t+1]);n+=r;i.push(r)}for(let e=0;e<i.length;e++)this.speed.push(1/(i[e]/n*t))}else{this.normalizedTime=1;this.currentIndex=e.length-2}r.TransformSystem.createAndAddToEngine()}update(e){this.normalizedTime=Scalar.Clamp(this.normalizedTime+e*this.speed[this.currentIndex],0,1);if(this.normalizedTime>=1&&this.currentIndex<this.points.length-2){this.currentIndex++;this.normalizedTime=0;this.onPointReachedCallback&&this.currentIndex<this.points.length-1&&this.onPointReachedCallback(this.points[this.currentIndex],this.points[this.currentIndex+1])}}hasFinished(){return this.currentIndex>=this.points.length-2&&this.normalizedTime>=1}assignValueToTransform(e){e.position=Vector3.Lerp(this.points[this.currentIndex],this.points[this.currentIndex+1],this.normalizedTime)}};o=i([Component("followPathComponent")],o);t.FollowPathComponent=o},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.KeepRotatingComponent=void 0;const r=n(9);let o=class e{constructor(e,t){this.rotationVelocity=e;this.onFinishCallback=t;this.rotation=Quaternion.Identity;this.finished=0;r.TransformSystem.createAndAddToEngine()}update(e){this.rotation=Quaternion.Slerp(Quaternion.Identity,this.rotationVelocity,e)}hasFinished(){return this.finished}assignValueToTransform(e){e.rotation=e.rotation.multiply(this.rotation)}stop(){this.finished=1}};o=i([Component("keepRotatingComponent")],o);t.KeepRotatingComponent=o},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.Delay=void 0;const r=n(20);let o=class e{constructor(e,t){r.TimerSystem.createAndAddToEngine();this.elapsedTime=0;this.targetTime=e/1e3;this.onTimeReachedCallback=t;this.onTargetTimeReached=e=>{this.onTimeReachedCallback&&this.onTimeReachedCallback();e.removeComponent(this)}}setCallback(e){this.onTimeReachedCallback=e}};o=i([Component("timerDelay")],o);t.Delay=o},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.Interval=void 0;const r=n(20);let o=class e{constructor(e,t){r.TimerSystem.createAndAddToEngine();this.elapsedTime=0;this.targetTime=e/1e3;this.onTimeReachedCallback=t;this.onTargetTimeReached=()=>{this.elapsedTime=0;this.onTimeReachedCallback&&this.onTimeReachedCallback()}}setCallback(e){this.onTimeReachedCallback=e}};o=i([Component("timerInterval")],o);t.Interval=o},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.ExpireIn=void 0;const r=n(20);let o=class e{constructor(e,t){r.TimerSystem.createAndAddToEngine();this.elapsedTime=0;this.targetTime=e/1e3;this.onTimeReachedCallback=t;this.onTargetTimeReached=e=>{this.onTimeReachedCallback&&this.onTimeReachedCallback();e.removeComponent(this);engine.removeEntity(e)}}setCallback(e){this.onTimeReachedCallback=e}};o=i([Component("timerExpireIn")],o);t.ExpireIn=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.AttackGame=void 0;const i=n(21),r=n(3),o=n(10),s=n(1),a=n(5),c=n(2),u=n(0),l=n(4),h={DEFEND:0,ATTACK:1},d=640/71*16,p=11;let f=0;const m={E:1,F:2,CLICK:3};class g{constructor(e,{currentPlayer:t,seed:n,level:o,gameIndex:a}){this.state={startTime:Number.MAX_VALUE,roundStartTime:Number.MAX_VALUE,lastRoundStartTime:Number.MAX_VALUE,waitingRound:0,initialized:0,round:0,idle:1,started:0,blocked:0,finished:0,player1Key:-1,player2Key:-2};this.callbacks={onFinish:null,onFinishRound:null,onShareState:null};this.score1=0;this.score2=0;void 0;f++;this.id=f;const c=engine.getEntitiesWithComponent("game_scene");void 0;Object.keys(c).forEach(e=>{engine.removeEntity(c[e])});this.root=e;this.gameSetup={currentPlayer:t,seed:n,level:o,gameIndex:a};this.randomizer=r.seedGen.create(n.toString());this.scene=new Entity;this.scene.addComponent(new i.GameScene);this.scene.addComponent(new Transform({position:new Vector3(0,0,-.002)}));this.ui=(0,l.createUI)(this.scene);this.label1=(0,u.createSpriteEntity)(this.scene,{position:new Vector3(-1.5,3.5,-.001),uvs:(0,u.getSpriteUv)(4,384,32,32),scale:new Vector3(1,1,1)});this.label2=(0,u.createSpriteEntity)(this.scene,{position:new Vector3(1.5,3.5,-.001),uvs:(0,u.getSpriteUv)(4,384,32,32),scale:new Vector3(1,1,1)});this.label1.hide();this.label2.hide();this.char1=new Entity;this.char2=new Entity;this.char1.addComponent(s.spriteMaterial);this.char2.addComponent(s.spriteMaterial);this.char1.addComponent(new Transform({position:new Vector3(-1,2,0),scale:new Vector3(2,2,1)}));this.char2.addComponent(new Transform({position:new Vector3(1,2,0),scale:new Vector3(-2,2,1)}));this.char1.setParent(this.scene);this.char2.setParent(this.scene);this.char1Shape=new PlaneShape;this.char1Shape.uvs=(0,u.getSpriteUv)(1,d,64,71);this.char2Shape=new PlaneShape;this.char2Shape.uvs=(0,u.getSpriteUv)(1,d,64,71);this.char1.addComponent(this.char1Shape);this.char2.addComponent(this.char2Shape);this.roundResult1=(0,l.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,l.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();this.state=Object.assign(Object.assign({},this.state),{player1Key:1+Math.floor(3*this.randomizer.random()),player2Key:1+Math.floor(3*this.randomizer.random()),started:0});engine.addSystem(this)}setStartTime(e){void 0;this.state.startTime=e}reset(){}setRoundStartTime(e){void 0;this.state.roundStartTime=e}finishRound({winner:e}){this.label1.hide();this.label2.hide();(0,c.stopSound)("swing");(0,c.playOnce)("hit");this["score"+e]+=1;this.ui.updateScore({player:e,score:this["score"+e]});e!==this.gameSetup.currentPlayer?setTimeout(()=>{(0,c.playOnce)("fail")},500):setTimeout(()=>{(0,c.playOnce)("ok")},500);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.primaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.secondaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.clickButtonCallback);void 0;const t=[3,640/71*8,128,71];if(1===e){this.char2Shape.visible=0;const e=this.char1.getComponent(Transform);e.scale.set(4,2,1);e.position.set(0,2,0);this.char1Shape.uvs=(0,u.getSpriteUv)(...t)}else{this.char2Shape.visible=0;const e=this.char1.getComponent(Transform);e.scale.set(-4,2,1);e.position.set(0,2,0);this.char1Shape.uvs=(0,u.getSpriteUv)(...t)}const n=1===e?2:1;this["roundResult"+e].update(1);this["roundResult"+n].update(0);this.roundResult1.show();this.roundResult2.show();this.state.waitingRound=1}handleAction(e){Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.primaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.secondaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.clickButtonCallback);this[`char${this.gameSetup.currentPlayer}Shape`].uvs=(0,u.getSpriteUv)(3,d,64,71);const t=(0,o.getTimeSinceStart)(0===this.state.round?this.state.startTime:this.state.lastRoundStartTime);void 0;const n=e?t:999999999-t;this.ui.updateTime({player:this.gameSetup.currentPlayer,time:t});this.callbacks.onShareState({player:this.gameSetup.currentPlayer,time:n,timeSinceStart:t,round:this.state.round});if(this.state.round<p-1){this.callbacks.onFinishRound({player:this.gameSetup.currentPlayer,time:n,isWinner:e,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round});this.state.waitingRound=1}else this.callbacks.onFinish({player:this.gameSetup.currentPlayer,time:n,isWinner:e,gameIndex:this.gameSetup.gameIndex})}clickButtonCallback(e){(0,c.playOnce)("swing");const t=this.state[`player${this.gameSetup.currentPlayer}Key`]===m.CLICK;this.handleAction(t)}primaryButtonCallback(e){(0,c.playOnce)("swing");const t=this.state[`player${this.gameSetup.currentPlayer}Key`]===m.E;this.handleAction(t)}secondaryButtonCallback(e){(0,c.playOnce)("swing");const t=this.state[`player${this.gameSetup.currentPlayer}Key`]===m.F;this.handleAction(t)}init(){(0,a.updateSpritePanel)({uvs:(0,u.getSpriteUv)(4,0,192,128)});(0,a.showSpritePanel)();(0,c.playLoop)("battle",{volume:.5});void 0;this.scene.setParent(this.root);this.state.initialized=1}start(){void 0;this.state.round=0;this.state.idle=0;this.state.finished=0;this.state.started=1;this.primaryButtonCallback=this.primaryButtonCallback.bind(this);this.secondaryButtonCallback=this.secondaryButtonCallback.bind(this);this.clickButtonCallback=this.clickButtonCallback.bind(this);this.gameSetup.currentPlayer&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,0,this.primaryButtonCallback);this.gameSetup.currentPlayer&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,0,this.secondaryButtonCallback);this.gameSetup.currentPlayer&&Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,this.clickButtonCallback);this.label1.show();this.label2.show();this.label1.updateUvs((0,u.getSpriteUv)(this.state.player1Key,387,32,32));this.label2.updateUvs((0,u.getSpriteUv)(this.state.player2Key,387,32,32))}startRound(){this.state.round++;this.ui.hideTime();this.char2Shape.visible=1;const e=this.char1.getComponent(Transform);e.scale.set(2,2,1);e.position.set(-1,2,0);this.char1Shape.uvs=(0,u.getSpriteUv)(1,d,64,71);this.char2Shape.uvs=(0,u.getSpriteUv)(1,d,64,71);this.roundResult1.hide();this.roundResult2.hide();this.state.lastRoundStartTime=this.state.roundStartTime;this.state.roundStartTime=Number.MAX_VALUE;void 0;this.state.idle=0;this.state.started=1;this.state.waitingRound=0;Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,0,this.primaryButtonCallback);Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,0,this.secondaryButtonCallback);Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,this.clickButtonCallback);this.state=Object.assign(Object.assign({},this.state),{player1Key:1+Math.floor(3*this.randomizer.random()),player2Key:1+Math.floor(3*this.randomizer.random())});this.label1.show();this.label2.show();this.label1.updateUvs((0,u.getSpriteUv)(this.state.player1Key,387,32,32));this.label2.updateUvs((0,u.getSpriteUv)(this.state.player2Key,387,32,32))}destroy(){(0,c.stopAllSounds)();(0,a.hideSpritePanel)();Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.primaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.secondaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.clickButtonCallback);void 0;const e=engine.getEntitiesWithComponent("game_scene");void 0;Object.keys(e).forEach(e=>{});this.scene.setParent(null);engine.removeEntity(this.scene);void 0;engine.removeSystem(this)}finish(e){this.label1.hide();this.label2.hide();const{winner:t}=e;void 0;const n=1===t?2:1;(0,c.stopSound)("swing");(0,c.playOnce)("hit");t!==this.gameSetup.currentPlayer?(0,c.playOnce)("fail"):(0,c.playOnce)("ok");const i=[3,640/71*8,128,71];if(1===t){this.char2Shape.visible=0;const e=this.char1.getComponent(Transform);e.scale.set(4,2,1);e.position.set(0,2,0);this.char1Shape.uvs=(0,u.getSpriteUv)(...i)}else{this.char2Shape.visible=0;const e=this.char1.getComponent(Transform);e.scale.set(-4,2,1);e.position.set(0,2,0);this.char1Shape.uvs=(0,u.getSpriteUv)(...i)}this.roundResult1.show();this.roundResult2.show();this["roundResult"+t].update(1);this["roundResult"+n].update(0)}block(){this.state.blocked=1;Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.primaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.secondaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.clickButtonCallback)}onFinish(e){this.callbacks.onFinish=e;return()=>{this.callbacks.onFinish=null}}onFinishRound(e){this.callbacks.onFinishRound=e;return()=>this.callbacks.onFinishRound=null}shareState(e){void 0;const{player:t,timeSinceStart:n,time:i,round:r}=e;if(r===this.state.round){this[`char${t}Shape`].uvs=(0,u.getSpriteUv)(3,d,64,71);this.ui.updateTime({player:t,time:n})}}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}update(e){if(this.state.initialized)if(!this.state.waitingRound&&!this.state.started&&Date.now()>=this.state.startTime){void 0;this.start()}else if(this.state.started&&this.state.waitingRound&&Date.now()>=this.state.roundStartTime){void 0;this.startRound()}else Date.now()>=this.state.roundStartTime}}t.AttackGame=g;g.id="Attack";g.timeToWaitForOtherAnswer=1;g.instructions="2 old warriors on each player side, \n    faster than your opponent,\n    press the appropriate key: E, F or CLICK"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createCross=void 0;const i=n(1),r=n(0),o=(e,{position:t,scale:n})=>{const o=new Entity,s=new PlaneShape;s.withCollisions=0;o.addComponent(i.spriteMaterial);s.uvs=(0,r.getSpriteUv)(993,0,32);o.addComponent(s);const a=new Transform({position:t,scale:n});o.addComponent(a);o.setParent(e);return{dispose:()=>{o.setParent(null);engine.removeEntity(o);o.removeComponent(i.spriteMaterial);o.removeComponent(a);o.removeComponent(s)},hide:()=>{s.visible=0},show:()=>{s.visible=1},setPosition:({x:e,y:t,z:n})=>{a.position.set(e,t,n)}}};t.createCross=o},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});t.ObstacleGame=void 0;const r=n(3),o=n(70),s=n(2),a=n(6),c=n(4),u=({getRandomInt:e,level:t})=>{const n=80*Math.log(t+1);let i=n,r=[];const o=2,s=8;let a=1;for(;r.length<n;){r.push(...new Array(e(o,s)+(a?4:0)).fill(0),1);a=0}r.push(...new Array(3).fill(0));return r};class l{constructor(e,{seed:t,currentPlayer:n,level:i=1,gameIndex:s}){this.state={initialized:0,started:0,currentLeg:1,blocked:1,startTime:Number.MAX_VALUE};this.callbacks={onFinish:null,onShareState:null};this.root=e;this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,0,-.001)}));this.ui=(0,c.createUI)(this.scene);this.gameSetup={seed:t.toString(),currentPlayer:n,level:i,gameIndex:s};this.randomizer=r.seedGen.create(t.toString());const a=1===n?2:1,l=u({getRandomInt:this.getRandomInt.bind(this),level:i});void 0;this.screen1=(0,o.createScreen)(this.scene,{player:1,track:l});this.screen2=(0,o.createScreen)(this.scene,{player:2,track:l});this.roundResult1=(0,c.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,c.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();this.moveLeg1=this.moveLeg1.bind(this);this.moveLeg2=this.moveLeg2.bind(this);this.jump=this.jump.bind(this);engine.addSystem(this)}setStartTime(e){this.state.startTime=e}getPlayerScreen(e){return this["screen"+e]}init(){this.state.initialized=1;this.scene.setParent(this.root)}tempBlock(){this.state.blocked=1;this["screen"+this.gameSetup.currentPlayer].showCross();(0,s.playOnce)("fail");setTimeout(()=>{this.state.blocked=0;this["screen"+this.gameSetup.currentPlayer].hideCross()},1e3)}moveLeg1(){if(this.state.blocked||!this.state.started)return;const e=this.getPlayerScreen(this.gameSetup.currentPlayer);if(this.state.blocked||1!==this.state.currentLeg||e.getScreenState().moving)return;e.moveScreen();this.state.currentLeg=2;e.getNextStepValue()?this.tempBlock():(0,s.playOnce)("ok");const t=this.getPercentage(this.gameSetup.currentPlayer);void 0;this.ui.updateScore({player:this.gameSetup.currentPlayer,score:t});this.callbacks.onShareState({movement:"1",player:this.gameSetup.currentPlayer,percentage:t})}moveLeg2(){if(this.state.blocked||!this.state.started)return;const e=this.getPlayerScreen(this.gameSetup.currentPlayer);if(this.state.blocked||2!==this.state.currentLeg||e.getScreenState().moving)return;e.moveScreen();this.state.currentLeg=1;e.getNextStepValue()?this.tempBlock():(0,s.playOnce)("ok");const t=this.getPercentage(this.gameSetup.currentPlayer);this.ui.updateScore({player:this.gameSetup.currentPlayer,score:t});this.callbacks.onShareState({movement:"2",player:this.gameSetup.currentPlayer,percentage:t})}jump(){if(this.state.blocked||!this.state.started)return;const e=this.getPlayerScreen(this.gameSetup.currentPlayer);if(1!==e.getNextStepValue())return;if(e.getScreenState().moving)return;e.moveScreen(1);const t=this.getPercentage(this.gameSetup.currentPlayer,1);this.ui.updateScore({player:this.gameSetup.currentPlayer,score:t});this.callbacks.onShareState({movement:"jump",player:this.gameSetup.currentPlayer,percentage:t});(0,s.playOnce)("jump")}getPercentage(e,t){const n=this["screen"+e].getScreenState().currentStep+(t?2:1),i=this["screen"+e].getTotalSteps()-4;return Math.floor(100*n/i)}start(){this.state.started=1;(()=>i(this,void 0,void 0,(function*(){(0,s.playLoop)("race",{volume:.5});yield h(3e3);(0,s.playOnce)("readygo");(0,a.updateTextPanel)({value:"READY!"});yield h(700);(0,a.updateTextPanel)({value:"STEADY!"});yield h(800);(0,a.updateTextPanel)({value:"GO!"});void 0;const e=this.getPlayerScreen(this.gameSetup.currentPlayer);this.state.blocked=0;if(this.gameSetup.currentPlayer){this.state.blocked=0;Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,0,this.moveLeg1);Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,0,this.moveLeg2);Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,this.jump)}e.onMove(e=>{e%2==0});e.onFinishScreen(()=>{this.block();(0,s.stopSound)("race");const e=Date.now()-this.state.startTime;this.callbacks.onFinish({time:e,isWinner:1,gameIndex:this.gameSetup.gameIndex,roundIndex:0});this.ui.updateTime({player:this.gameSetup.currentPlayer,time:e});this.ui.updateScore({player:this.gameSetup.currentPlayer,score:100});this.callbacks.onShareState({player:this.gameSetup.currentPlayer,timeSinceStart:e,percentage:100})});this.screen1.handleVisibility();this.screen2.handleVisibility();yield h(1e3);(0,a.updateTextPanel)({value:""})})))()}update(e){if(this.state.initialized)if(!this.state.started&&Date.now()-4e3>=this.state.startTime)this.start();else{this.state.started&&this.getPlayerScreen(1).getScreenState().moving&&this.getPlayerScreen(1).updateScreen(e);this.state.started&&this.getPlayerScreen(2).getScreenState().moving&&this.getPlayerScreen(2).updateScreen(e)}}destroy(){(0,s.stopSound)("race");(0,a.updateTextPanel)({value:""});Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.moveLeg1);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.moveLeg2);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.jump);this.scene.setParent(null);engine.removeEntity(this.scene);engine.removeSystem(this)}block(){this.state.blocked=1;Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.moveLeg1);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.moveLeg2);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.jump)}finish({winner:e}){const t=1===e?2:1;this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}shareState(e){void 0;const{movement:t,player:n,timeSinceStart:i,percentage:r}=e;if(i)this.ui.updateTime({player:n,time:i});else{const e=this.getPlayerScreen(n);"1"===t||"2"===t?e.moveScreen():e.moveScreen(1)}this.ui.updateScore({player:n,score:r})}getRandomInt(e,t,n){const i=Math.floor(this.randomizer.random()*(t-e+1))+e;return i===n?this.getRandomInt(e,t,n):i}}t.ObstacleGame=l;l.id="Obstacle";l.instructions="Alternate E and F  with rythm to run,\n    when red obstacle right in front,\n    Press click to jump!\n    ";function h(e){return new Promise(t=>setTimeout(t,e))}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.MathGame=void 0;const i=n(2),r=n(1),o=n(5),s=n(3),a=n(10),c=n(0),u=n(4),l=5,h=4/128,d=144,p=(e,{player:t})=>{const n=new Entity,i=new PlaneShape;i.withCollisions=0;i.uvs=(0,c.getSpriteUv)(1,d,64,64);n.addComponent(r.spriteMaterial);n.addComponent(i);n.addComponent(new Transform({position:new Vector3(1===t?-(2.2+2*h):2.2-3*h,1.5-2*h,-.002),scale:new Vector3(1===t?2:-2,2,1)}));n.setParent(e);return i};class f{constructor(e,{seed:t,level:n,currentPlayer:i,gameIndex:r}){this.state={blocked:0,started:0,initialized:0,startTime:Number.MAX_VALUE,roundStartTime:Number.MAX_VALUE,lastRoundStartTime:Number.MAX_VALUE,waitingRound:0,round:0,finished:0,score1:0,score2:0};this.callbacks={onFinish:null,onShareState:null,onFinishRound:null};this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,0,-.002)}));this.ui=(0,u.createUI)(this.scene);this.teacher1=p(this.scene,{player:1});this.teacher2=p(this.scene,{player:2});this.player1=(0,u.createPlayerAnswer)(this.scene,{player:1});this.player2=(0,u.createPlayerAnswer)(this.scene,{player:2});this.player1.hide();this.player2.hide();this.roundResult1=(0,u.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,u.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();this.gameSetup={seed:t,currentPlayer:i,level:n,gameIndex:r};this.root=e;this.randomizer=s.seedGen.create(t.toString());const o=new Entity;this.question=new TextShape("");this.question.withCollisions=0;this.question.vTextAlign="top";this.question.fontSize=5;o.addComponent(this.question);o.addComponent(new Transform({position:new Vector3(0,3.5,-.001)}));o.setParent(this.scene);engine.addSystem(this)}setStartTime(e){this.state.startTime=e}setRoundStartTime(e){void 0;this.state.roundStartTime=e}onClickAnswer(e){if(this.state.blocked||!this.state.started)return;this.state.blocked=1;(0,i.playOnce)("swing");const t=this["player"+this.gameSetup.currentPlayer];t.show();t.wrapperEntity.getComponent(Transform).position.set(this.answersT[e].position.x+(1===this.gameSetup.currentPlayer?-.2:.2),this.answersT[e].position.y,this.answersT[e].position.z);const n=this.answers[e].value===this.answers[this.solutionIndex].value;t.setSprite(n);const r=(0,a.getTimeSinceStart)(0===this.state.round?this.state.startTime:this.state.lastRoundStartTime),o=n?r:999999999-r;this.callbacks.onShareState({type:"election",player:this.gameSetup.currentPlayer,index:e,time:o,timeSinceStart:r,round:this.state.round});this.ui.updateTime({player:this.gameSetup.currentPlayer,time:r});if(this.state.round<l-1){this.callbacks.onFinishRound({player:this.gameSetup.currentPlayer,time:o,round:this.state.round,isWinner:n,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round});this.state.waitingRound=1}else this.callbacks.onFinish({player:this.gameSetup.currentPlayer,time:o,round:this.state.round,isWinner:n,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round})}init(){(0,i.playLoop)("money",{volume:.5});this.state.initialized=1;(0,o.updateSpritePanel)({uvs:(0,c.getSpriteUv)(3,0,192,128)});(0,o.showSpritePanel)();this.scene.setParent(this.root)}block(){this.state.blocked=1}destroy(){Object.keys(this.callbacks).forEach(e=>{this.callbacks[e]=null});(0,i.stopSound)("money");(0,o.hideSpritePanel)();this.scene.setParent(null);engine.removeEntity(this.scene)}start(){this.ui.hideTime();const e=Math.floor(50*this.randomizer.random()),t=Math.floor(50*this.randomizer.random());this.question.value=`${e} + ${t}`;this.state.started=1;const n=e+t,i=this.solutionIndex=Math.floor(6*this.randomizer.random()),r=n-1,o=this.getRandomIntExcept(0,5,[i]),s=n-10,a=this.getRandomIntExcept(0,5,[i,o]);this.answers=Array(6).fill(null);this.answersT=Array(6).fill(null);const c=[],u=new PlaneShape,l=new Material;l.albedoColor=new Color4(1,1,1,.05);this.answers.forEach((e,t)=>{const h=new Entity,d=new Entity;u.withCollisions=0;d.addComponent(u);d.addComponent(l);this.answers[t]=new TextShape;this.answers[t].withCollisions=0;this.answers[t].fontSize=3;h.addComponent(this.answers[t]);this.answers[t].value=c[t]=t===i?n:t===o?r:t===a?s:this.getRandomIntExcept(0,100,c);h.addComponent(new Transform({position:new Vector3(0,0,-.01)}));this.answersT[t]=new Transform({position:new Vector3(0===t||3===t?-1:1===t||4===t?0:1,t<3?2.5:1.5,0),scale:new Vector3(.9,.9,.9)});d.addComponent(this.answersT[t]);d.addComponent(new OnClick(()=>{this.onClickAnswer(t)}));d.setParent(this.scene);h.setParent(d)})}startRound(){this.state.round++;this.roundResult1.hide();this.roundResult2.hide();this.ui.hideTime();this.player1.hide();this.player2.hide();this.question.value="";this.state.lastRoundStartTime=this.state.roundStartTime;this.state.roundStartTime=Number.MAX_VALUE;this.state.waitingRound=0;this.answers.forEach((e,t)=>{this.answers[t].value=""});this.question.value="";this.teacher1.uvs=(0,c.getSpriteUv)(1,d,64,64);this.teacher2.uvs=(0,c.getSpriteUv)(1,d,64,64);setTimeout(()=>{this.gameSetup.currentPlayer&&(this.state.blocked=0);const e=Math.floor(50*this.randomizer.random()),t=Math.floor(50*this.randomizer.random());this.question.value=`${e} + ${t}`;const n=e+t,i=this.solutionIndex=Math.floor(6*this.randomizer.random()),r=n-1,o=this.getRandomIntExcept(0,5,[i]),s=n-10,a=this.getRandomIntExcept(0,5,[i,o]),c=[];this.answers.forEach((e,t)=>{this.answers[t].value=c[t]=t===i?n:t===o?r:t===a?s:this.getRandomIntExcept(0,100,c)})},500)}update(e){if(this.state.initialized)if(!this.state.waitingRound&&!this.state.started&&Date.now()>=this.state.startTime){void 0;this.start()}else this.state.started&&this.state.waitingRound&&Date.now()>=this.state.roundStartTime?this.startRound():Date.now()>=this.state.roundStartTime}finish(e){const{winner:t}=e,n=1===t?2:1;this.state.blocked=1;this["teacher"+t].uvs=(0,c.getSpriteUv)(3,d,64,64);this["teacher"+n].uvs=(0,c.getSpriteUv)(2,d,64,64);t===this.gameSetup.currentPlayer?(0,i.playOnce)("wow"):(0,i.playOnce)("fail");this.roundResult1.show();this.roundResult2.show();this["roundResult"+t].update(1);this["roundResult"+n].update(0)}finishRound({winner:e}){void 0;this.state.blocked=1;this.state["score"+e]+=1;this.ui.updateScore({player:e,score:this.state["score"+e]});const t=1===e?2:1;void 0;this["teacher"+e].uvs=(0,c.getSpriteUv)(3,d,64,64);this["teacher"+t].uvs=(0,c.getSpriteUv)(2,d,64,64);e===this.gameSetup.currentPlayer?(0,i.playOnce)("wow"):(0,i.playOnce)("fail");this["roundResult"+e].update(1);this["roundResult"+t].update(0);this.roundResult1.show();this.roundResult2.show();this.state.waitingRound=1}onFinish(e){this.callbacks.onFinish=e}onFinishRound(e){this.callbacks.onFinishRound=e;return()=>this.callbacks.onFinishRound=null}shareState(e){const{player:t,index:n,timeSinceStart:i,time:r,round:o}=e;if(o!==this.state.round)return;const s=n===this.solutionIndex,a=this["player"+t];a.show();a.wrapperEntity.getComponent(Transform).position.set(this.answersT[n].position.x+(1===t?-.2:.2),this.answersT[n].position.y,this.answersT[n].position.z);a.setSprite(s);this.ui.updateTime({player:t,time:i})}onShareState(e){this.callbacks.onShareState=e}getRandomIntExcept(e,t,n){let i=e+Math.floor(this.randomizer.random()*(t+1-e));if(!n)return i;for(;~n.indexOf(i);)i=e+Math.floor(this.randomizer.random()*(t+1-e));return i}}t.MathGame=f;f.id="Math";f.instructions="Math\nClick the correct answer"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.DifferentGame=void 0;const i=n(4),r=n(3),o=n(1),s=n(0),a=n(2),c=n(5),u=n(6),l=n(10),h=192,d=(e,t,n)=>{const i=new Entity,r=new PlaneShape;let a=0;i.addComponent(r);i.addComponent(o.spriteMaterial);i.addComponent(new Transform({scale:new Vector3(1.9,1.9,1.9),position:new Vector3(0===t?-2:1===t?0:2,2,-.001)}));r.uvs=(0,s.getSpriteUv)(1,h,64,64);r.uvs=(0,s.getSpriteUv)(0,0,0,0);i.setParent(e);i.addComponent(new OnClick(()=>{n(t)}));return{setIndex:e=>{a=e;r.uvs=(0,s.getSpriteUv)(a,h,64,64)},getSpriteIndex:()=>a,hide:()=>{r.uvs=(0,s.getSpriteUv)(0,0,0,0)}}},p=5;class f{constructor(e,{seed:t,level:n,currentPlayer:o,gameIndex:s}){this.callbacks={onFinish:null,onShareState:null,onFinishRound:null};this.state={blocked:0,started:0,initialized:0,startTime:Number.MAX_VALUE,roundStartTime:Number.MAX_VALUE,lastRoundStartTime:Number.MAX_VALUE,waitingRound:0,round:0,finished:0,score1:0,score2:0,equalSpriteIndex:0,differentSpriteIndex:0,answerPositions:[1,0,0]};this.gameSetup={seed:t,currentPlayer:o,level:n,gameIndex:s};this.root=e;this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,0,-.002)}));this.ui=(0,i.createUI)(this.scene);this.player1=(0,i.createPlayerAnswer)(this.scene,{player:1});this.player2=(0,i.createPlayerAnswer)(this.scene,{player:2});this.player1.hide();this.player2.hide();void 0;this.randomizer=r.seedGen.create(t.toString());this.onClickAnswer=this.onClickAnswer.bind(this);this.answers=[0,1,2].map(e=>d(this.scene,e,this.onClickAnswer));engine.addSystem(this);o||(this.state.blocked=1)}onClickAnswer(e){if(this.state.blocked||!this.state.started)return;this.state.blocked=1;(0,a.playOnce)("swing");const t=!!this.state.answerPositions[e];void 0;const n=this["player"+this.gameSetup.currentPlayer];n.show();n.wrapperEntity.getComponent(Transform).position.set((0===e?-2:1===e?0:2)+(1===this.gameSetup.currentPlayer?-.5:.5),2,-.002);n.setSprite(t);const i=(0,l.getTimeSinceStart)(0===this.state.round?this.state.startTime:this.state.lastRoundStartTime),r=t?i:999999999-i;this.callbacks.onShareState({player:this.gameSetup.currentPlayer,isWinner:t,answerIndex:e,time:r,timeSinceStart:i,round:this.state.round});this.ui.updateTime({player:this.gameSetup.currentPlayer,time:i});if(this.state.round<p-1){this.callbacks.onFinishRound({player:this.gameSetup.currentPlayer,time:r,roundIndex:this.state.round,gameIndex:this.gameSetup.gameIndex,isWinner:t});this.state.waitingRound=1}else this.callbacks.onFinish({player:this.gameSetup.currentPlayer,time:r,roundIndex:this.state.round,gameIndex:this.gameSetup.gameIndex,isWinner:t})}init(){(0,u.updateTextPanel)({value:"Which is different?",color:Color3.Black()});(0,a.playLoop)("money",{volume:.5});this.state.initialized=1;(0,c.updateSpritePanel)({uvs:(0,s.getSpriteUv)(9,0,192,128)});(0,c.showSpritePanel)();this.scene.setParent(this.root)}setStartTime(e){void 0;this.state.startTime=e}setRoundStartTime(e){this.state.roundStartTime=e}finish(e){const{winner:t}=e,n=1===t?2:1;this.state.blocked=1;t===this.gameSetup.currentPlayer?(0,a.playOnce)("wow"):(0,a.playOnce)("fail")}finishRound({winner:e}){this.state.blocked=1;this.state["score"+e]+=1;this.ui.updateScore({player:e,score:this.state["score"+e]});const t=1===e?2:1;e===this.gameSetup.currentPlayer?(0,a.playOnce)("wow"):(0,a.playOnce)("fail");this.state.waitingRound=1}reproduceRound(){this.gameSetup.currentPlayer&&(this.state.blocked=0);this.ui.hideTime();(0,u.updateTextPanel)({value:"Which is different?",color:Color3.Black()});this.state.equalSpriteIndex=this.getRandomIntExcept(1,9);this.state.differentSpriteIndex=this.getRandomIntExcept(1,9,[this.state.equalSpriteIndex]);void 0;this.state.answerPositions=m([1,0,0],this.randomizer.random);this.state.answerPositions.forEach((e,t)=>{e?this.answers[t].setIndex(this.state.differentSpriteIndex):this.answers[t].setIndex(this.state.equalSpriteIndex)})}start(){void 0;this.state.started=1;this.reproduceRound()}startRound(){this.state.round++;this.player1.hide();this.player2.hide();this.state.lastRoundStartTime=this.state.roundStartTime;this.state.roundStartTime=Number.MAX_VALUE;this.state.waitingRound=0;this.answers.forEach(e=>e.hide());setTimeout(()=>{this.reproduceRound()},500)}block(){this.state.blocked=1}update(e){this.state.initialized&&(!this.state.waitingRound&&!this.state.started&&Date.now()>=this.state.startTime?this.start():this.state.started&&this.state.waitingRound&&Date.now()>=this.state.roundStartTime&&this.startRound())}shareState({player:e,answerIndex:t,isWinner:n,timeSinceStart:i,round:r}){this.ui.updateTime({player:e,time:i});const o=this["player"+e],s=t;o.setSprite(n);o.show();o.wrapperEntity.getComponent(Transform).position.set((0===s?-2:1===s?0:2)+(1===e?-.5:.5),2,-.002)}destroy(){(0,a.stopSound)("money");(0,c.hideSpritePanel)();this.scene.setParent(null);engine.removeEntity(this.scene)}onFinish(e){this.callbacks.onFinish=e}onFinishRound(e){this.callbacks.onFinishRound=e}onShareState(e){this.callbacks.onShareState=e}getRandomIntExcept(e,t,n){let i=e+Math.floor(this.randomizer.random()*(t+1-e));if(!n)return i;for(;~n.indexOf(i);)i=e+Math.floor(this.randomizer.random()*(t+1-e));return i}}t.DifferentGame=f;f.id="Different";f.instructions="Different\nClick the image that is different";function m(e,t){for(var n=e.length,i,r;0!==n;){r=Math.floor(t()*n);i=e[n-=1];e[n]=e[r];e[r]=i}return e}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.FroggerGame=void 0;const i=n(73),r=n(3),o=n(4),s=n(2),a=n(6),c={UP:ActionButton.POINTER,LEFT:ActionButton.PRIMARY,RIGHT:ActionButton.SECONDARY};class u{constructor(e,{seed:t,currentPlayer:n,level:s=1,gameIndex:a}){this.callbacks={onFinish:null,onShareState:null};this.state={blocked:0,started:0,initialized:0,startTime:Number.MAX_VALUE,finished:0};this.root=e;this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,0,-.001)}));this.ui=(0,o.createUI)(this.scene);this.gameSetup={seed:t,currentPlayer:n,level:s,gameIndex:a};this.randomizer=r.seedGen.create(t.toString());this.screen1=(0,i.createScreen)(this.scene,{player:1,seed:t});this.screen2=(0,i.createScreen)(this.scene,{player:2,seed:t});this.roundResult1=(0,o.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,o.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();n&&this["screen"+n].onStateChange(e=>{this.ui.updateScore({score:e.score,player:n});const{x:t,y:i,z:r}=e.frogPosition;this.callbacks.onShareState(Object.assign(Object.assign({},e),{player:n,frogPosition:{x:t,y:i,z:r},takenSammiches:e.takenSammiches}));void 0;if(5===e.score&&!this.state.finished){const e=Date.now()-this.state.startTime;this.block();n&&this["screen"+n].block();this.state.finished=1;this.callbacks.onFinish({isWinner:1,time:e,player:n,gameIndex:this.gameSetup.gameIndex,roundIndex:0})}});engine.addSystem(this);this.up=this.up.bind(this);this.left=this.left.bind(this);this.right=this.right.bind(this)}setStartTime(e){this.state.startTime=e}getPlayerScreen(e){return this["screen"+e]}init(){this.state.initialized=1;this.scene.setParent(this.root);(0,s.playLoop)("race",{volume:.5})}start(){void 0;this.state.started=1;if(this.gameSetup.currentPlayer){Input.instance.subscribe("BUTTON_DOWN",c.UP,0,this.up);Input.instance.subscribe("BUTTON_DOWN",c.LEFT,0,this.left);Input.instance.subscribe("BUTTON_DOWN",c.RIGHT,0,this.right)}}up(){var e;this.state.started&&!this.state.blocked&&(null===(e=this.getPlayerScreen(this.gameSetup.currentPlayer))||void 0===e?void 0:e.up())}left(){var e;this.state.started&&!this.state.blocked&&(null===(e=this.getPlayerScreen(this.gameSetup.currentPlayer))||void 0===e?void 0:e.left())}right(){var e;this.state.started&&!this.state.blocked&&(null===(e=this.getPlayerScreen(this.gameSetup.currentPlayer))||void 0===e?void 0:e.right())}update(e){if(this.state.initialized)if(!this.state.started&&Date.now()-4e3>=this.state.startTime)this.start();else{this.state.started&&this.getPlayerScreen(1).updateScreen(e,1===this.gameSetup.currentPlayer);this.state.started&&this.getPlayerScreen(2).updateScreen(e,2===this.gameSetup.currentPlayer)}}block(){this.state.blocked=1;this.gameSetup.currentPlayer&&this["screen"+this.gameSetup.currentPlayer].block()}destroy(){void 0;(0,s.stopSound)("race");(0,a.updateTextPanel)({value:""});Input.instance.unsubscribe("BUTTON_DOWN",c.UP,this.up);Input.instance.unsubscribe("BUTTON_DOWN",c.LEFT,this.left);Input.instance.unsubscribe("BUTTON_DOWN",c.RIGHT,this.right);this.scene.setParent(null);engine.removeEntity(this.scene);engine.removeSystem(this)}shareState({score:e,player:t,frogPosition:n,takenSammiches:i}){void 0;const{x:r,y:o,z:s}=n||{};this.ui.updateScore({score:e,player:t});this["screen"+t].setFrogPosition(r,o,s);this["screen"+t].setTakenSammiches(i)}finish({winner:e}){void 0;const t=1===e?2:1;this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}}t.FroggerGame=u;u.id="Frogger";u.instructions="cross the roads and\ntake all sammiches\npressing E F and CLICK"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.InvadersGame=void 0;const i=n(2),r=n(3),o=n(4),s=n(75),a=n(6),c={CLICK:ActionButton.POINTER,LEFT:ActionButton.PRIMARY,RIGHT:ActionButton.SECONDARY},u=8e4;class l{constructor(e,{seed:t,level:n,currentPlayer:i,gameIndex:a}){this.state={blocked:0,started:0,initialized:0,startTime:Number.MAX_VALUE,finished:0};this.callbacks={onFinish:null,onShareState:null,onFinishRound:null};this.root=e;this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,0,-.001)}));this.gameSetup={seed:t,currentPlayer:i,level:n,gameIndex:a};this.randomizer=r.seedGen.create(t.toString());this.screen1=(0,s.createScreen)(this.scene,{player:1,seed:t});this.screen2=(0,s.createScreen)(this.scene,{player:2,seed:t});this.ui=(0,o.createUI)(this.scene);this.roundResult1=(0,o.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,o.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();i&&(this.unsubscribeStateChange=this["screen"+i].onStateChange(e=>{this.ui.updateScore({score:e.score,player:i});const{x:t,y:n,z:r}=e.position;this.callbacks.onShareState(Object.assign(Object.assign({},e),{player:i,position:{x:t,y:n,z:r}}))}));engine.addSystem(this);this.click=this.click.bind(this);this.left=this.left.bind(this);this.right=this.right.bind(this);this.clickUp=this.clickUp.bind(this);this.leftUp=this.leftUp.bind(this);this.rightUp=this.rightUp.bind(this)}setStartTime(e){this.state.startTime=e}getPlayerScreen(e){return this["screen"+e]}init(){this.state.initialized=1;this.scene.setParent(this.root)}start(){void 0;this.state.started=1;(0,i.playLoop)("music1");if(this.gameSetup.currentPlayer){Input.instance.subscribe("BUTTON_DOWN",c.CLICK,0,this.click);Input.instance.subscribe("BUTTON_DOWN",c.LEFT,0,this.left);Input.instance.subscribe("BUTTON_DOWN",c.RIGHT,0,this.right);Input.instance.subscribe("BUTTON_UP",c.CLICK,0,this.clickUp);Input.instance.subscribe("BUTTON_UP",c.LEFT,0,this.leftUp);Input.instance.subscribe("BUTTON_UP",c.RIGHT,0,this.rightUp)}}click(){if(this.state.started&&!this.state.blocked&&this.gameSetup.currentPlayer){this.getPlayerScreen(this.gameSetup.currentPlayer).getScreenState().keyPressed.click=1;this.getPlayerScreen(this.gameSetup.currentPlayer).shoot()}}left(){this.state.started&&!this.state.blocked&&this.gameSetup.currentPlayer&&(this.getPlayerScreen(this.gameSetup.currentPlayer).getScreenState().keyPressed.e=1)}right(){this.state.started&&!this.state.blocked&&this.gameSetup.currentPlayer&&(this.getPlayerScreen(this.gameSetup.currentPlayer).getScreenState().keyPressed.f=1)}clickUp(){this.state.started&&!this.state.blocked&&this.gameSetup.currentPlayer&&(this.getPlayerScreen(this.gameSetup.currentPlayer).getScreenState().keyPressed.click=0)}leftUp(){this.state.started&&!this.state.blocked&&this.gameSetup.currentPlayer&&(this.getPlayerScreen(this.gameSetup.currentPlayer).getScreenState().keyPressed.e=0)}rightUp(){this.state.started&&!this.state.blocked&&this.gameSetup.currentPlayer&&(this.getPlayerScreen(this.gameSetup.currentPlayer).getScreenState().keyPressed.f=0)}update(e){if(!this.state.initialized||this.state.finished)return;if(!this.state.started&&Date.now()-4e3>=this.state.startTime){this.start();return}const t=Date.now()-this.state.startTime,n=1e3*Math.floor(t/1e3);if(this.state.started){this.getPlayerScreen(1).updateScreen(e,1===this.gameSetup.currentPlayer);this.getPlayerScreen(2).updateScreen(e,2===this.gameSetup.currentPlayer);this.ui.updateTime({player:1,time:n});this.ui.updateTime({player:2,time:n})}if(this.state.started&&t>u){void 0;this.state.finished=1;this.callbacks.onFinish({isWinner:1,time:t,score:this["screen"+this.gameSetup.currentPlayer].getScreenState().score,player:this.gameSetup.currentPlayer,gameIndex:this.gameSetup.gameIndex,roundIndex:0})}}block(){this.state.blocked=1;this.gameSetup.currentPlayer&&this["screen"+this.gameSetup.currentPlayer].block()}destroy(){this.unsubscribeStateChange&&this.unsubscribeStateChange();this.unsubscribeStateChange=null;(0,i.stopSound)("race");(0,a.updateTextPanel)({value:""});Input.instance.unsubscribe("BUTTON_DOWN",c.CLICK,this.click);Input.instance.unsubscribe("BUTTON_DOWN",c.LEFT,this.left);Input.instance.unsubscribe("BUTTON_DOWN",c.RIGHT,this.right);Input.instance.unsubscribe("BUTTON_UP",c.CLICK,this.clickUp);Input.instance.unsubscribe("BUTTON_UP",c.LEFT,this.leftUp);Input.instance.unsubscribe("BUTTON_UP",c.RIGHT,this.rightUp);this.scene.setParent(null);engine.removeEntity(this.scene);engine.removeSystem(this)}shareState({score:e,player:t,position:n}){const{x:i,y:r,z:o}=n||{};this.ui.updateScore({score:e,player:t});this["screen"+t].setPosition(i,r,o)}finish({winner:e}){(0,i.stopSound)("music1");void 0;const t=1===e?2:1;this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}}t.InvadersGame=l;l.id="Invaders";l.instructions="Beat as much invaders as possible\nE/F move sides, CLICK shoots."},function(e,t){function n(e,t){t.headers=e.headers||{};t.statusMessage=e.statusText;t.statusCode=e.status;t.data=e.response}t.send=function(e,t,i){return new Promise((function(r,o){i=i||{};var s,a,c,u,l=new XMLHttpRequest,h=i.headers||{};i.timeout&&(l.timeout=i.timeout);l.ontimeout=l.onerror=function(e){e.timeout="timeout"==e.type;o(e)};l.open(e,t.href||t);l.onload=function(){u=l.getAllResponseHeaders().trim().split(/[\r\n]+/);n(l,l);for(;c=u.shift();){c=c.split(": ");l.headers[c.shift().toLowerCase()]=c.join(": ")}if((c=l.headers["content-type"])&&~c.indexOf("application/json"))try{l.data=JSON.parse(l.data,i.reviver)}catch(e){n(l,e);return o(e)}(l.status>=400?o:r)(l)};if((a=i.body)&&"object"==typeof a){h["content-type"]="application/json";a=JSON.stringify(a)}l.withCredentials=!!i.withCredentials;for(s in h)l.setRequestHeader(s,h[s]);l.send(a)}))};t.get=t.send.bind(t.send,"GET");t.post=t.send.bind(t.send,"POST");t.patch=t.send.bind(t.send,"PATCH");t.del=t.send.bind(t.send,"DELETE");t.put=t.send.bind(t.send,"PUT")},function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);Object.defineProperty(e,i,{enumerable:1,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n);e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:1,value:t})}:function(e,t){e["default"]=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:1});t.Room=void 0;var s=o(n(43)),a=n(83),c=n(84),u=n(85),l=n(44),h=n(45),d=o(n(46)),p=o(n(47)),f=function(){function e(e,t){var n=this;this.onStateChange=a.createSignal();this.onError=a.createSignal();this.onLeave=a.createSignal();this.onJoin=a.createSignal();this.hasJoined=0;this.onMessageHandlers=c.createNanoEvents();this.id=null;this.name=e;if(t){this.serializer=new(l.getSerializer("schema"));this.rootSchema=t;this.serializer.state=new t}this.onError((function(e,t){}));this.onLeave((function(){return n.removeAllListeners()}))}e.prototype.connect=function(e){var t=this;this.connection=new u.Connection(e,0);this.connection.reconnectEnabled=0;this.connection.onmessage=this.onMessageCallback.bind(this);this.connection.onclose=function(e){if(t.hasJoined){t.onLeave.invoke(e.code);t.destroy()}else{void 0;t.onError.invoke(e.code,e.reason)}};this.connection.onerror=function(e){void 0;t.onError.invoke(e.code,e.reason)};this.connection.open()};e.prototype.leave=function(e){void 0===e&&(e=1);this.connection?e?this.connection.send([h.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(4e3)};e.prototype.onMessage=function(e,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(e),t)};e.prototype.send=function(e,t){var n=[h.Protocol.ROOM_DATA],i;"string"==typeof e?d.string(n,e):d.number(n,e);if(void 0!==t){var r=s.encode(t);(i=new Uint8Array(n.length+r.byteLength)).set(new Uint8Array(n),0);i.set(new Uint8Array(r),n.length)}else i=new Uint8Array(n);this.connection.send(i.buffer)};Object.defineProperty(e.prototype,"state",{get:function(){return this.serializer.getState()},enumerable:0,configurable:1});e.prototype.listen=function(e,t,n){if("schema"!==this.serializerId){this.serializerId;return this.serializer.api.listen(e,t,n)}void 0};e.prototype.removeListener=function(e){return this.serializer.api.removeListener(e)};e.prototype.removeAllListeners=function(){this.onJoin.clear();this.onStateChange.clear();this.onError.clear();this.onLeave.clear();this.onMessageHandlers.events={}};e.prototype.onMessageCallback=function(e){var t=Array.from(new Uint8Array(e.data)),n=t[0];if(n===h.Protocol.JOIN_ROOM){var i=1;this.serializerId=h.utf8Read(t,i);i+=h.utf8Length(this.serializerId);if(!this.serializer){var r=l.getSerializer(this.serializerId);this.serializer=new r}t.length>i&&this.serializer.handshake&&this.serializer.handshake(t,{offset:i});this.hasJoined=1;this.onJoin.invoke();this.connection.send([h.Protocol.JOIN_ROOM])}else if(n===h.Protocol.ERROR){var o={offset:1},a=p.number(t,o),c=p.string(t,o);this.onError.invoke(a,c)}else if(n===h.Protocol.LEAVE_ROOM)this.leave();else if(n===h.Protocol.ROOM_DATA_SCHEMA){var u={offset:1},d,f,c;(c=new(f=this.serializer.getState().constructor._context.get(p.number(t,u)))).decode(t,u);this.dispatchMessage(f,c)}else if(n===h.Protocol.ROOM_STATE){t.shift();this.setState(t)}else if(n===h.Protocol.ROOM_STATE_PATCH){t.shift();this.patch(t)}else if(n===h.Protocol.ROOM_DATA){var m={offset:1},f=p.stringCheck(t,m)?p.string(t,m):p.number(t,m),c=t.length>m.offset?s.decode(e.data,m.offset):void 0;this.dispatchMessage(f,c)}};e.prototype.setState=function(e){this.serializer.setState(e);this.onStateChange.invoke(this.serializer.getState())};e.prototype.patch=function(e){this.serializer.patch(e);this.onStateChange.invoke(this.serializer.getState())};e.prototype.dispatchMessage=function(e,t){var n=this.getMessageHandlerKey(e);this.onMessageHandlers.events[n]?this.onMessageHandlers.emit(n,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",e,t):void 0};e.prototype.destroy=function(){this.serializer&&this.serializer.teardown()};e.prototype.getMessageHandlerKey=function(e){switch(typeof e){case"function":return"$"+e._typeid;case"string":return e;case"number":return"i"+e;default:throw new Error("invalid message type.")}};return e}();t.Room=f},function(e,t,n){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});t.encode=t.decode=void 0;var r=i(n(81)),o=i(n(82));t.decode=r.default;t.encode=o.default},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getSerializer=t.registerSerializer=void 0;var i={};function r(e,t){i[e]=t}t.registerSerializer=r;function o(e){var t=i[e];if(!t)throw new Error("missing serializer: "+e);return t}t.getSerializer=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.utf8Length=t.utf8Read=t.ErrorCode=t.Protocol=void 0;var i,r;(function(e){e[e["HANDSHAKE"]=9]="HANDSHAKE";e[e["JOIN_ROOM"]=10]="JOIN_ROOM";e[e["ERROR"]=11]="ERROR";e[e["LEAVE_ROOM"]=12]="LEAVE_ROOM";e[e["ROOM_DATA"]=13]="ROOM_DATA";e[e["ROOM_STATE"]=14]="ROOM_STATE";e[e["ROOM_STATE_PATCH"]=15]="ROOM_STATE_PATCH";e[e["ROOM_DATA_SCHEMA"]=16]="ROOM_DATA_SCHEMA"})(i=t.Protocol||(t.Protocol={}));(function(e){e[e["MATCHMAKE_NO_HANDLER"]=4210]="MATCHMAKE_NO_HANDLER";e[e["MATCHMAKE_INVALID_CRITERIA"]=4211]="MATCHMAKE_INVALID_CRITERIA";e[e["MATCHMAKE_INVALID_ROOM_ID"]=4212]="MATCHMAKE_INVALID_ROOM_ID";e[e["MATCHMAKE_UNHANDLED"]=4213]="MATCHMAKE_UNHANDLED";e[e["MATCHMAKE_EXPIRED"]=4214]="MATCHMAKE_EXPIRED";e[e["AUTH_FAILED"]=4215]="AUTH_FAILED";e[e["APPLICATION_ERROR"]=4216]="APPLICATION_ERROR"})(r=t.ErrorCode||(t.ErrorCode={}));function o(e,t){for(var n=e[t++],i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536){r-=65536;i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))}else i+=String.fromCharCode(r)}else i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else i+=String.fromCharCode((31&a)<<6|63&e[++o]);else i+=String.fromCharCode(a)}return i}t.utf8Read=o;function s(e){void 0===e&&(e="");for(var t=0,n=0,i=0,r=e.length;i<r;i++)if((t=e.charCodeAt(i))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{i++;n+=4}return n+1}t.utf8Length=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.number=t.string=t.boolean=t.writeFloat64=t.writeFloat32=t.float64=t.float32=t.uint64=t.int64=t.uint32=t.int32=t.uint16=t.int16=t.uint8=t.int8=t.utf8Write=void 0;function i(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)if((t=e.charCodeAt(i))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{i++;n+=4}return n}function r(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)if((i=n.charCodeAt(r))<128)e[t++]=i;else if(i<2048){e[t++]=192|i>>6;e[t++]=128|63&i}else if(i<55296||i>=57344){e[t++]=224|i>>12;e[t++]=128|i>>6&63;e[t++]=128|63&i}else{r++;i=65536+((1023&i)<<10|1023&n.charCodeAt(r));e[t++]=240|i>>18;e[t++]=128|i>>12&63;e[t++]=128|i>>6&63;e[t++]=128|63&i}}t.utf8Write=r;function o(e,t){e.push(255&t)}t.int8=o;function s(e,t){e.push(255&t)}t.uint8=s;function a(e,t){e.push(255&t);e.push(t>>8&255)}t.int16=a;function c(e,t){e.push(255&t);e.push(t>>8&255)}t.uint16=c;function u(e,t){e.push(255&t);e.push(t>>8&255);e.push(t>>16&255);e.push(t>>24&255)}t.int32=u;function l(e,t){var n=t>>24,i=t>>16,r=t>>8,o=t;e.push(255&o);e.push(255&r);e.push(255&i);e.push(255&n)}t.uint32=l;function h(e,t){var n=Math.floor(t/Math.pow(2,32)),i;l(e,t>>>0);l(e,n)}t.int64=h;function d(e,t){var n=t/Math.pow(2,32)>>0,i;l(e,t>>>0);l(e,n)}t.uint64=d;function p(e,t){S(e,t)}t.float32=p;function f(e,t){b(e,t)}t.float64=f;var m=1,g=new Int32Array(2),y=new Float32Array(g.buffer),v=new Float64Array(g.buffer);function S(e,t){y[0]=t;u(e,g[0])}t.writeFloat32=S;function b(e,t){v[0]=t;u(e,g[m?0:1]);u(e,g[m?1:0])}t.writeFloat64=b;function w(e,t){return s(e,t?1:0)}t.boolean=w;function T(e,t){t||(t="");var n=i(t),o=0;if(n<32){e.push(160|n);o=1}else if(n<256){e.push(217);s(e,n);o=2}else if(n<65536){e.push(218);c(e,n);o=3}else{if(!(n<4294967296))throw new Error("String too long");e.push(219);l(e,n);o=5}r(e,e.length,t);return o+n}t.string=T;function C(e,t){if(isNaN(t))return C(e,0);if(!isFinite(t))return C(e,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER);if(t!==(0|t)){e.push(203);b(e,t);return 9}if(t>=0){if(t<128){s(e,t);return 1}if(t<256){e.push(204);s(e,t);return 2}if(t<65536){e.push(205);c(e,t);return 3}if(t<4294967296){e.push(206);l(e,t);return 5}e.push(207);d(e,t);return 9}if(t>=-32){e.push(224|t+32);return 1}if(t>=-128){e.push(208);o(e,t);return 2}if(t>=-32768){e.push(209);a(e,t);return 3}if(t>=-2147483648){e.push(210);u(e,t);return 5}e.push(211);h(e,t);return 9}t.number=C},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.switchStructureCheck=t.arrayCheck=t.numberCheck=t.number=t.stringCheck=t.string=t.boolean=t.readFloat64=t.readFloat32=t.uint64=t.int64=t.float64=t.float32=t.uint32=t.int32=t.uint16=t.int16=t.uint8=t.int8=void 0;var i=n(7);function r(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e[o];if(0!=(128&a))if(192!=(224&a))if(224!=(240&a))if(240!=(248&a))void 0;else if((r=(7&a)<<18|(63&e[++o])<<12|(63&e[++o])<<6|(63&e[++o])<<0)>=65536){r-=65536;i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))}else i+=String.fromCharCode(r);else i+=String.fromCharCode((15&a)<<12|(63&e[++o])<<6|(63&e[++o])<<0);else i+=String.fromCharCode((31&a)<<6|63&e[++o]);else i+=String.fromCharCode(a)}return i}function o(e,t){return s(e,t)<<24>>24}t.int8=o;function s(e,t){return e[t.offset++]}t.uint8=s;function a(e,t){return c(e,t)<<16>>16}t.int16=a;function c(e,t){return e[t.offset++]|e[t.offset++]<<8}t.uint16=c;function u(e,t){return e[t.offset++]|e[t.offset++]<<8|e[t.offset++]<<16|e[t.offset++]<<24}t.int32=u;function l(e,t){return u(e,t)>>>0}t.uint32=l;function h(e,t){return S(e,t)}t.float32=h;function d(e,t){return b(e,t)}t.float64=d;function p(e,t){var n=l(e,t),i;return u(e,t)*Math.pow(2,32)+n}t.int64=p;function f(e,t){var n=l(e,t),i;return l(e,t)*Math.pow(2,32)+n}t.uint64=f;var m=1,g=new Int32Array(2),y=new Float32Array(g.buffer),v=new Float64Array(g.buffer);function S(e,t){g[0]=u(e,t);return y[0]}t.readFloat32=S;function b(e,t){g[m?0:1]=u(e,t);g[m?1:0]=u(e,t);return v[0]}t.readFloat64=b;function w(e,t){return s(e,t)>0}t.boolean=w;function T(e,t){var n=e[t.offset++],i;n<192?i=31&n:217===n?i=s(e,t):218===n?i=c(e,t):219===n&&(i=l(e,t));var o=r(e,t.offset,i);t.offset+=i;return o}t.string=T;function C(e,t){var n=e[t.offset];return n<192&&n>160||217===n||218===n||219===n}t.stringCheck=C;function _(e,t){var n=e[t.offset++];return n<128?n:202===n?S(e,t):203===n?b(e,t):204===n?s(e,t):205===n?c(e,t):206===n?l(e,t):207===n?f(e,t):208===n?o(e,t):209===n?a(e,t):210===n?u(e,t):211===n?p(e,t):n>223?-1*(255-n+1):void 0}t.number=_;function P(e,t){var n=e[t.offset];return n<128||n>=202&&n<=211}t.numberCheck=P;function E(e,t){return e[t.offset]<160}t.arrayCheck=E;function I(e,t){return e[t.offset-1]===i.SWITCH_TO_STRUCTURE&&(e[t.offset]<128||e[t.offset]>=202&&e[t.offset]<=211)}t.switchStructureCheck=I},function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);Object.defineProperty(e,i,{enumerable:1,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n);e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:1,value:t})}:function(e,t){e["default"]=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);r(t,e);return t},s=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(o=2&s[0]?r["return"]:s[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;(r=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;r=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];r=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}};Object.defineProperty(t,"__esModule",{value:1});t.Auth=t.Platform=void 0;var c=o(n(41)),u=n(89),l="colyseus-auth-token",h;(function(e){e["ios"]="ios";e["android"]="android"})(h=t.Platform||(t.Platform={}));var d=function(){function e(e){var t=this;this._id=void 0;this.username=void 0;this.displayName=void 0;this.avatarUrl=void 0;this.isAnonymous=void 0;this.email=void 0;this.lang=void 0;this.location=void 0;this.timezone=void 0;this.metadata=void 0;this.devices=void 0;this.facebookId=void 0;this.twitterId=void 0;this.googleId=void 0;this.gameCenterId=void 0;this.steamId=void 0;this.friendIds=void 0;this.blockedUserIds=void 0;this.createdAt=void 0;this.updatedAt=void 0;this.token=void 0;this.endpoint=e.replace("ws","http");u.getItem(l,(function(e){return t.token=e}))}Object.defineProperty(e.prototype,"hasToken",{get:function(){return!!this.token},enumerable:0,configurable:1});e.prototype.login=function(e){void 0===e&&(e={});return s(this,void 0,void 0,(function(){var t,n,i;return a(this,(function(r){switch(r.label){case 0:t=Object.assign({},e);this.hasToken&&(t.token=this.token);return[4,this.request("post","/auth",t)];case 1:n=r.sent();this.token=n.token;u.setItem(l,this.token);for(i in n)this.hasOwnProperty(i)&&(this[i]=n[i]);this.registerPingService();return[2,this]}}))}))};e.prototype.save=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone})];case 1:e.sent();return[2,this]}}))}))};e.prototype.getFriends=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/all")];case 1:return[2,e.sent()]}}))}))};e.prototype.getOnlineFriends=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/online")];case 1:return[2,e.sent()]}}))}))};e.prototype.getFriendRequests=function(){return s(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.request("get","/friends/requests")];case 1:return[2,e.sent()]}}))}))};e.prototype.sendFriendRequest=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.acceptFriendRequest=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.declineFriendRequest=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("del","/friends/requests",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.blockUser=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("post","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.unblockUser=function(e){return s(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.request("put","/friends/block",{userId:e})];case 1:return[2,t.sent()]}}))}))};e.prototype.request=function(e,t,n,i,r){void 0===n&&(n={});void 0===r&&(r={});return s(this,void 0,void 0,(function(){var o,s,u,l;return a(this,(function(a){switch(a.label){case 0:r["Accept"]="application/json";this.hasToken&&(r["Authorization"]="Bearer "+this.token);o=[];for(s in n)o.push(s+"="+n[s]);u=o.length>0?"?"+o.join("&"):"";l={headers:r};i&&(l.body=i);return[4,c[e](""+this.endpoint+t+u,l)];case 1:return[2,a.sent().data]}}))}))};e.prototype.logout=function(){this.token=void 0;u.removeItem(l);this.unregisterPingService()};e.prototype.registerPingService=function(e){var t=this;void 0===e&&(e=15e3);this.unregisterPingService();this.keepOnlineInterval=setInterval((function(){return t.request("get","/auth")}),e)};e.prototype.unregisterPingService=function(){clearInterval(this.keepOnlineInterval)};return e}();t.Auth=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.CollectionSchema=void 0;var i=n(12),r=n(7),o=n(8),s=function(){function e(e){var t=this;this.$changes=new i.ChangeTree(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;e&&e.forEach((function(e){return t.add(e)}))}e.is=function(e){return void 0!==e["collection"]};e.prototype.add=function(e){var t=this.$refId++,n;void 0!==e["$changes"]&&e["$changes"].setParent(this,this.$changes.root,t);this.$changes.indexes[t]=t;this.$indexes.set(t,t);this.$items.set(t,e);this.$changes.change(t);return t};e.prototype.at=function(e){var t=Array.from(this.$items.keys())[e];return this.$items.get(t)};e.prototype.entries=function(){return this.$items.entries()};e.prototype.delete=function(e){for(var t=this.$items.entries(),n,i;(i=t.next())&&!i.done;)if(e===i.value[1]){n=i.value[0];break}if(void 0===n)return 0;this.$changes.delete(n);this.$indexes.delete(n);return this.$items.delete(n)};e.prototype.clear=function(e){var t=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){t.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:r.OPERATION.CLEAR});this.$changes.touchParents()};e.prototype.has=function(e){return Array.from(this.$items.values()).some((function(t){return t===e}))};e.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,i,r){return e(n,i,t)}))};e.prototype.values=function(){return this.$items.values()};Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:0,configurable:1});e.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};e.prototype.getIndex=function(e){return this.$indexes.get(e)};e.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};e.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};e.prototype.toArray=function(){return Array.from(this.$items.values())};e.prototype.toJSON=function(){var e=[];this.forEach((function(t,n){e.push("function"==typeof t["toJSON"]?t["toJSON"]():t)}));return e};e.prototype.clone=function(t){var n;if(t)n=Object.assign(new e,this);else{var i=new e;this.forEach((function(e){e["$changes"]?i.add(e["clone"]()):i.add(e)}))}return n};e.prototype.triggerAll=function(){o.Schema.prototype.triggerAll.apply(this)};return e}();t.CollectionSchema=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.SetSchema=void 0;var i=n(12),r=n(7),o=n(8),s=function(){function e(e){var t=this;this.$changes=new i.ChangeTree(this);this.$items=new Map;this.$indexes=new Map;this.$refId=0;e&&e.forEach((function(e){return t.add(e)}))}e.is=function(e){return void 0!==e["set"]};e.prototype.add=function(e){if(this.has(e))return 0;var t=this.$refId++,n;void 0!==e["$changes"]&&e["$changes"].setParent(this,this.$changes.root,t);this.$changes.indexes[t]=t;this.$indexes.set(t,t);this.$items.set(t,e);this.$changes.change(t);return t};e.prototype.entries=function(){return this.$items.entries()};e.prototype.delete=function(e){for(var t=this.$items.entries(),n,i;(i=t.next())&&!i.done;)if(e===i.value[1]){n=i.value[0];break}if(void 0===n)return 0;this.$changes.delete(n);this.$indexes.delete(n);return this.$items.delete(n)};e.prototype.clear=function(e){var t=this;this.$changes.discard(1,1);this.$changes.indexes={};this.$indexes.clear();e&&"string"!=typeof this.$changes.getType()&&this.$items.forEach((function(e){t.$changes.root.removeRef(e["$changes"].refId)}));this.$items.clear();this.$changes.operation({index:0,op:r.OPERATION.CLEAR});this.$changes.touchParents()};e.prototype.has=function(e){for(var t=this.$items.values(),n=0,i;(i=t.next())&&!i.done;)if(e===i.value){n=1;break}return n};e.prototype.forEach=function(e){var t=this;this.$items.forEach((function(n,i,r){return e(n,i,t)}))};e.prototype.values=function(){return this.$items.values()};Object.defineProperty(e.prototype,"size",{get:function(){return this.$items.size},enumerable:0,configurable:1});e.prototype.setIndex=function(e,t){this.$indexes.set(e,t)};e.prototype.getIndex=function(e){return this.$indexes.get(e)};e.prototype.getByIndex=function(e){return this.$items.get(this.$indexes.get(e))};e.prototype.deleteByIndex=function(e){var t=this.$indexes.get(e);this.$items.delete(t);this.$indexes.delete(e)};e.prototype.toArray=function(){return Array.from(this.$items.values())};e.prototype.toJSON=function(){var e=[];this.forEach((function(t,n){e.push("function"==typeof t["toJSON"]?t["toJSON"]():t)}));return e};e.prototype.clone=function(t){var n;if(t)n=Object.assign(new e,this);else{var i=new e;this.forEach((function(e){e["$changes"]?i.add(e["clone"]()):i.add(e)}))}return n};e.prototype.triggerAll=function(){o.Schema.prototype.triggerAll.apply(this)};return e}();t.SetSchema=s},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});const o=n(52),s=n(53),a=n(57),c=n(76),u=n(77),l=n(6),h=n(5),d=n(2),p=n(0),f=n(4),m=r(n(25)),g=n(16),y=n(103),v=n(17),S=n(104),b=n(1),w=n(105);engine["PRODI"]=1;const T=m.default.InvadersGame,C=2222222231;void 0;const _=(e,{lobbyRoom:t,trackSeed:n,minGames:r,alreadyStarted:o=0})=>i(void 0,void 0,void 0,(function*(){void 0;const i=yield(0,c.createSpectatorTrack)(e,{lobbyRoom:t,trackSeed:n,minGames:r,alreadyStarted:o})})),P=(e,{gameRoom:t,lobbyRoom:n,user:r,trackSeed:o,player:s,minGames:c})=>i(void 0,void 0,void 0,(function*(){const i=yield(0,a.createTrack)(e,{gameRoom:t,lobbyRoom:n,user:r,trackSeed:o,minGames:c});i.onScore((...e)=>{void 0});i.onFinish(()=>{void 0});t.state.onChange=e=>{void 0;if(t.state.player1&&t.state.player2&&t.state.minGames<=t.state.currentGameIndex&&t.state.score.player1!==t.state.score.player2){const e=(t.state.score.player1||0)>(t.state.score.player2||0)?1:2,i=1===e?2:1,r=`${n.state["player"+e].displayName}\npwned\n${n.state["player"+i].displayName}`;t.state.player1.skipEnd||t.state.player2.skipEnd?(0,l.updateTextPanel)({value:"One player still have to click\nto skip end screen.\n\n"+r}):(0,l.updateTextPanel)({value:"Players must click to skip end screen\n\n"+r})}![t.state.player1.readyNext,t.state.player2.readyNext].every(e=>e)&&(t.state.player1.readyNext||t.state.player2.readyNext)&&t.state["player"+s].readyNext?(0,l.updateTextPanel)({value:"Waiting for other player"}):"Waiting for other player"===(0,l.getTextPanelValue)()&&(0,l.updateTextPanel)({value:""})};t.onMessage("*",(...e)=>{void 0});const u=undefined;return()=>{t.dispose();t=null}}));let E;class I{constructor(e,t){this.state={countToCheckCamera:0};(()=>i(this,void 0,void 0,(function*(){const n=JSON.parse(t.host_data);void 0;const{position:i,rotation:r,scale:a,hideFrame:c,hideBoard:m,hideAd:I,soundDistance:O,showJoinVoice:R,voiceChannel:A,showScenario:x,serverWs:k,serverHttp:M}=n.sammichgame;log("mz__api__",e);const N=new u.Client(""+(k||g.WS_HOST));void 0;yield(0,f.sleep)(0);(0,b.loadTexture)();(0,d.loadSounds)();void 0;const D=(e.getUserData?yield e.getUserData():e.user.data)||"NO_USER",F=(e.getCurrentRealm?(yield e.getCurrentRealm()).displayName:e.server.realm.displayName)||"NO_REALM",U=(yield(0,S.getLand)())||"1,1",$=n.sammichgame.gameID?`${U.replace(",","_")}__${n.sammichgame.gameID.replace(",","_")}__${F.replace(",","_").replace("-","_")}`:`${U}__${e.hostId}__${F}`;void 0;(0,v.setHostData)({realm:F,land:U,gameID:$,position:i,rotation:r,scale:a,hideFrame:c,hideBoard:m,hideAd:I,soundDistance:O,showJoinVoice:R,voiceChannel:A,showScenario:x,serverWs:k,serverHttp:M});void 0;void 0;void 0;const j=new Entity;(0,l.createTextPanel)(j,"");(0,h.createSpritePanel)(j);const B=(0,w.createLinks)(j,j,{position:void 0});(0,h.updateSpritePanel)({uvs:(0,p.getSpriteUv)(1,0,192,128)});this.rootTransform=new Transform({position:new Vector3(i.x,i.y,i.z),scale:new Vector3(a.x,a.y,a.z)});this.rootTransform.rotation.setEuler(r.x,r.y,r.z);j.addComponent(this.rootTransform);engine.addEntity(j);const V=new Entity;V.addComponent(new Transform({position:new Vector3(0,2,-2)}));V.setParent(j);(0,d.addSoundsToEntity)(V);c||(0,o.createFrame)(j);I||(0,p.createSpriteEntity)(j,{position:new Vector3(.25,-.4,-.14),scale:new Vector3(6.5,.75,1),uvs:(0,p.getSpriteUv)(1,40,384,64)});E=(0,s.createLobbyControl)(j,{gameID:$,client:N,user:D,hideBoard:m});if(!engine["PRODI"]){(0,h.hideSpritePanel)();let e=new T(j,{seed:C,currentPlayer:2,level:1,gameIndex:0});e.setStartTime(Date.now()+1e3);e.onFinish(()=>{});e.onFinishRound&&e.onFinishRound(()=>{});e.onShareState(t=>{e.shareState(Object.assign(Object.assign({},t),{player:1,senderPlayer:1}))});e.init()}const z=(e,{trackSeed:t,player:n,minGames:i})=>{void 0;P(j,{gameRoom:e,lobbyRoom:E.getLobbyRoom(),user:D,trackSeed:t,player:n,minGames:i});E.getLobbyRoom().onMessage("PLAYER_LEFT",({displayName:e})=>{void 0;(0,y.showNotification)(e+" left the game")})};E.onPlayersFull(({lobbyRoom:e,trackSeed:t,minGames:n})=>{void 0;_(j,{lobbyRoom:E.getLobbyRoom(),trackSeed:t,minGames:n});E.getLobbyRoom().onMessage("PLAYER_LEFT",({displayName:e})=>{void 0;(0,y.showNotification)(e+" left the game")})});E.onGameRunning(({lobbyRoom:e,minGames:t})=>{void 0;_(j,{lobbyRoom:E.getLobbyRoom(),trackSeed:e.state.trackSeed,minGames:t,alreadyStarted:1});E.getLobbyRoom().onMessage("PLAYER_LEFT",({displayName:e})=>{void 0;(0,y.showNotification)(e+" left the game")})});E.onChangeState((e,t)=>{void 0;void 0;t.player1&&t.player1.userId||t.player2&&t.player2.userId?B.hide():B.show()});E.onCreate((e,{minGames:t})=>{void 0;e.onMessage("GAME_FULL",({trackSeed:n})=>z(e,{trackSeed:n,player:1,minGames:t}))});E.onJoin((e,{minGames:t})=>{void 0;e.onMessage("GAME_FULL",({trackSeed:n})=>z(e,{trackSeed:n,player:2,minGames:t}))});const L=""+(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||"");if(R){const e=new Entity,t=new GLTFShape(L+"models/joinVoice.glb");e.addComponent(new Transform({position:new Vector3(0,i.y-1.5,-13),scale:new Vector3(1.5,2,2)}));e.addComponent(t);e.addComponent(new OnPointerDown(()=>{openExternalURL(`https://meet.jit.si/${A}#config.startWithAudioMuted=true&config.startWithVideoMuted=true`)}));e.setParent(j)}if(x){const e=new Entity,t=new GLTFShape(L+"models/sammich-scene.glb"),n=0===r.y?0:90===r.y?-6:180===r.y?0:6,o=0===r.y?-6:90===r.y?0:180===r.y?6:0;e.addComponent(new Transform({position:new Vector3(i.x+n,0,i.z+o),rotation:Quaternion.Euler(r.x,r.y-180,r.z),scale:new Vector3(1,1,1)}));e.addComponent(t);engine.addEntity(e)}})))()}update(e){this.state.countToCheckCamera+=e;if(this.state.countToCheckCamera>=1){const{position:e,soundDistance:t}=(0,v.getHostData)(),n=t?{x1:e.x-t,x2:e.x+t,z1:e.z-t,z2:e.z+t}:{x1:0,x2:16,z1:0,z2:16};void 0;const{x:i,y:r,z:o}=Camera.instance.position;Camera.instance.position.x>=n.x1&&Camera.instance.position.x<=n.x2&&Camera.instance.position.z>=n.z1&&Camera.instance.position.z<=n.z2?(0,d.setTotalMute)(0):(0,d.setTotalMute)(1);this.state.countToCheckCamera=0}}refreshHost(e){if(!this.rootTransform)return;const{position:t,rotation:n,scale:i,gameID:r}=JSON.parse(e.host_data).sammichgame;this.rootTransform.position.set(t.x,t.y,t.z);this.rootTransform.rotation.setEuler(n.x,n.y,n.z);this.rootTransform.scale.set(i.x,i.y,i.z)}}t.default=I},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createFrame=void 0;const i=e=>{const t=""+(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||""),n=new GLTFShape(t+"models/frame.glb"),i=new Material;n.withCollisions=0;i.albedoColor=Color3.FromHexString("#333333");i.specularIntensity=.1;i.roughness=.9;i.metallic=.1;const r=new Transform({position:new Vector3(0,-.76,0)}),o=new Entity;o.addComponent(n);o.addComponent(i);o.addComponent(r);o.setParent(e)};t.createFrame=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createLobbyControl=void 0;const i=n(54),r=n(55),o=n(56),s=n(6),a=n(5),c=n(2),u=n(18),l=n(0),h=n(16),d=n(17);let p=null;const f={onCreate:null,onJoin:null,onPlayersFull:null,onChangeState:null,onMessage:null,onSpectatorMessage:null,onGameRunning:null};let m=1;const g=(e,{gameID:t,user:n,client:g,hideBoard:y})=>{const{serverHttp:v}=(0,d.getHostData)(),S=(0,i.createStartButtonPanel)(e);y||(0,o.createBoard)(e);S.showJoinButtonOn(()=>{var e,t,i;void 0;return p&&p.state&&p.state.initialized?(null===(e=p.state.player1)||void 0===e?void 0:e.userId)===n.userId?0:(null===(t=p.state.player1)||void 0===t?void 0:t.userId)&&!(null===(i=p.state.player2)||void 0===i?void 0:i.userId)?1:0:0});S.showCreateButtonOn(()=>{var e,t;void 0;return p&&p.state&&p.state.initialized?(null===(e=p.state.player1)||void 0===e?void 0:e.userId)?0:(null===(t=p.state.player1)||void 0===t?void 0:t.userId)?void 0:1:0});S.showCancelButtonOn(()=>{var e,t,i,r,o;void 0;return(null===(t=null===(e=null==p?void 0:p.state)||void 0===e?void 0:e.player1)||void 0===t?void 0:t.userId)&&(null===(i=p.state.player2)||void 0===i?void 0:i.userId)?0:p&&p.state&&p.state.initialized&&(null===(r=p.state.player1)||void 0===r?void 0:r.userId)?(null===(o=p.state.player1)||void 0===o?void 0:o.userId)&&p.state.player1.userId===n.userId?1:void 0:0});S.update();(0,r.joinOrCreateGameLobby)(g,{gameID:t,user:n}).then(i=>{(0,s.updateTextPanel)({value:"",color:Color3.FromHexString("#ffffff")});void 0;p=i.room;let r=null;p.onMessage("GAME_FULL",({trackSeed:e,minGames:t})=>{f.onPlayersFull({lobbyRoom:p,trackSeed:e,minGames:t})});p.state.player1.onChange=()=>{(0,o.updateBoard)(p)};p.state.player2.onChange=()=>{(0,o.updateBoard)(p)};p.state.onChange=t=>{var i,r,g,y,b,w,T;S.update();void 0;(0,o.updateBoard)(p);void 0;if((null===(i=p.state.player1)||void 0===i?void 0:i.userId)&&!(null===(r=p.state.player2)||void 0===r?void 0:r.userId)){(0,c.stopAllSounds)();if(C()){(0,u.reproduceVideo)(e,(v||h.HTTP_HOST)+"/public/output.mp4");(0,a.hideSpritePanel)()}else{(0,c.playLoop)("music2");(0,a.updateSpritePanel)({uvs:(0,l.getSpriteUv)(1,0,192,128)});(0,a.showSpritePanel)()}(0,s.updateTextPanel)({value:p.state.player1.displayName+" as player 1\nwaiting for someone to join",bottom:1,color:Color3.White(),hTextAlign:"left"})}if(!(null===(g=p.state.player1)||void 0===g?void 0:g.userId)&&!(null===(y=p.state.player2)||void 0===y?void 0:y.userId)&&engine["PRODI"]){(0,u.removeVideoPanel)();(0,a.updateSpritePanel)({uvs:(0,l.getSpriteUv)(1,0,192,128)});(0,a.showSpritePanel)();(null===(b=p.state.lastPlayer1)||void 0===b?void 0:b.displayName)?(0,s.updateTextPanel)({value:`${p.state.lastPlayer1.displayName} ${p.state.lastPlayer1.score} - ${p.state.lastPlayer2.score} ${p.state.lastPlayer2.displayName}`}):(0,s.updateTextPanel)({value:""});(0,c.stopAllSounds)()}if((null===(w=p.state.player1)||void 0===w?void 0:w.userId)&&(null===(T=p.state.player2)||void 0===T?void 0:T.userId)&&!_()&&(P()||m)){void 0;(0,c.stopAllSounds)();(0,s.updateTextPanel)({value:`${p.state.player1.displayName} and ${p.state.player2.displayName}\nare playing`});(0,a.updateSpritePanel)({uvs:(0,l.getSpriteUv)(9,0,192,128)});(0,a.showSpritePanel)();m&&f.onGameRunning({lobbyRoom:p,minGames:d})}m=0;f.onChangeState&&f.onChangeState(t,p.state);function C(){var e;return(null===(e=p.state.player1)||void 0===e?void 0:e.userId)&&p.state.player1.userId===n.userId}function _(){var e,t,i,r;return(null===(e=p.state.player1)||void 0===e?void 0:e.userId)&&(null===(t=p.state.player2)||void 0===t?void 0:t.userId)&&((null===(i=p.state.player1)||void 0===i?void 0:i.userId)===n.userId||(null===(r=p.state.player2)||void 0===r?void 0:r.userId)===n.userId)}function P(){const e=t.find(e=>"player2"===e.field)||{};return e.value&&!e.previousValue}function E(e){const t=I(e,"trackSeed");return t.value!=t.value}function I(e,t){return e.find(e=>e.field===t)}};p.state.onAdd=(e,t)=>{void 0};p.state.onRemove=(e,t)=>{void 0};const d=3;S.onRequestCreate(()=>{var e;(null===(e=p.state.player1)||void 0===e?void 0:e.userId)||i.requestCreate({gameID:t,user:n,minGames:d,lobbySessionId:p.sessionId}).then(({sessionId:e,gameRoom:t})=>{r=t;f.onCreate(t,{minGames:d})},()=>{void 0})});S.onRequestCancel(()=>{r&&r.leave()});S.onRequestJoin(()=>{var e;void 0;(null===(e=p.state.player2)||void 0===e?void 0:e.userId)||i.requestJoin({roomID:p.state.gameRoomID,gameID:t,user:n,lobbySessionId:p.sessionId}).then(({gameRoom:e})=>{r=e;f.onJoin(e,{minGames:d})},()=>{void 0})})},e=>{(0,s.updateTextPanel)({value:"Unable to connect to server.\nServer could be down.\n\nAlso some adblockers can\nblock websocket connection.\n\nTry to refresh when problem solved.",color:Color3.FromHexString("#ff0000")});log("ERR__",e)});return{onCreate:e=>{f.onCreate=e;return()=>f.onCreate=null},onJoin:e=>{f.onJoin=e;return()=>f.onJoin=null},onPlayersFull:e=>{f.onPlayersFull=e;return()=>f.onPlayersFull=null},onGameRunning:e=>{f.onGameRunning=e;return()=>f.onGameRunning=null},onChangeState:e=>{f.onChangeState=e;return()=>f.onChangeState=null},onMessage:e=>{f.onMessage=e;return()=>f.onMessage},update:()=>{},getLobbyRoom:()=>p,hide:()=>{}}};t.createLobbyControl=g},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.updateStartButtonPanel=t.onRequestCancel=t.onRequestJoin=t.onRequestCreate=t.showJoinButtonOn=t.showCreateButtonOn=t.showCancelButtonOn=t.createStartButtonPanel=void 0;const i=n(1),r=n(0),o={showCreateButtonOn:null,showJoinButtonOn:null,showCancelButtonOn:null};let s=null,a=null,c=null;const u={onRequestCreate:null,onRequestJoin:null,onRequestCancel:null},l=(e,t,n)=>{let o={onClick:null};const s=new Entity,a=new Transform({position:n});s.addComponent(a);const c=new Entity,u=new PlaneShape;u.withCollisions=0;u.uvs=(0,r.getSpriteUv)("create"===t?1:"join"===t?2:9,256,48,32);c.addComponent(i.spriteMaterial);c.addComponent(u);u.visible=0;c.addComponent(new Transform({scale:new Vector3(1.5,1,1),position:new Vector3(0,0,0)}));c.addComponent(new OnClick(()=>{o.onClick()}));c.setParent(s);s.setParent(e);const l=()=>{u.visible=0};l();return{onClick:e=>{o.onClick=e;return()=>o.onClick=null},show:()=>{u.visible=1},hide:l}},h=.03125,d=e=>{const n=new Entity,i=25*h/2+2*h;s=l(n,"create",new Vector3(-(3-48*h/2-2*h),i,-.01));s.onClick(()=>u.onRequestCreate());a=l(n,"join",new Vector3(3-48*h/2-2*h,i,-.01));a.onClick(()=>u.onRequestJoin());c=l(n,"cancel",new Vector3(3-48*h/2-2*h,i,-.01));c.onClick(()=>u.onRequestCancel());engine["PRODI"]&&n.setParent(e);return{onRequestCreate:t.onRequestCreate,onRequestJoin:t.onRequestJoin,onRequestCancel:t.onRequestCancel,showCreateButtonOn:t.showCreateButtonOn,showJoinButtonOn:t.showJoinButtonOn,showCancelButtonOn:t.showCancelButtonOn,update:t.updateStartButtonPanel}};t.createStartButtonPanel=d;const p=e=>{o.showCancelButtonOn=e;return()=>o.showCancelButtonOn=null};t.showCancelButtonOn=p;const f=e=>{o.showCreateButtonOn=e;return()=>o.showCreateButtonOn=null};t.showCreateButtonOn=f;const m=e=>{o.showJoinButtonOn=e;return()=>o.showJoinButtonOn=null};t.showJoinButtonOn=m;const g=e=>{u.onRequestCreate=e;return()=>u.onRequestCreate=null};t.onRequestCreate=g;const y=e=>{u.onRequestJoin=e;return()=>u.onRequestJoin=null};t.onRequestJoin=y;const v=e=>{u.onRequestCancel=e;return()=>u.onRequestCancel=null};t.onRequestCancel=v;const S=()=>{o.showCreateButtonOn()?s.show():s.hide();o.showJoinButtonOn()?a.show():a.hide();o.showCancelButtonOn()?c.show():c.hide()};t.updateStartButtonPanel=S},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});t.joinOrCreateGameLobby=void 0;const r=n(16),o=n(17),s=globalThis&&globalThis.navigator||{},a=(e,{gameID:t,user:n})=>i(void 0,void 0,void 0,(function*(){return new Promise((a,c)=>i(void 0,void 0,void 0,(function*(){const{land:u,realm:l,serverHttp:h}=(0,o.getHostData)();yield fetch(`${h||r.HTTP_HOST}/game?id=${t}`);e.joinOrCreate("gameLobby_"+t,{realm:l,land:u,gameID:t,user:n,clientInfo:{language:s.language||null}}).then(n=>{void 0;a({requestCreate:({gameID:t,user:n,minGames:r,lobbySessionId:o})=>i(void 0,void 0,void 0,(function*(){log("requestCreate",t,n);return e.create("game_"+t,{gameID:t,user:Object.assign(Object.assign({},n),{address:n.address||"empty"}),minGames:r,lobbySessionId:o,land:u,realm:l}).then(e=>({sessionId:e.sessionId,gameRoomID:e.id,gameRoom:e}),()=>{void 0})})),requestJoin:({roomID:n,user:r,lobbySessionId:o})=>i(void 0,void 0,void 0,(function*(){log("requestJoin",n);return e.joinById(n,{realm:l,gameID:t,user:Object.assign(Object.assign({},r),{address:r.address||"empty"}),lobbySessionId:o,land:u}).then(e=>({sessionId:e.sessionId,gameRoomID:e.id,gameRoom:e}),()=>{void 0})})),room:n})}).catch(e=>{c({message:"_join error",error:e})})})))}));t.joinOrCreateGameLobby=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.updateBoard=t.createBoard=void 0;const i=n(0),r=n(2),o={player1:new Entity,player2:new Entity},s=e=>{const t=new TextShape,n=new TextShape,s=new Entity;s.addComponent(new Transform({position:new Vector3(0,4,-.15)}));s.setParent(e);t.color=Color3.FromHexString("#6666ff");n.color=Color3.FromHexString("#ffff00");t.hTextAlign="left";t.vTextAlign=n.vTextAlign="top";n.hTextAlign="right";t.fontSize=n.fontSize=2;o.player1.addComponent(t);o.player2.addComponent(n);o.player1.addComponent(new Transform({position:new Vector3(-2.99,.5,-.001)}));o.player2.addComponent(new Transform({position:new Vector3(2.99,.5,-.001)}));o.player1.setParent(s);o.player2.setParent(s);const a=new Entity,c=new Material;a.addComponent(c);c.transparencyMode=1;c.specularIntensity=0;c.roughness=1;c.metallic=0;c.alphaTest=.5;c.albedoColor=new Color4(0,0,0,.7);a.addComponent(new PlaneShape);a.addComponent(new Transform({scale:new Vector3(6,.5,1),position:new Vector3(0,.25,0)}));a.setParent(s);let u=1;const l=(0,i.createSpriteEntity)(s,{uvs:(0,i.getSpriteUv)(10,2048,16,16),position:new Vector3(0,.25,-.001),scale:new Vector3(.5,.5,1)});l.getEntity().addComponent(new OnClick(()=>{(0,r.toggleMusic)();u=!u;l.getShape().uvs=u?(0,i.getSpriteUv)(10,2048,16,16):(0,i.getSpriteUv)(11,2048,16,16)}))};t.createBoard=s;const a=e=>{var t,n,i,r;(null===(t=e.state.player1)||void 0===t?void 0:t.userId)&&(o.player1.getComponent(TextShape).value=`${e.state.player1.score||0} points\n${e.state.player1.displayName}`);(null===(n=e.state.player2)||void 0===n?void 0:n.userId)&&(o.player2.getComponent(TextShape).value=`${e.state.player2.score||0} points\n${e.state.player2.displayName}`);(null===(i=e.state.player1)||void 0===i?void 0:i.userId)||(o.player1.getComponent(TextShape).value="<free>");(null===(r=e.state.player2)||void 0===r?void 0:r.userId)||(o.player2.getComponent(TextShape).value="<free>")};t.updateBoard=a},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});t.createTrack=void 0;const r=n(6),o=n(2),s=n(5),a=n(18),c=n(0),u=n(24);let l=0;const h=(e,{gameRoom:t,lobbyRoom:n,user:h,trackSeed:f,minGames:m})=>i(void 0,void 0,void 0,(function*(){const g={onScore:null,onFinish:null},y=(0,u.generateTrack)(f,m);void 0;const v={currentIndex:0,currentPlayer:0,currentRoundIndex:0,score1:0,score2:0};n.state.player1.userId===h.userId&&(v.currentPlayer=1);n.state.player2.userId===h.userId&&(v.currentPlayer=2);(0,o.stopSound)("music2");yield p(100);(0,o.playOnce)("vs",{volume:1});(0,a.removeVideoPanel)();(0,s.showSpritePanel)();(0,s.updateSpritePanel)({uvs:(0,c.getSpriteUv)(10,0,192,128)});(0,r.updateTextPanel)({value:`${n.state.player1.displayName} (left)\nVS\n${n.state.player2.displayName} (right)`,bottom:0,color:Color3.White()});yield p(3e3);(0,a.reproduceVideo)(e,y[0].Game.id);(0,s.hideSpritePanel)();(0,r.updateTextPanel)({value:y[0].Game.instructions+"\n\nClick when ready to play\nor waiting 20 seconds"});let S=new y[v.currentIndex].Game(e,{seed:f,currentPlayer:v.currentPlayer,level:1,gameIndex:0});P(S,t);_(t);const b=()=>{t.send("READY_NEXT",{senderPlayer:v.currentPlayer,games:(y||[]).map(e=>e.Game.id)});Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,b);(0,r.updateTextPanel)({value:"waiting for other user"})};Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,b);return{onScore:w,onFinish:T,dispose:()=>{void 0}};function w(e){g.onScore=e;return()=>g.onScore=null}function T(e){g.onFinish=e;return()=>g.onFinish=null}function C(){g.onFinish=g.onScore=null}function _(t){t.onMessage("SHARE_STATE",e=>{S&&S.shareState(e||{})});t.onLeave(e=>{void 0;S&&S.destroy();S=null;(0,a.removeVideoPanel)();(0,s.updateSpritePanel)({uvs:(0,c.getSpriteUv)(1,0,192,128)});(0,s.showSpritePanel)()});t.onMessage("FINSIH_AGREE",({winner:o,nextSeed:s,nextIndex:c})=>i(this,void 0,void 0,(function*(){void 0;S.finish&&S.finish({winner:o});g.onScore({score1:v.score1,score2:v.score2});const i=n.state["player"+o].displayName;(0,r.updateTextPanel)({value:`(${o}) ${i} wins`});yield p(2e3);S.destroy();S=null;if(v.currentIndex+1>=y.length&&v.score1===v.score2){y.push((0,u.generateTrack)(s,1)[0]);void 0}if(v.currentIndex<y.length){v.currentIndex=c;E({nextSeed:s});P(S,t);const n=y[c].Game.instructions||"ERROR: MISSING_INSTRUCTIONS";(0,a.reproduceVideo)(e,y[c].Game.id);(0,r.updateTextPanel)({value:n+"\n\nClick when ready to play\n or waiting 20 seconds"});const i=()=>{Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,i);(0,r.updateTextPanel)({value:"waiting for other user"});t.send("READY_NEXT",{senderPlayer:v.currentPlayer,games:y.map(e=>e.Game.id)})};Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,i)}})));t.onMessage("NEXT_GAME",({serverTime:e,startTime:t})=>{v.currentRoundIndex=0;Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,b);void 0;(0,r.updateTextPanel)({value:""});(0,o.stopAllSounds)();S&&S.init();(0,a.removeVideoPanel)();l=e-Date.now();S.setStartTime(d(t))});t.onMessage("NEXT_ROUND",({winner:e,serverTime:t,startTime:n,roundIndex:i})=>{v.currentRoundIndex++;void 0;l=t-Date.now();S.finishRound&&S.finishRound({winner:e});const r=d(n);void 0;void 0;S.setRoundStartTime&&S.setRoundStartTime(r)});t.onMessage("FINISH_TRACK",({score:e})=>i(this,void 0,void 0,(function*(){void 0;S.destroy();S=null;(0,o.playOnce)("pwned");const n=(e.player1||0)>(e.player2||0)?1:2;(0,s.updateSpritePanel)({uvs:(0,c.getSpriteUv)(8,0,192,128),scale:new Vector3(1===n?6:-6,4,1)});(0,s.showSpritePanel)();g.onFinish({score:e});const i=()=>{t.send("SKIP_END",{senderPlayer:v.currentPlayer})};Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,i);t.onLeave(()=>Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,i))})))}function P(e,t){e.onFinish(({time:n,isWinner:i,score:r,gameIndex:o,roundIndex:s})=>{void 0;e.block();const a=1===v.currentPlayer?2:1,c=i?v.currentPlayer:a;void 0;t.send("FINISH_GAME",{winner:c,time:n,score:r,senderPlayer:v.currentPlayer,userId:h.userId,currentGameIndex:o,currentRoundIndex:s,gameName:e.id})});e.onFinishRound&&e.onFinishRound(({player:n,time:i,score:r,isWinner:o,roundIndex:s,gameIndex:a})=>{const c=1===v.currentPlayer?2:1,u=o?v.currentPlayer:c;t.send("READY_ROUND",{player:n,time:i,score:r,winner:u,currentGameIndex:a,currentRoundIndex:s,gameName:e.id})});e.onShareState(e=>{t.send("SHARE_STATE",{sharedState:e,userId:h.userId,senderPlayer:v.currentPlayer,currentGameIndex:v.currentIndex,currentRoundIndex:v.currentRoundIndex})})}function E({nextSeed:t}){void 0;if(S){S.destroy();S=null}const n=y[v.currentIndex].Game;S=new n(e,{seed:t,currentPlayer:v.currentPlayer,level:1,gameIndex:v.currentIndex})}function I(){var e,t,i;return(null===(e=n.state.player1)||void 0===e?void 0:e.userId)&&(null===(t=n.state.player2)||void 0===t?void 0:t.userId)&&(n.state.player1.userId===h.userId||(null===(i=n.state.player2)||void 0===i?void 0:i.userId)===h.userId)}}));t.createTrack=h;function d(e){return e-l}function p(e){return new Promise(t=>setTimeout(t,e))}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});const i=n(19),r=n(27),o=n(28),s=n(29),a=n(30),c=n(9),u=n(13),l=n(59),h=n(31),d=n(33),p=n(32),f=n(60),m=n(61);t.default={TransformSystem:c.TransformSystem,MoveTransformComponent:i.MoveTransformComponent,RotateTransformComponent:r.RotateTransformComponent,ScaleTransformComponent:o.ScaleTransformComponent,FollowPathComponent:s.FollowPathComponent,KeepRotatingComponent:a.KeepRotatingComponent,Interpolate:u.Interpolate,InterpolationType:u.InterpolationType,ToggleComponent:l.ToggleComponent,ToggleState:l.ToggleState,Delay:h.Delay,ExpireIn:d.ExpireIn,Interval:p.Interval,TriggerComponent:f.TriggerComponent,TriggerSystem:f.TriggerSystem,TriggerSphereShape:f.TriggerSphereShape,TriggerBoxShape:f.TriggerBoxShape,ActionsSequenceSystem:m.ActionsSequenceSystem}},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o},r;Object.defineProperty(t,"__esModule",{value:1});t.ToggleComponent=t.ToggleState=void 0;(function(e){e[e["Off"]=0]="Off";e[e["On"]=1]="On"})(r=t.ToggleState||(t.ToggleState={}));let o=class e{constructor(e=r.On,t){this.enabled=1;this.state=r.Off;this.set(e);t&&this.setCallback(t)}set(e){this.state=e;this.onValueChangedCallback&&this.onValueChangedCallback(e)}toggle(){this.enabled&&this.set(1-this.state)}isOn(){return this.state==r.On}setCallback(e){this.onValueChangedCallback=e}};o=i([Component("toggle")],o);t.ToggleComponent=o;t.default={ToggleComponent:o,ToggleState:r}},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.TriggerSphereShape=t.TriggerBoxShape=t.TriggerComponent=t.TriggerSystem=void 0;class r{static get instance(){return this.createAndAddToEngine()}constructor(){this._triggers={};r._instance=this;this._cameraTriggerWrapper=new s(new c(new Vector3(.5,1.8,.5),new Vector3(0,.91,0)))}static createAndAddToEngine(){if(null==this._instance){this._instance=new r;engine.addSystem(this._instance)}return this._instance}setCameraTriggerShape(e){this._cameraTriggerWrapper.setShape(e)}update(){let e;engine.getComponentGroup(a).entities.forEach(e=>{this.shouldWrapTriggerEntity(e)&&this.wrapTriggerEntity(e)});for(const e in this._triggers)if(this._triggers.hasOwnProperty(e)){let t=this._triggers[e];t.isDebugging()&&t.updateDebugEntity();if(t.isInEngine()){if(null!=t.trigger&&t.trigger.enabled){t.wasEnabled||t.isDebugging()&&t.addDebugEntity();t.wasEnabled=1;(t.trigger.onCameraEnter||t.trigger.onCameraExit)&&this.checkCollisionAgainstCamera(t);(t.trigger.onTriggerEnter||t.trigger.onTriggerExit)&&this.checkCollisionAgainstOtherTriggers(t)}else if(t.wasEnabled){t.wasEnabled=0;t.isDebugging()&&t.removeDebugEntity();r.removeTriggerFromSystem(t)}}else{t.isDebugging()&&t.removeDebugEntity();r.removeTriggerFromSystem(t);delete this._triggers[e]}}}shouldWrapTriggerEntity(e){return null==this._triggers[e.uuid]||null==this._triggers[e.uuid]}wrapTriggerEntity(e){this._triggers[e.uuid]=new o(e)}static removeTriggerFromSystem(e){let t=e.getActiveCollisions();for(let n=0;n<t.length;n++){t[n].trigger.onTriggerExit&&e.entity&&t[n].trigger.onTriggerExit(e.entity);t[n].disengageActiveCollision(e);e.disengageActiveCollision(t[n])}}static disengageCollision(e,t){e.disengageActiveCollision(t);t.disengageActiveCollision(e);e.trigger.onTriggerExit&&t.entity&&e.trigger.onTriggerExit(t.entity);t.trigger.onTriggerExit&&e.entity&&t.trigger.onTriggerExit(e.entity)}static engageCollision(e,t){e.engageCollision(t);t.engageCollision(e);e.trigger.onTriggerEnter&&t.entity&&e.trigger.onTriggerEnter(t.entity);t.trigger.onTriggerEnter&&e.entity&&t.trigger.onTriggerEnter(e.entity)}checkCollisionAgainstCamera(e){let t=e.hasActiveCollision(this._cameraTriggerWrapper),n=r.areColliding(e,this._cameraTriggerWrapper);if(t&&!n){e.disengageActiveCollision(this._cameraTriggerWrapper);e.trigger.onCameraExit&&e.trigger.onCameraExit()}else if(!t&&n){e.engageCollision(this._cameraTriggerWrapper);e.trigger.onCameraEnter&&e.trigger.onCameraEnter()}}checkCollisionAgainstOtherTriggers(e){for(const t in this._triggers)if(this._triggers.hasOwnProperty(t)&&t!=e.uuid&&this._triggers[t].trigger.enabled&&r.canTriggersCollide(e,this._triggers[t])){let n=e.hasActiveCollision(this._triggers[t]),i=r.areColliding(e,this._triggers[t]);n&&!i?r.disengageCollision(e,this._triggers[t]):!n&&i&&r.engageCollision(e,this._triggers[t])}}static canTriggersCollide(e,t){return 0==e.trigger.triggeredByLayer?1:0!=(t.trigger.layer&e.trigger.triggeredByLayer)}static areColliding(e,t){return e.getShape()instanceof c&&t.getShape()instanceof c?r.areCollidingAABB(e.getGlobalPosition(),e.getShape(),t.getGlobalPosition(),t.getShape()):e.getShape()instanceof u&&t.getShape()instanceof u?r.areCollidingSphere(e.getGlobalPosition(),e.getShape(),t.getGlobalPosition(),t.getShape()):e.getShape()instanceof c&&t.getShape()instanceof u?r.areCollidingAABBSphere(e.getGlobalPosition(),e.getShape(),t.getGlobalPosition(),t.getShape()):e.getShape()instanceof u&&t.getShape()instanceof c?r.areCollidingAABBSphere(t.getGlobalPosition(),t.getShape(),e.getGlobalPosition(),e.getShape()):0}static areCollidingAABB(e,t,n,i){let o=r.getBoxShapeValues(e,t),s=r.getBoxShapeValues(n,i);return o.min.x<=s.max.x&&o.max.x>=s.min.x&&o.min.y<=s.max.y&&o.max.y>=s.min.y&&o.min.z<=s.max.z&&o.max.z>=s.min.z}static areCollidingSphere(e,t,n,i){let r;return Vector3.DistanceSquared(e.add(t.position),n.add(i.position))<t.radius*t.radius+i.radius*i.radius}static areCollidingAABBSphere(e,t,n,i){let o=r.getBoxShapeValues(e,t),s={center:n.add(i.position),radius:i.radius},a=0;s.center.x<o.min.x&&(a+=(o.min.x-s.center.x)*(o.min.x-s.center.x));s.center.x>o.max.x&&(a+=(s.center.x-o.max.x)*(s.center.x-o.max.x));s.center.y<o.min.y&&(a+=(o.min.y-s.center.y)*(o.min.y-s.center.y));s.center.y>o.max.y&&(a+=(s.center.y-o.max.y)*(s.center.y-o.max.y));s.center.z<o.min.z&&(a+=(o.min.z-s.center.z)*(o.min.z-s.center.z));s.center.z>o.max.z&&(a+=(s.center.z-o.max.z)*(s.center.z-o.max.z));return a<s.radius*s.radius}static getBoxShapeValues(e,t){let n=e.add(t.position);return{center:n,min:n.subtract(t.size.scale(.5)),max:n.add(t.size.scale(.5))}}}t.TriggerSystem=r;r._instance=null;class o{get entity(){return this._entity}get trigger(){return this._trigger}get uuid(){return this._uuid}constructor(e){this.wasEnabled=1;this._uuid="";this._collidingWith={};this._isDebug=0;this._debugEntity=null;this._entity=e;if(e){this._trigger=e.getComponent(a);this._uuid=e.uuid;this._isDebug=this._trigger.debugEnabled;this._isDebug&&this.addDebugEntity()}}getGlobalPosition(){return this._entity?o.getEntityWorldPosition(this._entity):Vector3.Zero()}getShape(){return this._trigger.shape}isInEngine(){return null!=this._entity&&this._entity.isAddedToEngine()}getActiveCollisions(){let e=[];for(const t in this._collidingWith)this._collidingWith.hasOwnProperty(t)&&e.push(this._collidingWith[t]);return e}hasActiveCollision(e){return null!=this._collidingWith[e.uuid]&&null!=this._collidingWith[e.uuid]}disengageActiveCollision(e){delete this._collidingWith[e.uuid]}engageCollision(e){this._collidingWith[e.uuid]=e}isDebugging(){return this._isDebug}addDebugEntity(){if(!o._debugMaterial){o._debugMaterial=new Material;o._debugMaterial.alphaTest=.5}if(null==this._debugEntity){this._debugEntity=new Entity;const e=new Transform;this._debugEntity.addComponent(e);this._debugEntity.addComponent(o._debugMaterial);if(this.getShape()instanceof c){const t=new BoxShape;t.withCollisions=0;this._debugEntity.addComponent(t);e.scale=this.getShape().size}if(this.getShape()instanceof u){const t=new SphereShape;t.withCollisions=0;this._debugEntity.addComponent(t);let n=this.getShape().radius;e.scale=new Vector3(n,n,n)}}engine.addEntity(this._debugEntity)}removeDebugEntity(){null!=this._debugEntity&&engine.removeEntity(this._debugEntity)}updateDebugEntity(){this._debugEntity&&(this._debugEntity.getComponent(Transform).position=this.getGlobalPosition().add(this.getShape().position))}static getEntityWorldPosition(e){let t=e.hasComponent(Transform)?e.getComponent(Transform).position:Vector3.Zero(),n=e.getParent();if(null!=n){let e=n.hasComponent(Transform)?n.getComponent(Transform).rotation:Quaternion.Identity;return this.getEntityWorldPosition(n).add(t.rotate(e))}return t}}o._debugMaterial=null;class s extends o{constructor(e){super();this._shape=e;this._uuid="cameraTrigger"}getGlobalPosition(){return Camera.instance.position}getShape(){return this._shape}setShape(e){this._shape=e}isInEngine(){return 0}hasActiveCollision(e){return 0}disengageActiveCollision(e){}engageCollision(e){}isDebugging(){return 0}}let a=class e{get debugEnabled(){return this._debugEnabled}constructor(e,t=0,n=0,i,o,s,a,c=0){this.enabled=1;this.layer=0;this.triggeredByLayer=0;r.createAndAddToEngine();this.shape=e;this.layer=t;this.triggeredByLayer=n;this.onTriggerEnter=i;this.onTriggerExit=o;this.onCameraEnter=s;this.onCameraExit=a;this._debugEnabled=c}};a=i([Component("triggerComponent")],a);t.TriggerComponent=a;class c{constructor(e,t){this.size=e;this.position=t}}t.TriggerBoxShape=c;class u{constructor(e,t){this.radius=e;this.position=t}}t.TriggerSphereShape=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.ActionsSequenceSystem=void 0;class i{constructor(e){this.beginSequenceNode=null;this.currentSequenceNode=null;this.running=0;this.started=0;e&&this.startSequence(e)}startSequence(e){this.beginSequenceNode=e.beginSequenceNode;this.currentSequenceNode=this.beginSequenceNode;this.running=1;this.started=0}setOnFinishCallback(e){this.onFinishCallback=e}isRunning(){return this.running}stop(){this.running=0}resume(){null!=this.beginSequenceNode&&(this.running=1)}reset(){this.currentSequenceNode=this.beginSequenceNode;this.running=1;this.started=0}getRunningAction(){let e=this.currentSequenceNode;if(this.currentSequenceNode instanceof o)do{e=e.currentInnerSequence}while(e instanceof o);return e.action}update(e){if(this.running)if(this.started)if(this.currentSequenceNode.hasFinish()){this.currentSequenceNode.onFinish();this.currentSequenceNode=this.currentSequenceNode.next;if(this.currentSequenceNode)this.currentSequenceNode.onStart();else{this.running=0;this.onFinishCallback&&this.onFinishCallback()}}else this.currentSequenceNode.update(e);else{this.currentSequenceNode.onStart();this.started=1}}}t.ActionsSequenceSystem=i;(function(e){class t{constructor(){this.currentSequenceNode=null;this.beginSequenceNode=null;this.whileNodeStack=[]}then(e){if(null==this.currentSequenceNode){this.currentSequenceNode=new r;this.currentSequenceNode.action=e;this.beginSequenceNode=this.currentSequenceNode}else{let t=new r;t.action=e;this.currentSequenceNode=this.currentSequenceNode.then(t)}return this}if(e){let t=new s(e);if(null==this.currentSequenceNode){this.currentSequenceNode=t;this.beginSequenceNode=t}else this.currentSequenceNode=this.currentSequenceNode.then(t);return this}else(){let e=this.currentSequenceNode.getSequence();if(!(e instanceof s))throw new Error("IF statement is needed to be called before ELSE statement.");{e.closed=1;let t=new a(e);this.currentSequenceNode=this.currentSequenceNode.then(t)}return this}endIf(){let e=this.currentSequenceNode.getSequence();if(!(e instanceof s||e instanceof a))throw new Error("IF statement is needed to be called before ENDIF statement.");e.closed=1;return this}while(e){let t=new c(e);if(null==this.currentSequenceNode){this.currentSequenceNode=t;this.beginSequenceNode=t}else this.currentSequenceNode=this.currentSequenceNode.then(t);this.whileNodeStack.push(t);return this}endWhile(){let e=this.currentSequenceNode.getSequence();if(!(e instanceof c))throw new Error("WHILE statement is needed to be called before ENDWHILE statement.");e.closed=1;this.whileNodeStack.length>0&&this.whileNodeStack.splice(this.whileNodeStack.length-1,1);return this}breakWhile(){if(!(this.whileNodeStack.length>0))throw new Error("WHILE statement is needed to be called before BREAKWHILE statement.");this.currentSequenceNode=this.currentSequenceNode.then(new u(this.whileNodeStack[this.whileNodeStack.length-1]));return this}}e.SequenceBuilder=t})(i=t.ActionsSequenceSystem||(t.ActionsSequenceSystem={}));class r{constructor(){this.action=null;this.next=null}then(e){this.next=e;return e}onStart(){this.action&&this.action.onStart()}update(e){this.action&&this.action.update(e)}onFinish(){this.action&&this.action.onFinish()}hasFinish(){return this.action?this.action.hasFinished:1}getSequence(){return this}}class o extends r{constructor(){super(...arguments);this.currentInnerSequence=null;this.startingInnerSequence=null;this.closed=0}then(e){if(null==this.currentInnerSequence){this.currentInnerSequence=e;this.startingInnerSequence=e}else{if(this.closed){this.next=e;return e}this.currentInnerSequence=this.currentInnerSequence.then(e)}return this}onStart(){this.currentInnerSequence=this.startingInnerSequence;this.currentInnerSequence&&this.currentInnerSequence.onStart()}update(e){if(this.currentInnerSequence)if(this.currentInnerSequence.hasFinish()){this.currentInnerSequence.onFinish();this.currentInnerSequence=this.currentInnerSequence.next;this.currentInnerSequence&&this.currentInnerSequence.onStart()}else this.currentInnerSequence.update(e)}onFinish(){this.currentInnerSequence&&this.currentInnerSequence.onFinish()}hasFinish(){return null==this.currentInnerSequence}getSequence(){if(this.currentInnerSequence){let e=this.currentInnerSequence.getSequence();if(e instanceof o&&!e.closed)return e}return this}}class s extends o{constructor(e){super();this.result=0;this.condition=e}onStart(){this.result=this.condition();this.result?super.onStart():this.currentInnerSequence=null}}class a extends o{constructor(e){super();this.ifSequence=null;this.ifSequence=e}onStart(){this.ifSequence&&!this.ifSequence.result?super.onStart():this.currentInnerSequence=null}}class c extends o{constructor(e){super();this.breakWhile=0;this.condition=e}onStart(){this.breakWhile=0;this.condition()?super.onStart():this.currentInnerSequence=null}update(e){if(this.currentInnerSequence)if(this.currentInnerSequence.hasFinish()){this.currentInnerSequence.onFinish();this.currentInnerSequence=this.currentInnerSequence.next;null==this.currentInnerSequence&&(this.currentInnerSequence=this.startingInnerSequence);this.currentInnerSequence&&this.currentInnerSequence.onStart()}else this.currentInnerSequence.update(e)}hasFinish(){return this.breakWhile||!this.condition()}}class u extends r{constructor(e){super();this.whileNode=e}onStart(){this.whileNode.breakWhile=1}}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.CostumeGame=void 0;const i=n(3),r=n(21),o=n(63),s=n(68),a=n(69),c=n(10),u=n(5),l=n(2),h=n(4),d=n(0),p=3;class f{constructor(e,{seed:t,currentPlayer:n,level:c,gameIndex:u}){this.state={startTime:Number.MAX_VALUE,roundStartTime:Number.MAX_VALUE,lastRoundStartTime:Number.MAX_VALUE,waitingRound:0,round:0,score1:0,score2:0,started:0,finished:0,blocked:0,idle:1};this.entity={};this.completion={hair:0,glasses:0,shirt:0,pants:0};this.callbacks={onFinish:null,onShareState:null,onFinishRound:null};this.root=e;this.gameSetup={currentPlayer:n,seed:t,level:c,gameIndex:u};this.randomizer=i.seedGen.create(t.toString());this.scene=new Entity;this.scene.addComponent(new r.GameScene);this.scene.addComponent(new Transform({position:new Vector3(0,0,-.002)}));this.ui=(0,h.createUI)(this.scene);const l=this.modelDefinition={hair:this.getRandomInt(1,10),shirt:this.getRandomInt(1,5),pants:this.getRandomInt(1,5),glasses:this.getRandomInt(1,5)},d=-.05;this.entity.model=(0,o.createModel)(this.scene,{modelDefinition:l,position:new Vector3(0+d,2,0),scale:new Vector3(1.5,1.5,1),showLabel:"model"});this.dollModel1=(0,o.createModel)(this.scene,{modelDefinition:{hair:0,shirt:0,pants:0,glasses:0},position:new Vector3(-1.5+d,2,0),scale:new Vector3(1.5,1.5,1)});this.dollModel2=(0,o.createModel)(this.scene,{modelDefinition:{hair:0,shirt:0,pants:0,glasses:0},position:new Vector3(1.5+d,2,0),scale:new Vector3(1.5,1.5,1)});this.collection=(0,s.createCollection)(this.getRandomInt.bind(this),l);void 0;void 0;this.collection.forEach(e=>{if(!e)debugger});try{void 0;n&&(this.collectionControl=(0,a.createCollectionControl)(this.scene,{collection:this.collection,side:n}))}catch(e){debugger}this.roundResult1=(0,h.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,h.createRoundResult)(this.scene,{player:2});this.roundResult1.hide();this.roundResult2.hide();this.primaryButtonCallback=this.primaryButtonCallback.bind(this);this.secondaryButtonCallback=this.secondaryButtonCallback.bind(this);this.clickCallback=this.clickCallback.bind(this);engine.addSystem(this)}setStartTime(e){this.state.startTime=e}init(){(0,l.playLoop)("money",{volume:.5});(0,u.updateSpritePanel)({uvs:(0,d.getSpriteUv)(5,0,192,128)});(0,u.showSpritePanel)();this.state.initialized=1}start(){this.scene.setParent(this.root);this.state.started=1;if(this.gameSetup.currentPlayer){Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,0,this.primaryButtonCallback);Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,0,this.secondaryButtonCallback);Input.instance.subscribe("BUTTON_DOWN",ActionButton.POINTER,0,this.clickCallback)}}startRound(){this.state.round++;void 0;this.roundResult1.hide();this.roundResult2.hide();this.ui.hideTime();this.state.blocked=0;this.state.lastRoundStartTime=this.state.roundStartTime;this.state.roundStartTime=Number.MAX_VALUE;this.state.waitingRound=0;const e=this.modelDefinition={hair:this.getRandomInt(1,10),shirt:this.getRandomInt(1,5),pants:this.getRandomInt(1,5),glasses:this.getRandomInt(1,5)};Object.keys(e).forEach(t=>{this.entity.model.update({type:t,index:e[t]});this.dollModel1.update({type:t,index:0});this.dollModel2.update({type:t,index:0});this.completion[t]=0});this.collection=(0,s.createCollection)(this.getRandomInt.bind(this),e);this.gameSetup.currentPlayer&&(this.collectionControl=(0,a.createCollectionControl)(this.scene,{collection:this.collection,side:this.gameSetup.currentPlayer}))}block(){this.state.blocked=1}finish({winner:e}){void 0;const t=1===e?2:1;this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}finishRound({winner:e}){void 0;this.state.blocked=1;this.state["score"+e]+=1;this.ui.updateScore({player:e,score:this.state["score"+e]});e===this.gameSetup.currentPlayer?(0,l.playOnce)("wow"):(0,l.playOnce)("fail");this.state.waitingRound=1;this.collectionControl&&this.collectionControl.dispose();Object.keys(this.modelDefinition).forEach(e=>{this.entity.model.update({type:e,index:0})});const t=1===e?2:1;this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onFinishRound(e){this.callbacks.onFinishRound=e;return()=>this.callbacks.onFinishRound=null}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}setRoundStartTime(e){this.state.roundStartTime=e}shareState({player:e,completion:t,timeSinceStart:n}){Object.keys(t).forEach(n=>{t[n]&&this["dollModel"+e].update({type:n,index:this.modelDefinition[n]})});n&&this.ui.updateTime({player:e,time:n})}clickCallback(){if(this.state.blocked)return;void 0;const e=this.collectionControl.getCurrent();if(!e)debugger;if(this.modelDefinition[e.type]===e.index){void 0;(0,l.playOnce)("ok");this["dollModel"+this.gameSetup.currentPlayer].update(e);this.completion[e.type]=1;if(Object.values(this.completion).every(e=>e)){void 0;const e=(0,c.getTimeSinceStart)(0===this.state.round?this.state.startTime:this.state.lastRoundStartTime);this.ui.updateTime({player:this.gameSetup.currentPlayer,time:e});this.callbacks.onShareState({player:this.gameSetup.currentPlayer,completion:this.completion,timeSinceStart:e});this.state.round<p-1?this.callbacks.onFinishRound({time:e,player:this.gameSetup.currentPlayer,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round}):this.callbacks.onFinish({time:e,isWinner:this.gameSetup.currentPlayer,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round})}else this.callbacks.onShareState({player:this.gameSetup.currentPlayer,completion:this.completion})}else{void 0;(0,l.playOnce)("fail");this.state.blocked=1;this.collectionControl.showError();setTimeout(()=>{this.collectionControl.hideError();this.state.blocked=0},500)}}primaryButtonCallback(){this.state.blocked||this.collectionControl.previous()}secondaryButtonCallback(){this.state.blocked||this.collectionControl.next()}destroy(){(0,l.stopSound)("money");(0,u.hideSpritePanel)();this.scene.setParent(null);engine.removeEntity(this.scene);engine.removeSystem(this);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,this.primaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,this.secondaryButtonCallback);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.POINTER,this.clickCallback)}update(e){if(this.state.initialized){!this.state.waitingRound&&!this.state.started&&Date.now()>=this.state.startTime&&this.start();this.state.started&&this.state.waitingRound&&Date.now()>=this.state.roundStartTime&&this.startRound()}}getRandomInt(e,t,n){const i=e+Math.floor(this.randomizer.random()*(t-e+1));return i===n?this.getRandomInt(e,t,n):i}}t.CostumeGame=f;f.id="Costume";f.instructions="You have to complete the costume\n    before your opponent\n    E,F to roll parts\n    CLICK to select"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createModel=void 0;const i=n(64),r=n(65),o=n(66),s=n(67),a=n(1),c=n(0),u=(e,{modelDefinition:t,position:n,scale:u,showLabel:l=""})=>{const h=new Entity;h.addComponent(new Transform({position:n,scale:u}));const d=new Entity,p=new PlaneShape;p.withCollisions=0;p.isPointerBlocker=0;p.uvs=(0,c.getSpriteUv)(16,112,64,128);const f=undefined;(new Material).albedoColor=new Color3(1,0,0);const m=new Transform({scale:new Vector3(-1,2,-1),position:new Vector3(0,0,0)});m.rotation.setEuler(0,180,0);d.addComponent(m);d.addComponent(a.spriteMaterial);d.addComponent(p);d.setParent(h);h.setParent(e);const g={glasses:null,hair:null,shirt:null,pants:null};g.glasses=(0,r.createGlasses)(h,{partDefinition:{type:"glasses",index:t.glasses}});g.hair=(0,i.createHair)(h,{partDefinition:{type:"hair",index:t.hair}});g.pants=(0,s.createPants)(h,{partDefinition:{type:"pants",index:t.pants}});g.shirt=(0,o.createShirt)(h,{partDefinition:{type:"shirt",index:t.shirt}});if(l){const e=new Entity;e.setParent(h);const t=new TextShape("model");t.fontSize=2;t.font=new Font(Fonts.SanFrancisco_Heavy);e.addComponent(t);e.addComponent(new Transform({position:new Vector3(0,1.3,0)}))}const y=({partDefinition:e})=>{};return{entity:h,update:e=>{if(!e)debugger;g[e.type].updateIndex(e.index)},dispose:()=>{}}};t.createModel=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createHair=void 0;const i=n(11),r=n(1),o=n(0),s=(e,{partDefinition:t})=>{const n=4/128/2,s=new Entity,a=new PlaneShape;a.withCollisions=0;const c=new Transform({position:new Vector3(.25-15*n,.375+23*n,-3e-4),scale:new Vector3(1,1,1)});s.addComponent(a);s.addComponent(c);s.addComponent(r.spriteMaterial);s.setParent(e);a.uvs=(0,o.getSpriteUv)(t.index,i.PART_OFFSET_INDEX["hair"],i.PART_SIZE_WIDTH["hair"]);return{dispose:()=>{e.setParent(null);engine.removeEntity(s)},updateIndex:e=>{a.uvs=(0,o.getSpriteUv)(e,i.PART_OFFSET_INDEX["hair"],i.PART_SIZE_WIDTH["hair"])}}};t.createHair=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createGlasses=void 0;const i=n(11),r=n(1),o=n(0),s=(e,{partDefinition:t})=>{const n=4/128/2,s=new Entity,a=new PlaneShape;a.withCollisions=0;const c=new Transform({position:new Vector3(.25-15*n,.375+8*n,-5e-4),scale:new Vector3(1,1,1)});s.addComponent(a);s.addComponent(c);s.addComponent(r.spriteMaterial);s.setParent(e);a.uvs=(0,o.getSpriteUv)(t.index,i.PART_OFFSET_INDEX["glasses"],i.PART_SIZE_WIDTH["glasses"],i.PART_SIZE_HEIGHT["glasses"]);return{dispose:()=>{e.setParent(null);engine.removeEntity(s)},updateIndex:e=>{a.uvs=(0,o.getSpriteUv)(e,i.PART_OFFSET_INDEX["glasses"],i.PART_SIZE_WIDTH["glasses"],i.PART_SIZE_HEIGHT["glasses"])}}};t.createGlasses=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createShirt=void 0;const i=n(11),r=n(1),o=n(0),s=(e,{partDefinition:t})=>{const n=4/128/2,s=new Entity,a=new PlaneShape;a.withCollisions=0;const c=new Transform({position:new Vector3(4*n,.5-15*n,-.002),scale:new Vector3(1,1,1)});s.addComponent(a);s.addComponent(c);s.addComponent(r.spriteMaterial);s.setParent(e);a.uvs=(0,o.getSpriteUv)(t.index,i.PART_OFFSET_INDEX["shirt"],i.PART_SIZE_WIDTH["shirt"]);return{dispose:()=>{e.setParent(null);engine.removeEntity(s)},updateIndex:e=>{a.uvs=(0,o.getSpriteUv)(e,i.PART_OFFSET_INDEX["shirt"],i.PART_SIZE_WIDTH["shirt"])}}};t.createShirt=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createPants=void 0;const i=n(11),r=n(1),o=n(0),s=(e,{partDefinition:t})=>{const n=4/128/2,s=new Entity,a=new PlaneShape;a.withCollisions=0;const c=new Transform({position:new Vector3(5*n,2*n-.5,-.001),scale:new Vector3(1,1,1)});s.addComponent(a);s.addComponent(c);s.addComponent(r.spriteMaterial);s.setParent(e);a.uvs=(0,o.getSpriteUv)(t.index,i.PART_OFFSET_INDEX["pants"],i.PART_SIZE_WIDTH["pants"]);return{dispose:()=>{e.setParent(null);engine.removeEntity(s)},updateIndex:e=>{a.uvs=(0,o.getSpriteUv)(e,i.PART_OFFSET_INDEX["pants"],i.PART_SIZE_WIDTH["pants"])}}};t.createPants=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createCollection=t.MAX_INDEX=void 0;t.MAX_INDEX={hair:10,glasses:5,shirt:5,pants:5};const i=["hair","glasses","shirt","pants"],r=(e,n)=>{void 0;const r=Object.keys(n).map(e=>({type:e,index:n[e]})),o=[...r];i.forEach(n=>{let i=3;for(;i--;){let i=e(1,t.MAX_INDEX[n]);const s=r.find(e=>e.type===n);for(;i===s.index||o.find(e=>e.type===n&&e.index===i);)i=e(1,t.MAX_INDEX[n]);o.push({type:n,index:i})}});return s(o);function s(t){for(var n=t.length,i,r;0!==n;){r=Math.floor(e(1,100)/100*n);i=t[n-=1];t[n]=t[r];t[r]=i}return t}};t.createCollection=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createCollectionControl=void 0;const i=n(11),r=n(35),o=n(1),s=n(0),a=n(2),c=.7,u=0,l=-.7,h=(e,{collection:t,side:n,avoidAdd:h=0})=>{const d=new Entity,p=new Entity,f=new Entity,m=new Entity,g=new Entity,y=new TextShape("E");y.fontSize=2;g.addComponent(y);g.addComponent(new Transform({position:new Vector3(1===n?-.3:.3,.8,-.002)}));g.setParent(d);const v=new Entity,S=new TextShape("F");S.fontSize=2;v.addComponent(S);v.addComponent(new Transform({position:new Vector3(1===n?-.3:.3,-.75,-.002)}));v.setParent(d);p.setParent(d);f.setParent(d);m.setParent(d);const b=t[0],w=t[1],T=t[2];let C=1;const _=new PlaneShape,P=new PlaneShape,E=new PlaneShape,I=new Vector3(.5,.5,.5);p.addComponent(new Transform({position:new Vector3(0,c,0),scale:I}));m.addComponent(new Transform({position:new Vector3(0,u,0),scale:new Vector3(1,1,1)}));f.addComponent(new Transform({position:new Vector3(0,l,0),scale:I}));p.addComponent(_);m.addComponent(E);f.addComponent(P);if(!b||!w||!T)debugger;_.uvs=(0,s.getSpriteUv)(b.index,i.PART_OFFSET_INDEX[b.type],i.PART_SIZE_WIDTH[b.type],i.PART_SIZE_HEIGHT[b.type]);E.uvs=(0,s.getSpriteUv)(w.index,i.PART_OFFSET_INDEX[w.type],i.PART_SIZE_WIDTH[w.type],i.PART_SIZE_HEIGHT[w.type]);P.uvs=(0,s.getSpriteUv)(T.index,i.PART_OFFSET_INDEX[T.type],i.PART_SIZE_WIDTH[T.type],i.PART_SIZE_HEIGHT[T.type]);p.addComponent(o.spriteMaterial);m.addComponent(o.spriteMaterial);f.addComponent(o.spriteMaterial);d.addComponent(new Transform({position:new Vector3(1===n?-2.5:2.5,2,-.001)}));h||d.setParent(e);const O=(0,r.createCross)(d,{position:new Vector3(0,0,-.003),scale:I});O.hide();x(C);return{entity:d,hide:()=>{d.setParent(null);engine.removeEntity(d)},show:()=>{d.setParent(e)},dispose:()=>{d.setParent(null);engine.removeEntity(d);d.children},getCurrent:()=>t[C],next:()=>{(0,a.playOnce)("swing");C=A(C);x(C)},previous:()=>{(0,a.playOnce)("swing");C=R(C);x(C)},showError:()=>{O.show()},hideError:()=>{O.hide()}};function R(e){return e-1<0?t.length-1:e-1}function A(e){return e+1>t.length-1?0:e+1}function x(e){const n=R(e),r=A(e),o=t[n],a=t[e],h=t[r],d=m.getComponent(Transform),g=d.position;if(!o||!a||!h)debugger;g.set(g.x,u-i.PART_TYPE_OFFSET_Y[a.type]*d.scale.y,g.z);const y=p.getComponent(Transform),v=y.position;v.set(v.x,c-i.PART_TYPE_OFFSET_Y[o.type]*y.scale.y,v.z);const S=f.getComponent(Transform),b=S.position;b.set(b.x,l-i.PART_TYPE_OFFSET_Y[h.type]*S.scale.y,b.z);_.uvs=(0,s.getSpriteUv)(o.index,i.PART_OFFSET_INDEX[o.type],i.PART_SIZE_WIDTH[o.type],i.PART_SIZE_HEIGHT[o.type]);E.uvs=(0,s.getSpriteUv)(a.index,i.PART_OFFSET_INDEX[a.type],i.PART_SIZE_WIDTH[a.type],i.PART_SIZE_HEIGHT[a.type]);P.uvs=(0,s.getSpriteUv)(h.index,i.PART_OFFSET_INDEX[h.type],i.PART_SIZE_WIDTH[h.type],i.PART_SIZE_HEIGHT[h.type])}};t.createCollectionControl=h},function(e,t,n){var i=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.createScreen=void 0;const r=n(1),o=n(0),s=n(35),a=.3;let c=class e{constructor(e,t){this.index=e;this.isObstacle=t}};c=i([Component("ObstacleGame-step")],c);let u=class e{};u=i([Component("ObstacleGame-player")],u);const l=(e,{player:t,track:n})=>{let i=new TextShape("E");i.withCollisions=0;i.fontSize=4;i.font=new Font(Fonts.SanFrancisco_Heavy);i.shadowOffsetX=1;i.shadowOffsetY=1;i.shadowColor=Color3.FromHexString("#000000");const u={onMove:null,onFinish:null},l={moving:0,jumping:0,moveCount:0,currentStep:0,jumps:0};let h;h=new Entity;h.setParent(e);const d=(0,s.createCross)(h,{position:new Vector3(1.5,3,-.001),scale:new Vector3(1,1,1)});d.hide();h.addComponent(new Transform({position:new Vector3(2===t?0:-3,0,0)}));const p=new Entity,f=new PlaneShape;f.withCollisions=0;f.uvs=(0,o.getSpriteUv)(2,11,96,128);p.addComponent(r.spriteMaterial);p.addComponent(f);p.addComponent(new Transform({position:new Vector3(1.5,2,0),scale:new Vector3(3,4,1)}));p.setParent(h);const m=2060,g=new o.SpriteAnimationSystem(h,{frames:[{uvs:(0,o.getSpriteUv)(8,m,16,16)},{uvs:(0,o.getSpriteUv)(1,m,16,16)},{uvs:(0,o.getSpriteUv)(2,m,16,16)},{uvs:(0,o.getSpriteUv)(3,m,16,16)},{uvs:(0,o.getSpriteUv)(4,m,16,16)},{uvs:(0,o.getSpriteUv)(4,m,16,16)},{uvs:(0,o.getSpriteUv)(5,m,16,16)},{uvs:(0,o.getSpriteUv)(6,m,16,16)},{uvs:(0,o.getSpriteUv)(7,m,16,16)},{uvs:(0,o.getSpriteUv)(8,m,16,16)},{uvs:(0,o.getSpriteUv)(8,m+64,16,16)}],scale:new Vector3(.5,.5,1),position:new Vector3(.3*3+.15,1.9,-.002),time:.1});g.init();const y=[];n.forEach((e,i)=>{const r=new Entity;r.addComponent(new c(i,e));const o=new PlaneShape;o.withCollisions=0;const s=new Material;s.transparencyMode=TransparencyMode.ALPHA_BLEND;s.albedoColor=e?new Color4(1,0,0,0):1===t?new Color4(0,0,1,0):new Color4(1,1,0,0);s.emissiveColor=e?new Color3(1,0,0):1===t?Color3.FromHexString("#0000ff"):Color3.FromHexString("#ffff00");s.emissiveIntensity=3;if(i===n.length-1){s.albedoColor=new Color4(0,1,0,0);s.emissiveColor=new Color3(0,1,0)}r.addComponent(o);r.addComponent(s);e?r.addComponent(new Transform({position:new Vector3(.3*i+.15-.1,1.75,-.001),scale:new Vector3(.1,.1,1)})):r.addComponent(new Transform({position:new Vector3(.3*i+.15,1.95,-.001),scale:new Vector3(.02,.02,1)}));y.push(r);r.setParent(h)});const v=new Entity;v.addComponent(i);v.addComponent(new Transform({position:new Vector3(1,1.3,-.002)}));v.setParent(h);const S=e=>e>a?Math.max(0,.4-l.moveCount/a*.4/2):Math.min(.4,l.moveCount/a*.4),b=()=>{Object.values(y).forEach((e,t)=>{e.visible=0})},w=undefined,T=undefined,C=undefined,_=undefined,P=undefined,E=()=>{y.forEach((e,i)=>{const r=e.getComponent(Transform),o=e.getComponent(PlaneShape),s=e.getComponent(Material),a=e.getComponent(c).isObstacle;if(r.position.x<.2||r.position.x>=2.999)s.albedoColor=a?new Color4(1,0,0,0):1===t?new Color4(0,0,1,0):new Color4(1,1,0,0);else{s.albedoColor=a?new Color4(1,0,0,1):1===t?new Color4(0,0,1,1):new Color4(1,1,0,1);if(i===n.length-1){s.albedoColor=new Color4(0,1,0,1);s.emissiveColor=new Color3(0,1,0)}}});n[l.currentStep+4]?i.value="CLICK":l.currentStep%2==0?i.value="E":i.value="F"},I=e=>{if(l.moving){l.moveCount+=e;y.forEach((e,t)=>{const n=undefined,i=e.getComponent(Transform).position,r=.3*t+.15,o=.3*l.currentStep,s=l.moveCount/a*.3;i.set(r-o-s,i.y,i.z)});if(l.jumping){const e=g.globalOptions.position,t=S(l.moveCount);e.set(e.x,t+1.9,e.z)}}if(l.moveCount>=(l.jumping?2*a:a)){l.jumping&&l.jumps++;l.currentStep+=l.jumping?2:1;l.moving=l.jumping=0;l.moveCount=0;u.onMove&&u.onMove(l.currentStep);u.onFinish&&l.currentStep+3===n.length-1&&u.onFinish();E()}},O=undefined;return{getNextStepValue:()=>n[l.currentStep+1+3],moveScreen:e=>{l.moving=1;l.jumping=!!e;g.state.playing||(e?g.play([9,0,1],{loop:0,time:.2}):l.currentStep%2==0?g.play([1,2,3],{loop:0,time:.1}):g.play([5,6,7],{loop:0,time:.1}))},getScreenState:()=>l,onMove:e=>{u.onMove=e;return()=>u.onMove=null},onFinishScreen:e=>{u.onFinish=e;return()=>u.onFinish=null},handleVisibility:E,updateScreen:I,destroy:()=>{h.setParent(null);engine.removeEntity(h);u.onFinish=null;u.onMove=null},getTotalSteps:()=>n.length,showCross:()=>d.show(),hideCross:()=>d.hide()}};t.createScreen=l},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.SammichGame=void 0;const i=n(72),r=n(2),o=n(4),s=5;class a{constructor(e,{currentPlayer:t,seed:n,level:r,gameIndex:s}){this.gameSetup={level:1,currentPlayer:0,seed:null};this.callbacks={onFinish:null,onShareState:null,onFinishRound:null};this.state={started:0,initialized:0,blocked:0,startTime:Number.MAX_VALUE,roundStartTime:Number.MAX_VALUE,lastRoundStartTime:Number.MAX_VALUE,waitingRound:0,round:0,score:0,score1:0,score2:0};this.scene=new Entity;this.scene.addComponent(new Transform({position:new Vector3(0,2,-.001)}));this.ui=(0,o.createUI)(this.scene,{position:new Vector3(0,-2,0)});this.root=e;this.gameSetup={currentPlayer:t,seed:n,level:r,gameIndex:s};this.screen1=(0,i.createScreen)(this.scene,{player:1,seed:n,owner:1===t});this.screen2=(0,i.createScreen)(this.scene,{player:2,seed:n,owner:2===t});t&&this["screen"+t].onStateChange(e=>{void 0;void 0;this.ui.updateScore({player:this.gameSetup.currentPlayer,score:e.score+this.state.score});this.callbacks.onShareState({player:t,state:e,score:e.score+this.state.score})});engine.addSystem(this);this.roundResult1=(0,o.createRoundResult)(this.scene,{player:1});this.roundResult2=(0,o.createRoundResult)(this.scene,{player:2});const a=this.roundResult1.getTransform().position,c=this.roundResult2.getTransform().position;a.set(a.x,a.y-2,a.z);c.set(c.x,c.y-2,c.z);this.roundResult1.hide();this.roundResult2.hide()}startRound(){this.state.round++;this.state.lastRoundStartTime=this.state.roundStartTime;this.state.roundStartTime=Number.MAX_VALUE;this.state.waitingRound=0;this.gameSetup.currentPlayer&&this["screen"+this.gameSetup.currentPlayer].start({level:this.state.round})}setRoundStartTime(e){this.state.roundStartTime=e}setStartTime(e){this.state.startTime=e}block(){this.state.blocked=1}init(){this.scene.setParent(this.root);this.state.initialized=1;(0,r.playLoop)("music2",{volume:.5})}start(){void 0;this.state.started=1;this.state.startTime=Number.MAX_VALUE;this.state.roundStartTime=Number.MAX_VALUE;this.screen1.start({level:this.state.round+1});this.screen2.start({level:this.state.round+1});this.gameSetup.currentPlayer&&this["screen"+this.gameSetup.currentPlayer].onComplete(e=>{e>=6?(0,r.playOnce)("wow"):e>=4;this.state.score+=e;this.state["score"+this.gameSetup.currentPlayer]=this.state.score;const t=this.state["score"+this.gameSetup.currentPlayer];this.ui.updateScore({player:this.gameSetup.currentPlayer,score:t});void 0;setTimeout(()=>{void 0;if(this.state.round<s-1||this.state.score1===this.state.score2)this.callbacks.onFinishRound({player:this.gameSetup.currentPlayer,score:t,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round});else{void 0;(0,r.stopSound)("music2");this.callbacks.onFinish({isWinner:1,time:-1*t,score:t,gameIndex:this.gameSetup.gameIndex,roundIndex:this.state.round})}},1e3)})}finish({winner:e}){const t=1===e?2:1;this.roundResult1.show();this.roundResult2.show();this["roundResult"+e].update(1);this["roundResult"+t].update(0)}finishRound({winner:e}){this.state.waitingRound=1;this.screen1.reset();this.screen2.reset()}destroy(){this.screen1.dispose();this.screen2.dispose();this.scene.setParent(null);engine.removeEntity(this.scene);engine.removeSystem(this);this.callbacks.onShareState=null;this.callbacks.onFinish=null;this.callbacks.onFinishRound=null}shareState(e){const t=e.state,n=e.player;void 0;this.ui.updateScore({player:n,score:e.score});this["screen"+n].setState(t);this.state["score"+n]=e.score}onShareState(e){this.callbacks.onShareState=e;return()=>this.callbacks.onShareState=null}onFinish(e){this.callbacks.onFinish=e;return()=>this.callbacks.onFinish=null}onFinishRound(e){this.callbacks.onFinishRound=e;return()=>this.callbacks.onFinishRound=null}update(e){if(this.state.initialized)if(!this.state.waitingRound&&!this.state.started&&Date.now()>=this.state.startTime)this.start();else{this.state.started&&this.state.waitingRound&&Date.now()>=this.state.roundStartTime&&this.startRound();if(!this.state.waitingRound&&this.state.started){this.getPlayerScreen(1).getScreenState().idle||this.getPlayerScreen(1).updateScreen(e);this.getPlayerScreen(2).getScreenState().idle||this.getPlayerScreen(2).updateScreen(e)}}}getPlayerScreen(e){return this["screen"+e]}}t.SammichGame=a;a.id="Sammich";a.instructions="Move to sides with E and F\nto build the perfect sammich"},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createScreen=void 0;const i=n(1),r=n(0),o=n(2),s=n(3),a=[1,2,3,4,6,7,8],c=(e,{spriteIndex:t,position:n})=>{const o=new Entity;o.setParent(e);const s=new PlaneShape;s.withCollisions=0;o.addComponent(i.spriteMaterial);o.addComponent(s);const a=new Transform({scale:new Vector3(.5,.5,.5),position:n});o.addComponent(a);s.uvs=(0,r.getSpriteUv)(t,2048,16,16);const c={onBase:0,baseX:0,currentRound:1};return{setX:e=>{a.position.set(e,a.position.y,a.position.z)},setY:e=>{a.position.set(a.position.x,e,a.position.z)},getX:()=>a.position.x,getY:()=>a.position.y,isOnBase:()=>c.onBase,getBaseX:()=>c.baseX,setOnBase:(e,t)=>{c.onBase=e;c.baseX=t},dispose:()=>{o.setParent(null);o.removeComponent(Transform);o.removeComponent(i.spriteMaterial);o.removeComponent(PlaneShape);engine.removeEntity(o)}}},u=(e,{seed:t,player:n,owner:u})=>{const l=new Entity,h={dtCount:0,idle:1,level:1,basePosition:0,layers:[],score:0},d=s.seedGen.create(t.toString()),p=new PlaneShape;p.withCollisions=0;p.uvs=(0,r.getSpriteUv)(1,11,96,128);l.setParent(e);l.addComponent(new Transform({position:new Vector3(1===n?-1.5:1.5,0,-0)}));const f=new Entity,m=new Transform({scale:new Vector3(3,4,1)});f.addComponent(p);f.addComponent(i.spriteMaterial);f.addComponent(m);f.setParent(l);const g=c(l,{spriteIndex:9,position:new Vector3(0,-1.125,-.002)}),y=.25,v=e=>{Object.assign(h,e);g.setX(h.basePosition);h.layers.forEach((e,t)=>{I[t].setX(g.getX()+e);const n=g.getY()+t*C+_;I[t].setY(n)})},S=e=>{Object.assign(h,e);x.onStateChange&&x.onStateChange(h)},b=e=>{x.onStateChange=e;return()=>x.onStateChange=null},w=()=>{if(h.idle&&!u)return;const e=g.getX()===+y?+y:g.getX()+y;g.setX(e);I.forEach(e=>{e.isOnBase()&&e.setX(g.getX()-e.getBaseX())});S({basePosition:g.getX()})},T=()=>{if(h.idle&&!u)return;const e=g.getX()===-y?-y:g.getX()-y;g.setX(e);I.forEach((e,t)=>{e.isOnBase()&&e.setX(g.getX()-e.getBaseX())});S({basePosition:g.getX()})};if(u){Input.instance.subscribe("BUTTON_DOWN",ActionButton.PRIMARY,0,T);Input.instance.subscribe("BUTTON_DOWN",ActionButton.SECONDARY,0,w)}const C=.05,_=.1,P=7,E=e=>{if(h.idle)return;const t=.7*Math.min(h.level,P)+.2,n=1.75;h.dtCount+=e;I.forEach((e,i)=>{const r=i/t+.03*i*t;if(h.dtCount>=r){const s=g.getY()+i*C+_;if(e.getY()<=s){if(!u)return;if(!e.isOnBase()){e.setOnBase(1,g.getX()-e.getX());if(0!==e.getBaseX())(0,o.playOnce)("fail");else{(0,o.playOnce)("ok");h.score++}S({score:h.score,layers:[...h.layers,e.getX()-g.getX()]})}}else e.setY(Math.max(s,n-(h.dtCount-r)*t))}});if(u&&I.every((e,t)=>e.isOnBase())){h.idle=1;let e=0;I.forEach((t,n)=>{0===t.getBaseX()&&e++});x.onComplete&&x.onComplete(e);h.score=0}};let I=[];const O=()=>{I=Array(5).fill(null).map((e,t)=>{const n=d.random();let i=Math.floor(3*n-1)*y;const r=a[Math.floor(n*a.length)],o=new Vector3(i,1.75,-.001*t-.004),s=undefined;return c(l,{spriteIndex:r,position:o})});const e=d.random();let t=Math.floor(3*e-1)*y;I.push(c(l,{spriteIndex:5,position:new Vector3(t,1.75,-.005-.004)}))};O();const R=undefined,A=undefined,x={onComplete:null,onStateChange:null},k=undefined,M=undefined,N=undefined;return{getScreenState:()=>h,start:({level:e})=>{h.idle=0;h.level=e},updateScreen:E,onComplete:e=>{x.onComplete=e;return()=>x.onComplete=null},reset:()=>{h.idle=1;h.dtCount=0;h.layers=[];h.basePosition=0;h.score=0;I.forEach((e,t)=>{e.dispose()});O()},setState:v,onStateChange:b,dispose:()=>{Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.PRIMARY,T);Input.instance.unsubscribe("BUTTON_DOWN",ActionButton.SECONDARY,w);I.forEach(e=>e.dispose());I=[];x.onComplete=null;x.onStateChange=null}}};t.createScreen=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createScreen=void 0;const i=n(0),r=n(1),o=n(19),s=n(3),a=n(2),c=n(74),u=4/128,l=36*-u,h={UP:ActionButton.POINTER,LEFT:ActionButton.PRIMARY,RIGHT:ActionButton.SECONDARY},d=[12*u-1.5+8*u/2,28*u-1.5+8*u/2,44*u-1.5+8*u/2,60*u-1.5+8*u/2,76*u-1.5+8*u/2],p=(e,{x:t,index:n})=>{let r=0;const o={onTake:null},s=(0,i.createSpriteEntity)(e,{position:new Vector3(t,2-15*u+8*u/2,-.001),scale:new Vector3(8*u,8*u,1),uvs:(0,i.getSpriteUv)(2,8448,8,8)}),c=()=>{r=1;s.getShape().visible=0},l=e=>{if(r)return 0;if(e.y<2-15*u)return 0;if(e.x===t){c();(0,a.playOnce)("ok");return 1}},h=undefined,d=undefined;return{spriteEntity:s,take:c,checkFrog:l,onTake:e=>{o.onTake=e;return()=>o.onTake=null},isTaken:()=>r,index:n}},f=5,m=(e,{player:t,seed:n})=>{const m={blocked:0,lastKey:h.UP,movingFrog:0,countDt:0,frogPosition:new Vector3(0,0+l,-.009),score:0,takenSammiches:[0,0,0,0,0]},g=new Entity,y=new Entity;y.setParent(g);g.setParent(e);const v=s.seedGen.create(n),S=Array(9).fill(null).map((e,t)=>(0,c.createCarPool)(g,{track:t,randomizer:v})),b=[0,1,2,3,4],w=Array(f).fill(null).map((e,t)=>p(g,{x:d[b[t]],index:t}));g.addComponent(new Transform({position:new Vector3(1===t?-1.5:1.5,2,-0)}));y.addComponent(new Transform({scale:new Vector3(3,4,1)}));const T=new PlaneShape;T.uvs=(0,i.getSpriteUv)(9,11,96,128);y.addComponent(T);y.addComponent(r.spriteMaterial);const C=new i.SpriteAnimationSystem(g,{frames:[{uvs:(0,i.getSpriteUv)(1,8448,8,8)},{uvs:(0,i.getSpriteUv)(1,8576,8,8)}],scale:new Vector3(8*u,8*u,1),position:m.frogPosition,time:.1});C.init();const _=(e,t)=>{m.countDt+=e;S.forEach(t=>t.update(e));if(t){const e=C.getPosition(),t=w.find((t,n)=>{if(t.checkFrog(e))return{index:n}});if(t){m.takenSammiches[t.index]=1;m.score++;void 0;x.onStateChange&&x.onStateChange(m);return}S.forEach(t=>{if(t.isCollidingFrog(e)){(0,a.playOnce)("fail");m.blocked=1;setTimeout(()=>{m.blocked=0;e.set(0,l,e.z);x.onStateChange&&x.onStateChange(m)},200)}})}},P=undefined,E=e=>{if(m.movingFrog||m.blocked)return;(0,a.playOnce)("swing");m.movingFrog=1;C.setRotation(e===h.UP?0:e===h.LEFT?90:270);C.play([0,1,0],{loop:0,time:.1});const t=C.getPosition();C.addComponentOrReplace(new o.MoveTransformComponent(t,new Vector3(e===h.LEFT?t.x-8*u:e===h.RIGHT?t.x+8*u:t.x,e===h.UP?t.y+8*u:t.y,t.z),.1,()=>{m.movingFrog=0;const e=C.getPosition();if(e.y>=1.625)if((e.x+1.5)/(8*u)%2)e.y=l+8*u*10;else{m.blocked=1;setTimeout(()=>{m.blocked=0;e.set(e.x,l,e.z);m.frogPosition=e;x.onStateChange&&x.onStateChange(m)},300)}e.x<=8*u-1.5?e.x=8*u-1.5:e.x>=1.5-8*u&&(e.x=1.5-8*u);m.frogPosition=e;x.onStateChange&&x.onStateChange(m)}))},I=undefined,O=undefined,R=undefined,A=undefined,x={onStateChange:null},k=undefined,M=undefined;return{updateScreen:_,getScreenState:()=>m,up:()=>E(h.UP),left:()=>E(h.LEFT),right:()=>E(h.RIGHT),onStateChange:e=>{x.onStateChange=e;return()=>x.onStateChange=null},setFrogPosition:(e,t,n)=>{C.getPosition().set(e,t,n)},setTakenSammiches:e=>{void 0;e.forEach((e,t)=>m.takenSammiches[t]=e);w.forEach((t,n)=>{e[n]&&t.spriteEntity.hide()})},block:()=>m.blocked=1};function N(e,t,n,i){const r=Math.floor(e.random()*(n-t+1))+t;return i&&i.find(e=>e===r)?N(e,t,n,i):r}};t.createScreen=m},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createCarPool=void 0;const i=4/128,r=36*-i,o=8*i,s=new Material;s.albedoColor=Color3.Blue();const a=new PlaneShape,c=(e,{track:t,randomizer:n})=>{const r=3,c={countDt:0,nextCarAt:Number.MAX_VALUE,currentPoolIndex:0},u=e=>e+1.5;let l,h=0;const d=Array(r).fill(null).reduce((e,t)=>{let r=3*n.random()-1.5;for(;!l&&e.find(e=>u(e)-u(r)<o+i);){r=3*n.random()-1.5;h++;if(h>1e4){void 0;l=1}}e.push(r);return e},[]),p=new Array(r).fill(null).map((n,r)=>{const c=new Entity,u=new Transform({position:new Vector3(d[r],28*-i+t*i*8+(t>=4?8*i:0),-.001),scale:new Vector3(o,4*i,.1)});c.addComponent(s);c.addComponent(a);c.addComponent(u);c.setParent(e);return{entity:c,transform:u,spawned:1}}),f=e=>Math.floor(1e3*e)/1e3,m=()=>{p.filter(e=>e.spawned).forEach(e=>{const t=e.transform.position.x;t>1.5-o/2||t<o/2-1.5?e.transform.scale.set(.01,e.transform.scale.y,e.transform.scale.z):e.transform.scale.set(o,e.transform.scale.y,e.transform.scale.z)})},g=e=>{p.filter(e=>e.spawned).forEach((n,i)=>{const r=n.transform.position.x;t%2==0?r<=-1.5?n.transform.position.set(1.5,n.transform.position.y,n.transform.position.z):n.transform.position.set(f(r-.5*e),n.transform.position.y,n.transform.position.z):r>=1.5?n.transform.position.set(-1.5,n.transform.position.y,n.transform.position.z):n.transform.position.set(f(r+.5*e),n.transform.position.y,n.transform.position.z)})},y=undefined,v=undefined;return{update:e=>{c.countDt+=e;g(e)},isCollidingFrog:e=>{const t=6*i,n=4*i,r=8*i;let o=p.length;for(;o--;){const i=p[o].transform.position,s=i.x-r/2,a=i.x+r/2,c=i.y+n/2,u=i.y-n/2,l=e.x-t/2,h=e.x+t/2,d=e.y-t/2,f=e.y+t/2;if(s<=h&&a>=l&&c<=f&&u>=d){void 0;return 1}}}}};t.createCarPool=c},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createScreen=void 0;const i=n(0),r=n(3),o=n(2),s=4/128,a=36*-s,c={CLICK:ActionButton.POINTER,LEFT:ActionButton.PRIMARY,RIGHT:ActionButton.SECONDARY},u=(e,{id:t})=>{let n=t;const i={alive:0},r=new Entity,o=new PlaneShape,a=new Material;a.albedoColor=new Color3(0,0,0);const c=new Transform({position:new Vector3(0,0,-.001),scale:new Vector3(1*s,2*s,1)});r.addComponent(o);r.addComponent(a);r.addComponent(c);r.setParent(e);const u=()=>{a.albedoColor=new Color3(0,0,0);i.alive=0},l=e=>{if(i.alive){c.position.y+=1.5*e;c.position.y>4&&u()}},h=({position:e})=>{a.albedoColor=new Color3(1,1,1);c.position.copyFrom(e);c.position.z=-.001;i.alive=1};return{entity:r,transform:c,mat:a,update:l,reset:u,shoot:h,getState:()=>i,getId:()=>n}},l=(e,{id:t,y:n,left:r,radians:o,amplitude:a,velocity:c})=>{const u={id:t,y:n,left:r,radians:1e-7,amplitude:a,velocity:c||1},l={alive:0,normalY:n,normalX:r?0:3},h=new Entity,d=(0,i.createSpriteEntity)(h,{position:new Vector3(0,0,0),scale:new Vector3(8*s,8*s,1),uvs:(0,i.getSpriteUv)(4,8448,8,8)});d.hide();h.setParent(e);const f=new Transform({position:new Vector3(r?0:3,n,-.001)});h.addComponent(f);const m=()=>{d.hide();l.alive=0},g=()=>{d.show();l.alive=1;f.position.x=l.normalX=r?0:3;f.position.y=l.normalY=u.y},y=e=>{if(!l.alive)return;const t=u.left?1:-1;l.normalX+=t*e*c;r&&f.position.x>3&&m();!r&&f.position.x<0&&m();const n=f.position;l.normalY=u.y+Math.cos(p(-360*l.normalX/3*3))*a*s*8;n.y=l.normalY;n.x=l.normalX};return{entity:h,transform:f,show:d.show(),hide:d.hide(),reset:m,start:g,definition:u,getState:()=>l,update:y}},h=(e,{player:t,seed:n})=>{const a=new Entity,c=r.seedGen.create(n),h=new Array(5).fill(null).map((e,t)=>u(a,{id:t})),d=new Array(10).fill(null).map((e,t)=>l(a,{id:t,y:8*s*3.5+c.random()*(4-8*s*3.5),left:Math.floor(2*c.random()),radians:0,amplitude:1,velocity:1}));a.setParent(e);const p={onStateChange:null},f=e=>{p.onStateChange=e;return()=>p.onStateChange=null},m={blocked:0,countDt:0,nextMonsterCT:0,score:0,keyPressed:{e:0,f:0,click:0},bulletIndex:0,monsterIndex:0,lastShootTime:0},g=new Entity,y=new Entity;y.setParent(g);g.setParent(a);a.addComponent(new Transform({position:new Vector3(1===t?-3:0,0,0)}));y.addComponent(new Transform({scale:new Vector3(2.95,4,1),position:new Vector3(1.5,2,0)}));const v=new PlaneShape,S=new Material;S.albedoColor=Color3.Black();y.addComponent(S);y.addComponent(v);const b=(0,i.createSpriteEntity)(a,{position:new Vector3(1.5,20*s,-.002),scale:new Vector3(8*s,8*s),uvs:(0,i.getSpriteUv)(3,8448,8,8)}),w=undefined,T=undefined,C=undefined,_=undefined;return{getScreenState:()=>m,shoot:()=>{if(!(h[m.bulletIndex].getState().alive||Date.now()-m.lastShootTime<100)){(0,o.playOnce)("jump");h[m.bulletIndex].shoot({position:b.getTransform().position});m.lastShootTime=Date.now();m.bulletIndex=m.bulletIndex+1===h.length?0:m.bulletIndex+1}},onStateChange:f,updateScreen:(e,t)=>{m.countDt+=e;if(t){m.keyPressed.e?b.getTransform().position.x-=e:m.keyPressed.f&&(b.getTransform().position.x+=e);b.getTransform().position.x<0+8*s&&(b.getTransform().position.x=0+8*s);b.getTransform().position.x>3-8*s&&(b.getTransform().position.x=3-8*s);h.forEach(t=>t.getState().alive&&t.update(e));d.forEach(t=>t.getState().alive&&t.update(e));if(m.nextMonsterCT<=0&&!d[m.monsterIndex].getState().alive){d[m.monsterIndex].start();m.nextMonsterCT=.3;m.monsterIndex+=1;m.monsterIndex>d.length-1&&(m.monsterIndex=0)}m.nextMonsterCT-=e;let t=null;h.filter(e=>e.getState().alive).forEach(e=>{d.filter(e=>e.getState().alive).forEach(n=>{const i=e.transform.position,r=n.transform.position;i.x>=r.x-4*s&&i.x<=r.x+4*s&&i.y<=r.y+4*s&&i.y>=r.y-4*s&&(t={monster:n,bullet:e})})});if(t){t.monster.reset();t.bullet.reset();(0,o.playOnce)("swing");m.score++;p.onStateChange&&p.onStateChange(Object.assign(Object.assign({},m),{position:b.getTransform().position}))}}},setPosition:(e,t,n)=>{b.getTransform().position.set(e,t,n)},block:()=>{}}};t.createScreen=h;function d(e,t,n){var i=Math.round(Math.cos(n)*(t[0]-e[0])-Math.sin(n)*(t[1]-e[1])+e[0]),r;return{x:Math.round(Math.sin(n)*(t[0]-e[0])+Math.cos(n)*(t[1]-e[1])+e[1]),y:i}}function p(e){const t=undefined;return-e*(Math.PI/180)}},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});t.createSpectatorTrack=void 0;const r=n(6),o=n(2),s=n(5),a=n(18),c=n(0),u=n(24);let l=0;const h=(e,{lobbyRoom:t,trackSeed:n,minGames:h,alreadyStarted:f})=>i(void 0,void 0,void 0,(function*(){void 0;void 0;let m=(0,u.generateTrack)(n,h);const g={currentIndex:0,currentPlayer:0,score1:0,score2:0};let y=null;if(!f){void 0;(0,o.stopSound)("music2");yield p(100);(0,o.playOnce)("vs",{volume:1});(0,r.updateTextPanel)({value:`${t.state.player1.displayName}\nVS\n${t.state.player2.displayName}`,bottom:1,color:Color3.Black()});yield p(1e3);(0,a.reproduceVideo)(e,m[0].Game.id);(0,s.hideSpritePanel)();(0,r.updateTextPanel)({value:m[0].Game.instructions});if(y){y.destroy();y=null}y=new m[g.currentIndex].Game(e,{seed:n,currentPlayer:0,level:1})}v(t);function v(t){let n=[];n.push(t.onMessage("NEXT_GAME",({serverTime:e,startTime:t,gameIndex:n})=>{void 0;l=e-Date.now();(0,r.updateTextPanel)({value:""});(0,a.removeVideoPanel)();(0,o.stopAllSounds)();y&&y.init();y&&y.block();y&&y.setStartTime(d(t))}));n.push(t.onMessage("SHARE_STATE",e=>{y&&y.shareState(e||{})}));n.push(t.onMessage("NEXT_ROUND",({winner:e,startTime:t,serverTime:n})=>{l=n-Date.now();y&&y.finishRound&&y.finishRound({winner:e});const i=d(t);y&&y.setRoundStartTime&&y.setRoundStartTime(i)}));n.push(t.onMessage("FINSIH_AGREE",({winner:n,nextSeed:o,nextIndex:c})=>i(this,void 0,void 0,(function*(){void 0;y&&y.finish&&y.finish({winner:n});const i=t.state["player"+n].displayName;(0,r.updateTextPanel)({value:`(${n}) ${i} wins`});yield p(2e3);y&&y.destroy();y=null;if(g.currentIndex+1>=m.length&&g.score1===g.score2){m.push((0,u.generateTrack)(o,1)[0]);void 0}if(g.currentIndex<m.length){g.currentIndex=c;const t=m[c].Game.instructions||"ERROR: MISSING_INSTRUCTIONS";(0,s.hideSpritePanel)();(0,a.reproduceVideo)(e,m[c].Game.id);(0,r.updateTextPanel)({value:t+"\n"});yield p(1500);y&&y.destroy();y=null;S({nextSeed:o})}}))));n.push(t.onMessage("FINISH_TRACK",({score:e})=>{void 0;y&&y.destroy();y=null;(0,o.stopAllSounds)();(0,o.playOnce)("pwned");const t=(e.player1||0)>(e.player2||0)?1:2;(0,s.updateSpritePanel)({uvs:(0,c.getSpriteUv)(8,0,192,128),scale:new Vector3(1===t?6:-6,4,1)});(0,s.showSpritePanel)()}));n.push(t.onMessage("PLAYER_LEFT",()=>{if(y){y.destroy();y=null}}));n.push(t.onMessage("GAME_DISPOSE",()=>{void 0;n.forEach(e=>{e()});n=[]}))}function S({nextSeed:t}){void 0;const n=m[g.currentIndex].Game;if(y){y.destroy();y=null}y=new n(e,{seed:t,currentPlayer:0,level:1})}}));t.createSpectatorTrack=h;function d(e){return e-l}function p(e){return new Promise(t=>setTimeout(t,e))}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.SchemaSerializer=t.FossilDeltaSerializer=t.registerSerializer=void 0;n(78);var i=n(79);Object.defineProperty(t,"Client",{enumerable:1,get:function(){return i.Client}});var r=n(45);Object.defineProperty(t,"Protocol",{enumerable:1,get:function(){return r.Protocol}});Object.defineProperty(t,"ErrorCode",{enumerable:1,get:function(){return r.ErrorCode}});var o=n(42);Object.defineProperty(t,"Room",{enumerable:1,get:function(){return o.Room}});var s=n(48);Object.defineProperty(t,"Auth",{enumerable:1,get:function(){return s.Auth}});Object.defineProperty(t,"Platform",{enumerable:1,get:function(){return s.Platform}});var a=n(91);Object.defineProperty(t,"FossilDeltaSerializer",{enumerable:1,get:function(){return a.FossilDeltaSerializer}});var c=n(96);Object.defineProperty(t,"SchemaSerializer",{enumerable:1,get:function(){return c.SchemaSerializer}});var u=n(102),l=n(44);Object.defineProperty(t,"registerSerializer",{enumerable:1,get:function(){return l.registerSerializer}});l.registerSerializer("fossil-delta",a.FossilDeltaSerializer);l.registerSerializer("schema",c.SchemaSerializer);l.registerSerializer("none",u.NoneSerializer)},function(e,t){ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return null!==e&&"object"==typeof e&&e.buffer instanceof ArrayBuffer})},function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(o=2&s[0]?r["return"]:s[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;(r=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;r=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];r=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}};Object.defineProperty(t,"__esModule",{value:1});t.Client=t.MatchMakeError=void 0;var s=n(41),a=n(80),c=n(42),u=n(48),l=n(90),h=function(e){i(t,e);function t(n,i){var r=e.call(this,n)||this;r.code=i;Object.setPrototypeOf(r,t.prototype);return r}return t}(Error);t.MatchMakeError=h;var d=function(){function e(e){void 0===e&&(e=location.protocol.replace("http","ws")+"//"+location.hostname+(location.port&&":"+location.port));this.endpoint=e;this.auth=new u.Auth(this.endpoint);this.push=new l.Push(this.endpoint)}e.prototype.joinOrCreate=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinOrCreate",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.create=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("create",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.join=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("join",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.joinById=function(e,t,n){void 0===t&&(t={});return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,t,n)];case 1:return[2,i.sent()]}}))}))};e.prototype.reconnect=function(e,t,n){return r(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:return[4,this.createMatchMakeRequest("joinById",e,{sessionId:t},n)];case 1:return[2,i.sent()]}}))}))};e.prototype.getAvailableRooms=function(e){void 0===e&&(e="");return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:t=this.endpoint.replace("ws","http")+"/matchmake/"+e;return[4,s.get(t,{headers:{Accept:"application/json"}})];case 1:return[2,n.sent().data]}}))}))};e.prototype.consumeSeatReservation=function(e,t){return r(this,void 0,void 0,(function(){var n;return o(this,(function(i){(n=this.createRoom(e.room.name,t)).id=e.room.roomId;n.sessionId=e.sessionId;n.connect(this.buildEndpoint(e.room,{sessionId:n.sessionId}));return[2,new Promise((function(e,t){var i=function(e,n){return t(new a.ServerError(e,n))};n.onError.once(i);n["onJoin"].once((function(){n.onError.remove(i);e(n)}))}))]}))}))};e.prototype.createMatchMakeRequest=function(e,t,n,i){void 0===n&&(n={});return r(this,void 0,void 0,(function(){var r,a;return o(this,(function(o){switch(o.label){case 0:r=this.endpoint.replace("ws","http")+"/matchmake/"+e+"/"+t;this.auth.hasToken&&(n.token=this.auth.token);return[4,s.post(r,{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:if((a=o.sent().data).error)throw new h(a.error,a.code);return[2,this.consumeSeatReservation(a,i)]}}))}))};e.prototype.createRoom=function(e,t){return new c.Room(e,t)};e.prototype.buildEndpoint=function(e,t){void 0===t&&(t={});var n=[];for(var i in t)t.hasOwnProperty(i)&&n.push(i+"="+t[i]);return this.endpoint+"/"+e.processId+"/"+e.roomId+"?"+n.join("&")};return e}();t.Client=d},function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:1});t.ServerError=void 0;var r=function(e){i(t,e);function t(t,n){var i=e.call(this,n)||this;i.name="ServerError";i.code=t;return i}return t}(Error);t.ServerError=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});function i(e,t){this._offset=t;if(e instanceof ArrayBuffer){this._buffer=e;this._view=new DataView(this._buffer)}else{if(!ArrayBuffer.isView(e))throw new Error("Invalid argument");this._buffer=e.buffer;this._view=new DataView(this._buffer,e.byteOffset,e.byteLength)}}function r(e,t,n){for(var i="",r=0,o=t,s=t+n;o<s;o++){var a=e.getUint8(o);if(0!=(128&a))if(192!=(224&a))if(224!=(240&a)){if(240!=(248&a))throw new Error("Invalid byte "+a.toString(16));if((r=(7&a)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)>=65536){r-=65536;i+=String.fromCharCode(55296+(r>>>10),56320+(1023&r))}else i+=String.fromCharCode(r)}else i+=String.fromCharCode((15&a)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else i+=String.fromCharCode((31&a)<<6|63&e.getUint8(++o));else i+=String.fromCharCode(a)}return i}i.prototype._array=function(e){for(var t=new Array(e),n=0;n<e;n++)t[n]=this._parse();return t};i.prototype._map=function(e){for(var t="",n={},i=0;i<e;i++)n[t=this._parse()]=this._parse();return n};i.prototype._str=function(e){var t=r(this._view,this._offset,e);this._offset+=e;return t};i.prototype._bin=function(e){var t=this._buffer.slice(this._offset,this._offset+e);this._offset+=e;return t};i.prototype._parse=function(){var e=this._view.getUint8(this._offset++),t,n=0,i=0,r=0,o=0;if(e<192)return e<128?e:e<144?this._map(15&e):e<160?this._array(15&e):this._str(31&e);if(e>223)return-1*(255-e+1);switch(e){case 192:return null;case 194:return 0;case 195:return 1;case 196:n=this._view.getUint8(this._offset);this._offset+=1;return this._bin(n);case 197:n=this._view.getUint16(this._offset);this._offset+=2;return this._bin(n);case 198:n=this._view.getUint32(this._offset);this._offset+=4;return this._bin(n);case 199:n=this._view.getUint8(this._offset);i=this._view.getInt8(this._offset+1);this._offset+=2;return[i,this._bin(n)];case 200:n=this._view.getUint16(this._offset);i=this._view.getInt8(this._offset+2);this._offset+=3;return[i,this._bin(n)];case 201:n=this._view.getUint32(this._offset);i=this._view.getInt8(this._offset+4);this._offset+=5;return[i,this._bin(n)];case 202:t=this._view.getFloat32(this._offset);this._offset+=4;return t;case 203:t=this._view.getFloat64(this._offset);this._offset+=8;return t;case 204:t=this._view.getUint8(this._offset);this._offset+=1;return t;case 205:t=this._view.getUint16(this._offset);this._offset+=2;return t;case 206:t=this._view.getUint32(this._offset);this._offset+=4;return t;case 207:r=this._view.getUint32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return r+o;case 208:t=this._view.getInt8(this._offset);this._offset+=1;return t;case 209:t=this._view.getInt16(this._offset);this._offset+=2;return t;case 210:t=this._view.getInt32(this._offset);this._offset+=4;return t;case 211:r=this._view.getInt32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return r+o;case 212:i=this._view.getInt8(this._offset);this._offset+=1;if(0===i){this._offset+=1;return}return[i,this._bin(1)];case 213:i=this._view.getInt8(this._offset);this._offset+=1;return[i,this._bin(2)];case 214:i=this._view.getInt8(this._offset);this._offset+=1;return[i,this._bin(4)];case 215:i=this._view.getInt8(this._offset);this._offset+=1;if(0===i){r=this._view.getInt32(this._offset)*Math.pow(2,32);o=this._view.getUint32(this._offset+4);this._offset+=8;return new Date(r+o)}return[i,this._bin(8)];case 216:i=this._view.getInt8(this._offset);this._offset+=1;return[i,this._bin(16)];case 217:n=this._view.getUint8(this._offset);this._offset+=1;return this._str(n);case 218:n=this._view.getUint16(this._offset);this._offset+=2;return this._str(n);case 219:n=this._view.getUint32(this._offset);this._offset+=4;return this._str(n);case 220:n=this._view.getUint16(this._offset);this._offset+=2;return this._array(n);case 221:n=this._view.getUint32(this._offset);this._offset+=4;return this._array(n);case 222:n=this._view.getUint16(this._offset);this._offset+=2;return this._map(n);case 223:n=this._view.getUint32(this._offset);this._offset+=4;return this._map(n)}throw new Error("Could not parse")};function o(e,t){void 0===t&&(t=0);var n=new i(e,t),r=n._parse();if(n._offset!==e.byteLength)throw new Error(e.byteLength-n._offset+" trailing bytes");return r}t.default=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});function i(e,t,n){for(var i=0,r=0,o=n.length;r<o;r++)if((i=n.charCodeAt(r))<128)e.setUint8(t++,i);else if(i<2048){e.setUint8(t++,192|i>>6);e.setUint8(t++,128|63&i)}else if(i<55296||i>=57344){e.setUint8(t++,224|i>>12);e.setUint8(t++,128|i>>6&63);e.setUint8(t++,128|63&i)}else{r++;i=65536+((1023&i)<<10|1023&n.charCodeAt(r));e.setUint8(t++,240|i>>18);e.setUint8(t++,128|i>>12&63);e.setUint8(t++,128|i>>6&63);e.setUint8(t++,128|63&i)}}function r(e){for(var t=0,n=0,i=0,r=e.length;i<r;i++)if((t=e.charCodeAt(i))<128)n+=1;else if(t<2048)n+=2;else if(t<55296||t>=57344)n+=3;else{i++;n+=4}return n}function o(e,t,n){var i=typeof n,s=0,a=0,c=0,u=0,l=0,h=0;if("string"===i){if((l=r(n))<32){e.push(160|l);h=1}else if(l<256){e.push(217,l);h=2}else if(l<65536){e.push(218,l>>8,l);h=3}else{if(!(l<4294967296))throw new Error("String too long");e.push(219,l>>24,l>>16,l>>8,l);h=5}t.push({_str:n,_length:l,_offset:e.length});return h+l}if("number"===i){if(Math.floor(n)!==n||!isFinite(n)){e.push(203);t.push({_float:n,_length:8,_offset:e.length});return 9}if(n>=0){if(n<128){e.push(n);return 1}if(n<256){e.push(204,n);return 2}if(n<65536){e.push(205,n>>8,n);return 3}if(n<4294967296){e.push(206,n>>24,n>>16,n>>8,n);return 5}c=n/Math.pow(2,32)>>0;u=n>>>0;e.push(207,c>>24,c>>16,c>>8,c,u>>24,u>>16,u>>8,u);return 9}if(n>=-32){e.push(n);return 1}if(n>=-128){e.push(208,n);return 2}if(n>=-32768){e.push(209,n>>8,n);return 3}if(n>=-2147483648){e.push(210,n>>24,n>>16,n>>8,n);return 5}c=Math.floor(n/Math.pow(2,32));u=n>>>0;e.push(211,c>>24,c>>16,c>>8,c,u>>24,u>>16,u>>8,u);return 9}if("object"===i){if(null===n){e.push(192);return 1}if(Array.isArray(n)){if((l=n.length)<16){e.push(144|l);h=1}else if(l<65536){e.push(220,l>>8,l);h=3}else{if(!(l<4294967296))throw new Error("Array too large");e.push(221,l>>24,l>>16,l>>8,l);h=5}for(s=0;s<l;s++)h+=o(e,t,n[s]);return h}if(n instanceof Date){var d=n.getTime();c=Math.floor(d/Math.pow(2,32));u=d>>>0;e.push(215,0,c>>24,c>>16,c>>8,c,u>>24,u>>16,u>>8,u);return 10}if(n instanceof ArrayBuffer){if((l=n.byteLength)<256){e.push(196,l);h=2}else if(l<65536){e.push(197,l>>8,l);h=3}else{if(!(l<4294967296))throw new Error("Buffer too large");e.push(198,l>>24,l>>16,l>>8,l);h=5}t.push({_bin:n,_length:l,_offset:e.length});return h+l}if("function"==typeof n.toJSON)return o(e,t,n.toJSON());var p=[],f="",m=Object.keys(n);for(s=0,a=m.length;s<a;s++)"function"!=typeof n[f=m[s]]&&p.push(f);if((l=p.length)<16){e.push(128|l);h=1}else if(l<65536){e.push(222,l>>8,l);h=3}else{if(!(l<4294967296))throw new Error("Object too large");e.push(223,l>>24,l>>16,l>>8,l);h=5}for(s=0;s<l;s++){h+=o(e,t,f=p[s]);h+=o(e,t,n[f])}return h}if("boolean"===i){e.push(n?195:194);return 1}if("undefined"===i){e.push(212,0,0);return 3}throw new Error("Could not encode")}function s(e){var t=[],n=[],r=o(t,n,e),s=new ArrayBuffer(r),a=new DataView(s),c=0,u=0,l=-1;n.length>0&&(l=n[0]._offset);for(var h,d=0,p=0,f=0,m=t.length;f<m;f++){a.setUint8(u+f,t[f]);if(f+1===l){d=(h=n[c])._length;p=u+l;if(h._bin)for(var g=new Uint8Array(h._bin),y=0;y<d;y++)a.setUint8(p+y,g[y]);else h._str?i(a,p,h._str):void 0!==h._float&&a.setFloat64(p,h._float);u+=d;n[++c]&&(l=n[c]._offset)}}return s}t.default=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var i=function(){function e(){this.handlers=[]}e.prototype.register=function(e,t){void 0===t&&(t=0);this.handlers.push(e);return this};e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,e)}))};e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,e)})))};e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1];this.handlers.pop()};e.prototype.clear=function(){this.handlers=[]};return e}();t.EventEmitter=i;function r(){var e=new i;function t(t){return e.register(t,null===this)}t.once=function(t){var n=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];t.apply(void 0,i);e.remove(n)};e.register(n)};t.remove=function(t){return e.remove(t)};t.invoke=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invoke.apply(e,t)};t.invokeAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.invokeAsync.apply(e,t)};t.clear=function(){return e.clear()};return t}t.createSignal=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createNanoEvents=void 0;let i=()=>({events:{},emit(e,...t){for(let n of this.events[e]||[])n(...t)},on(e,t){(this.events[e]=this.events[e]||[]).push(t);return()=>this.events[e]=this.events[e].filter(e=>e!==t)}});t.createNanoEvents=i},function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:1});t.Connection=void 0;var o=r(n(86)),s=function(e){i(t,e);function t(t,n){void 0===n&&(n=1);var i=e.call(this,t,void 0,{connect:n})||this;i._enqueuedCalls=[];return i}t.prototype.onOpenCallback=function(t){e.prototype.onOpenCallback.call(this);this.binaryType="arraybuffer";if(this._enqueuedCalls.length>0){for(var n=0,i=this._enqueuedCalls;n<i.length;n++){var r=i[n],o=r[0],s=r[1];this[o].apply(this,s)}this._enqueuedCalls=[]}};t.prototype.send=function(t){if(this.ws.readyState===o.default.OPEN){if(t instanceof ArrayBuffer)return e.prototype.send.call(this,t);if(Array.isArray(t))return e.prototype.send.call(this,new Uint8Array(t).buffer)}else this._enqueuedCalls.push(["send",[t]])};return t}(o.default);t.Connection=s},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||0;i.configurable=1;"value"in i&&(i.writable=1);Object.defineProperty(e,i.key,i)}}return function(t,n,i){n&&e(t.prototype,n);i&&e(t,i);return t}}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=n(87).createBackoff,s="undefined"!=typeof WebSocket?WebSocket:n(88),a=function(){function e(t,n,i){var s=arguments.length>2&&void 0!==i?arguments[2]:{};r(this,e);this.url=t;this.protocols=n;this.reconnectEnabled=1;this.listeners={};this.backoff=o(s.backoff||"exponential",s);this.backoff.onReady=this.onBackoffReady.bind(this);("undefined"==typeof s.connect||s.connect)&&this.open()}i(e,[{key:"open",value:function e(t){var n=arguments.length>0&&void 0!==t?arguments[0]:0;this.isReconnect=n;var i=this.ws&&this.ws.binaryType;this.ws=new s(this.url,this.protocols);this.ws.onclose=this.onCloseCallback.bind(this);this.ws.onerror=this.onErrorCallback.bind(this);this.ws.onmessage=this.onMessageCallback.bind(this);this.ws.onopen=this.onOpenCallback.bind(this);i&&(this.ws.binaryType=i)}},{key:"onBackoffReady",value:function e(t,n){this.open(1)}},{key:"onCloseCallback",value:function e(t){!this.isReconnect&&this.listeners["onclose"]&&this.listeners["onclose"].apply(null,arguments);this.reconnectEnabled&&t.code<3e3&&this.backoff.backoff()}},{key:"onErrorCallback",value:function e(){this.listeners["onerror"]&&this.listeners["onerror"].apply(null,arguments)}},{key:"onMessageCallback",value:function e(){this.listeners["onmessage"]&&this.listeners["onmessage"].apply(null,arguments)}},{key:"onOpenCallback",value:function e(){this.listeners["onopen"]&&this.listeners["onopen"].apply(null,arguments);this.isReconnect&&this.listeners["onreconnect"]&&this.listeners["onreconnect"].apply(null,arguments);this.isReconnect=0}},{key:"close",value:function e(t,n){"undefined"==typeof t&&(t=1e3);this.reconnectEnabled=0;this.ws.close(t,n)}},{key:"send",value:function e(t){this.ws.send(t)}},{key:"bufferedAmount",get:function e(){return this.ws.bufferedAmount}},{key:"readyState",get:function e(){return this.ws.readyState}},{key:"binaryType",get:function e(){return this.ws.binaryType},set:function e(t){this.ws.binaryType=t}},{key:"extensions",get:function e(){return this.ws.extensions},set:function e(t){this.ws.extensions=t}},{key:"protocol",get:function e(){return this.ws.protocol},set:function e(t){this.ws.protocol=t}},{key:"onclose",set:function e(t){this.listeners["onclose"]=t},get:function e(){return this.listeners["onclose"]}},{key:"onerror",set:function e(t){this.listeners["onerror"]=t},get:function e(){return this.listeners["onerror"]}},{key:"onmessage",set:function e(t){this.listeners["onmessage"]=t},get:function e(){return this.listeners["onmessage"]}},{key:"onopen",set:function e(t){this.listeners["onopen"]=t},get:function e(){return this.listeners["onopen"]}},{key:"onreconnect",set:function e(t){this.listeners["onreconnect"]=t},get:function e(){return this.listeners["onreconnect"]}}]);return e}();a.CONNECTING=s.CONNECTING;a.OPEN=s.OPEN;a.CLOSING=s.CLOSING;a.CLOSED=s.CLOSED;t.default=a},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createBackoff=r;var i={exponential:function e(t,n){return Math.floor(Math.random()*Math.pow(2,t)*n)},fibonacci:function e(t,n){var i;if(t>(i=1))for(var r=1,i=2,o=2;o<t;o++){var s=r+i;r=i;i=s}return Math.floor(Math.random()*i*n)}};function r(e,t){return new o(i[e],t)}function o(e,t){this.func=e;this.attempts=0;this.delay="undefined"!=typeof t.initialDelay?t.initialDelay:100}o.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay))}},function(e,t){},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.getItem=t.removeItem=t.setItem=void 0;var i;function r(){i||(i="undefined"!=typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(e,t){this.cache[e]=t},getItem:function(e){this.cache[e]},removeItem:function(e){delete this.cache[e]}});return i}function o(e,t){r().setItem(e,t)}t.setItem=o;function s(e){r().removeItem(e)}t.removeItem=s;function a(e,t){var n=r().getItem(e);"undefined"!=typeof Promise&&n instanceof Promise?n.then((function(e){return t(e)})):t(n)}t.getItem=a},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i,r,o,s;return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(e){return function(t){return c([e,t])}}function c(s){if(i)throw new TypeError("Generator is already executing.");for(;n;)try{if(i=1,r&&(o=2&s[0]?r["return"]:s[0]?r["throw"]||((o=r["return"])&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;(r=0,o)&&(s=[2&s[0],o.value]);switch(s[0]){case 0:case 1:o=s;break;case 4:n.label++;return{value:s[1],done:0};case 5:n.label++;r=s[1];s=[0];continue;case 7:s=n.ops.pop();n.trys.pop();continue;default:if(!(o=n.trys,o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){n=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){n.label=s[1];break}if(6===s[0]&&n.label<o[1]){n.label=o[1];o=s;break}if(o&&n.label<o[2]){n.label=o[2];n.ops.push(s);break}o[2]&&n.ops.pop();n.trys.pop();continue}s=t.call(e,n)}catch(e){s=[6,e];r=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:1}}};Object.defineProperty(t,"__esModule",{value:1});t.Push=void 0;var o=function(){function e(e){this.endpoint=e.replace("ws","http")}e.prototype.register=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:this.check();return[4,this.registerServiceWorker()];case 1:e.sent();return[4,this.requestNotificationPermission()];case 2:e.sent();return[2]}}))}))};e.prototype.registerServiceWorker=function(){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,navigator.serviceWorker.register(this.endpoint+"/push")];case 1:return[2,e.sent()]}}))}))};e.prototype.requestNotificationPermission=function(){return i(this,void 0,void 0,(function(){var e;return r(this,(function(t){switch(t.label){case 0:return[4,window["Notification"].requestPermission()];case 1:if("granted"!==(e=t.sent()))throw new Error("Permission not granted for Notification");return[2]}}))}))};e.prototype.check=function(){if(!("serviceWorker"in navigator))throw new Error("No Service Worker support!");if(!("PushManager"in window))throw new Error("No Push API Support!")};return e}();t.Push=o},function(e,t,n){var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);Object.defineProperty(e,i,{enumerable:1,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n);e[i]=t[n]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:1,value:t})}:function(e,t){e["default"]=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.hasOwnProperty.call(e,n)&&i(t,e,n);r(t,e);return t};Object.defineProperty(t,"__esModule",{value:1});t.FossilDeltaSerializer=void 0;var s=n(92),a=o(n(95)),c=o(n(43)),u=function(){function e(){this.api=new s.StateContainer({})}e.prototype.getState=function(){return this.api.state};e.prototype.setState=function(e){this.previousState=new Uint8Array(e);this.api.set(c.decode(this.previousState))};e.prototype.patch=function(e){this.previousState=new Uint8Array(a.apply(this.previousState,e));this.api.set(c.decode(this.previousState))};e.prototype.teardown=function(){this.api.removeAllListeners()};return e}();t.FossilDeltaSerializer=u},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var i=n(93);t.StateContainer=i.StateContainer},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});var i=n(94),r=function(){function e(e){this.listeners=[];this.matcherPlaceholders={":id":/^([a-zA-Z0-9\-_]+)$/,":number":/^([0-9]+)$/,":string":/^(\w+)$/,":axis":/^([xyz])$/,":*":/(.*)/};this.state=e;this.reset()}e.prototype.set=function(e){var t=i.compare(this.state,e);this.state=e;this.checkPatches(t,this.listeners,this.defaultListener);return t};e.prototype.registerPlaceholder=function(e,t){this.matcherPlaceholders[e]=t};e.prototype.listen=function(e,t,n){var r=this,o;if("function"==typeof e){o=[];t=e}else o=e.split("/");t.length>1,0;var s={callback:t,rawRules:o,rules:o.map((function(e){return"string"==typeof e?0===e.indexOf(":")?r.matcherPlaceholders[e]||r.matcherPlaceholders[":*"]:new RegExp("^"+e+"$"):e}))};0===o.length?this.defaultListener=s:this.listeners.push(s);n&&this.checkPatches(i.compare({},this.state),[s]);return s};e.prototype.removeListener=function(e){for(var t=this.listeners.length-1;t>=0;t--)this.listeners[t]===e&&this.listeners.splice(t,1)};e.prototype.removeAllListeners=function(){this.reset()};e.prototype.checkPatches=function(e,t,n){for(var i=0,r=t.length;i<r;i++)for(var o=t[i],s=e.length-1;s>=0;s--){var a=o&&this.getPathVariables(e[s],o);if(a){o.callback({path:a,rawPath:e[s].path,operation:e[s].operation,value:e[s].value});e[s].matched=1}}if(n)for(var s=e.length-1;s>=0;s--)e[s].matched||n.callback(e[s])};e.prototype.getPathVariables=function(e,t){if(e.path.length!==t.rules.length)return 0;for(var n={},i=0,r=t.rules.length;i<r;i++){var o=e.path[i].match(t.rules[i]);if(!o||0===o.length||o.length>2)return 0;":"===t.rawRules[i].substr(0,1)&&(n[t.rawRules[i].substr(1)]=o[1])}return n};e.prototype.reset=function(){this.listeners=[]};return e}();t.StateContainer=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});function i(e,t){var n=[];s(e,t,n,[]);return n}t.compare=i;function r(e,t){var n=e.slice();n.push(t);return n}function o(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)e.hasOwnProperty(r)&&i.push(r);return i}function s(e,t,n,i){for(var a=o(t),c=o(e),u=0,l=c.length-1;l>=0;l--){var h,d=e[h=c[l]];if(!t.hasOwnProperty(h)||void 0===t[h]&&void 0!==d&&0==Array.isArray(t)){n.push({operation:"remove",path:r(i,h)});u=1}else{var p=t[h];"object"==typeof d&&null!=d&&"object"==typeof p&&null!=p?s(d,p,n,r(i,h)):d!==p&&n.push({operation:"replace",path:r(i,h),value:p,previousValue:d})}}if(u||a.length!=c.length)for(var l=a.length-1;l>=0;l--){var h=a[l];if(!e.hasOwnProperty(h)&&void 0!==t[h]){var p=t[h],f=r(i,h);"object"==typeof p&&null!=p&&s({},p,n,f);n.push({operation:"add",path:f,value:p})}}}},function(e,t,n){(function(t,n){1,e.exports?e.exports=n():t.fossilDelta=n()})(this,(function(){var e={},t=16;function n(){this.a=0;this.b=0;this.i=0;this.z=new Array(t)}n.prototype.init=function(e,n){var i=0,r=0,o,s;for(o=0;o<t;o++){i=i+(s=e[n+o])&65535;r=r+(t-o)*s&65535;this.z[o]=s}this.a=65535&i;this.b=65535&r;this.i=0};n.prototype.next=function(e){var n=this.z[this.i];this.z[this.i]=e;this.i=this.i+1&t-1;this.a=this.a-n+e&65535;this.b=this.b-t*n+this.a&65535};n.prototype.value=function(){return(65535&this.a|(65535&this.b)<<16)>>>0};var i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~".split("").map((function(e){return e.charCodeAt(0)})),r=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,36,-1,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,-1,-1,-1,63,-1];function o(e){this.a=e;this.pos=0}o.prototype.haveBytes=function(){return this.pos<this.a.length};o.prototype.getByte=function(){var e=this.a[this.pos];this.pos++;if(this.pos>this.a.length)throw new RangeError("out of bounds");return e};o.prototype.getChar=function(){return String.fromCharCode(this.getByte())};o.prototype.getInt=function(){for(var e=0,t;this.haveBytes()&&(t=r[127&this.getByte()])>=0;)e=(e<<6)+t;this.pos--;return e>>>0};function s(){this.a=[]}s.prototype.toArray=function(){return this.a};s.prototype.putByte=function(e){this.a.push(255&e)};s.prototype.putChar=function(e){this.putByte(e.charCodeAt(0))};s.prototype.putInt=function(e){var t,n,r=[];if(0!==e){for(t=0;e>0;t++,e>>>=6)r.push(i[63&e]);for(n=t-1;n>=0;n--)this.putByte(r[n])}else this.putChar("0")};s.prototype.putArray=function(e,t,n){for(var i=t;i<n;i++)this.a.push(e[i])};function a(e){var t,n;for(t=1,n=64;e>=n;t++,n<<=6);return t}function c(e){for(var t=0,n=0,i=0,r=0,o=0,s=e.length;s>=16;){t=t+e[o+0]|0;n=n+e[o+1]|0;i=i+e[o+2]|0;r=r+e[o+3]|0;t=t+e[o+4]|0;n=n+e[o+5]|0;i=i+e[o+6]|0;r=r+e[o+7]|0;t=t+e[o+8]|0;n=n+e[o+9]|0;i=i+e[o+10]|0;r=r+e[o+11]|0;t=t+e[o+12]|0;n=n+e[o+13]|0;i=i+e[o+14]|0;r=r+e[o+15]|0;o+=16;s-=16}for(;s>=4;){t=t+e[o+0]|0;n=n+e[o+1]|0;i=i+e[o+2]|0;r=r+e[o+3]|0;o+=4;s-=4}r=((r+(i<<8)|0)+(n<<16)|0)+(t<<24)|0;switch(s){case 3:r=r+(e[o+2]<<8)|0;case 2:r=r+(e[o+1]<<16)|0;case 1:r=r+(e[o+0]<<24)|0}return r>>>0}e.create=function(e,i){var r=new s,o=i.length,u=e.length,l,h=-1;r.putInt(o);r.putChar("\n");if(u<=t){r.putInt(o);r.putChar(":");r.putArray(i,0,o);r.putInt(c(i));r.putChar(";");return r.toArray()}var d=Math.ceil(u/t),p=new Array(d),f=new Array(d);for(l=0;l<p.length;l++)p[l]=-1;for(l=0;l<f.length;l++)f[l]=-1;var m,g=new n;for(l=0;l<u-t;l+=t){g.init(e,l);m=g.value()%d;p[l/t]=f[m];f[m]=l/t}for(var y=0,v,S,b,w,T;y+t<o;){w=0;T=0;g.init(i,y);l=0;b=0;for(;;){var C=250;S=f[m=g.value()%d];for(;S>=0&&C-- >0;){var _,P,E,I,O,R,A,x;for(I=0,R=v=S*t,A=y+l;R<u&&A<o&&e[R]===i[A];I++,R++,A++);I--;for(O=1;O<v&&O<=l&&e[v-O]===i[y+l-O];O++);P=v- --O;E=l-O;if((_=I+O+1)>=(x=a(l-O)+a(_)+a(P)+3)&&_>b){b=_;w=v-O;T=E}S=p[S]}if(b>0){if(T>0){r.putInt(T);r.putChar(":");r.putArray(i,y,y+T);y+=T}y+=b;r.putInt(b);r.putChar("@");r.putInt(w);r.putChar(",");w+b-1>h&&(h=w+b-1);b=0;break}if(y+l+t>=o){r.putInt(o-y);r.putChar(":");r.putArray(i,y,y+o-y);y=o;break}g.next(i[y+l+t]);l++}}if(y<o){r.putInt(o-y);r.putChar(":");r.putArray(i,y,y+o-y)}r.putInt(c(i));r.putChar(";");return r.toArray()};e.outputSize=function(e){var t=new o(e),n=t.getInt();if("\n"!==t.getChar())throw new Error("size integer not terminated by '\\n'");return n};e.apply=function(e,t,n){var i,r=0,a=new o(t),u=e.length,l=t.length;i=a.getInt();if("\n"!==a.getChar())throw new Error("size integer not terminated by '\\n'");for(var h=new s;a.haveBytes();){var d,p;d=a.getInt();switch(a.getChar()){case"@":p=a.getInt();if(a.haveBytes()&&","!==a.getChar())throw new Error("copy command not terminated by ','");if((r+=d)>i)throw new Error("copy exceeds output file size");if(p+d>u)throw new Error("copy extends past end of input");h.putArray(e,p,p+d);break;case":":if((r+=d)>i)throw new Error("insert command gives an output larger than predicted");if(d>l)throw new Error("insert count exceeds size of delta");h.putArray(a.a,a.pos,a.pos+d);a.pos+=d;break;case";":var f=h.toArray();if((!n||0!=n.verifyChecksum)&&d!==c(f))throw new Error("bad checksum");if(r!==i)throw new Error("generated size does not match predicted size");return f;default:throw new Error("unknown delta operator")}}throw new Error("unterminated delta")};return e}))},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.SchemaSerializer=void 0;var i=n(97),r=function(){function e(){}e.prototype.setState=function(e){this.state.decode(e)};e.prototype.getState=function(){return this.state};e.prototype.patch=function(e){this.state.decode(e)};e.prototype.teardown=function(){var e,t;null===(t=null===(e=this.state)||void 0===e?void 0:e["$changes"])||void 0===t?void 0:t.root.clearRefs()};e.prototype.handshake=function(e,t){if(this.state){var n;(new i.Reflection).decode(e,t)}else this.state=i.Reflection.decode(e,t)};return e}();t.SchemaSerializer=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.registerType=t.SetSchema=t.CollectionSchema=t.ArraySchema=t.MapSchema=void 0;var i=n(8);Object.defineProperty(t,"Schema",{enumerable:1,get:function(){return i.Schema}});var r=n(23);Object.defineProperty(t,"MapSchema",{enumerable:1,get:function(){return r.MapSchema}});var o=n(14);Object.defineProperty(t,"ArraySchema",{enumerable:1,get:function(){return o.ArraySchema}});var s=n(49);Object.defineProperty(t,"CollectionSchema",{enumerable:1,get:function(){return s.CollectionSchema}});var a=n(50);Object.defineProperty(t,"SetSchema",{enumerable:1,get:function(){return a.SetSchema}});var c=n(15);Object.defineProperty(t,"registerType",{enumerable:1,get:function(){return c.registerType}});c.registerType("map",{constructor:r.MapSchema,getProxy:r.getMapProxy});c.registerType("array",{constructor:o.ArraySchema,getProxy:o.getArrayProxy});c.registerType("set",{constructor:a.SetSchema});c.registerType("collection",{constructor:s.CollectionSchema});var u=n(100);Object.defineProperty(t,"dumpChanges",{enumerable:1,get:function(){return u.dumpChanges}});var l=n(101);Object.defineProperty(t,"Reflection",{enumerable:1,get:function(){return l.Reflection}});Object.defineProperty(t,"ReflectionType",{enumerable:1,get:function(){return l.ReflectionType}});Object.defineProperty(t,"ReflectionField",{enumerable:1,get:function(){return l.ReflectionField}});var h=n(22);Object.defineProperty(t,"type",{enumerable:1,get:function(){return h.type}});Object.defineProperty(t,"deprecated",{enumerable:1,get:function(){return h.deprecated}});Object.defineProperty(t,"filter",{enumerable:1,get:function(){return h.filter}});Object.defineProperty(t,"filterChildren",{enumerable:1,get:function(){return h.filterChildren}});Object.defineProperty(t,"defineTypes",{enumerable:1,get:function(){return h.defineTypes}});Object.defineProperty(t,"hasFilter",{enumerable:1,get:function(){return h.hasFilter}});Object.defineProperty(t,"SchemaDefinition",{enumerable:1,get:function(){return h.SchemaDefinition}});Object.defineProperty(t,"Context",{enumerable:1,get:function(){return h.Context}});var d=n(7);Object.defineProperty(t,"OPERATION",{enumerable:1,get:function(){return d.OPERATION}})},function(e,t,n){var i=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i=n.call(e),r,o=[],s;try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i["return"])&&n.call(i)}finally{if(s)throw s.error}}return o},r=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e};Object.defineProperty(t,"__esModule",{value:1});t.EventEmitter=void 0;var o=function(){function e(){this.handlers=[]}e.prototype.register=function(e,t){void 0===t&&(t=0);this.handlers.push(e);return this};e.prototype.invoke=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.handlers.forEach((function(t){return t.apply(void 0,r(e))}))};e.prototype.invokeAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.all(this.handlers.map((function(t){return t.apply(void 0,r(e))})))};e.prototype.remove=function(e){var t=this.handlers.indexOf(e);this.handlers[t]=this.handlers[this.handlers.length-1];this.handlers.pop()};e.prototype.clear=function(){this.handlers=[]};return e}();t.EventEmitter=o},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.ClientState=void 0;var i=function(){function e(){this.refIds=new WeakSet;this.containerIndexes=new WeakMap}e.prototype.addRefId=function(e){if(!this.refIds.has(e)){this.refIds.add(e);this.containerIndexes.set(e,new Set)}};e.get=function(t){void 0===t.$filterState&&(t.$filterState=new e);return t.$filterState};return e}();t.ClientState=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.dumpChanges=void 0;function i(e){for(var t=[e["$changes"]],n=1,i={},r=i,o=function(e){var n=t[e];n.changes.forEach((function(e){var t=n.ref,i=e.index,o=t["_definition"]?t["_definition"].fieldsByIndex[i]:t["$indexes"].get(i);r[o]=n.getValue(i)}))},s=0;s<n;s++)o(s);return i}t.dumpChanges=i},function(e,t,n){var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),r=this&&this.__decorate||function(e,t,n,i){var r=arguments.length,o=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i,s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,n,o):s(t,n))||o);return r>3&&o&&Object.defineProperty(t,n,o),o};Object.defineProperty(t,"__esModule",{value:1});t.Reflection=t.ReflectionType=t.ReflectionField=void 0;var o=n(22),s=n(8),a=n(14),c=n(15),u=new o.Context,l=function(e){i(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}r([o.type("string",u)],t.prototype,"name",void 0);r([o.type("string",u)],t.prototype,"type",void 0);r([o.type("number",u)],t.prototype,"referencedType",void 0);return t}(s.Schema);t.ReflectionField=l;var h=function(e){i(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.fields=new a.ArraySchema;return t}r([o.type("number",u)],t.prototype,"id",void 0);r([o.type([l],u)],t.prototype,"fields",void 0);return t}(s.Schema);t.ReflectionType=h;var d=function(e){i(t,e);function t(){var t=null!==e&&e.apply(this,arguments)||this;t.types=new a.ArraySchema;return t}t.encode=function(e){var n=e.constructor,i=new t;i.rootType=n._typeid;var r=function(e,t){for(var n in t){var r=new l;r.name=n;var o=void 0;if("string"==typeof t[n])o=t[n];else{var a=t[n],c=void 0;if(s.Schema.is(a)){o="ref";c=t[n]}else"string"==typeof a[o=Object.keys(a)[0]]?o+=":"+a[o]:c=a[o];r.referencedType=c?c._typeid:-1}r.type=o;e.fields.push(r)}i.types.push(e)},o=n._context.types;for(var a in o){var c=new h;c.id=Number(a);r(c,o[a]._definition.schema)}return i.encodeAll()};t.decode=function(e,n){var r=new o.Context,a=new t;a.decode(e,n);var u=a.types.reduce((function(e,t){var n=function(e){i(t,e);function t(){return null!==e&&e.apply(this,arguments)||this}return t}(s.Schema),o=t.id;e[o]=n;r.add(n,o);return e}),{});a.types.forEach((function(e){var t=u[e.id];e.fields.forEach((function(e){var n;if(void 0!==e.referencedType){var i=e.type,s=u[e.referencedType];if(!s){var a=e.type.split(":");i=a[0];s=a[1]}"ref"===i?o.type(s,r)(t.prototype,e.name):o.type(((n={})[i]=s,n),r)(t.prototype,e.name)}else o.type(e.type,r)(t.prototype,e.name)}))}));var l=u[a.rootType],h=new l;for(var d in l._definition.schema){var p=l._definition.schema[d];"string"!=typeof p&&(h[d]="function"==typeof p?new p:new(c.getType(Object.keys(p)[0]).constructor))}return h};r([o.type([h],u)],t.prototype,"types",void 0);r([o.type("number",u)],t.prototype,"rootType",void 0);return t}(s.Schema);t.Reflection=d},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.NoneSerializer=void 0;var i=function(){function e(){}e.prototype.setState=function(e){};e.prototype.getState=function(){return null};e.prototype.patch=function(e){};e.prototype.teardown=function(){};e.prototype.handshake=function(e){};return e}();t.NoneSerializer=i},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.showNotification=void 0;const i=new UICanvas,r=new UIText(i);r.fontSize=30;r.color=Color4.White();r.hAlign="center";r.vAlign="center";r.width="100%";r.height="100%";r.value="";r.visible=0;const o=(e,{error:t=0,info:n=0,warning:o=0}={})=>{i.visible=1;r.visible=1;void 0;r.value=e;r.width=120;r.height=30;setTimeout(()=>{r.visible=0;r.value=""},4e3)};t.showNotification=o},function(e,t,n){var i=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,o){function s(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i["throw"](e))}catch(e){o(e)}}function c(e){e.done?n(e.value):r(e.value).then(s,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:1});t.getLand=void 0;const r=()=>i(void 0,void 0,void 0,(function*(){var e,t,n;yield dcl.loadModule("ParcelIdentity");const i=yield dcl.callRpc("ParcelIdentity","getParcel",[]);void 0;return null===(n=null===(t=null===(e=null==i?void 0:i.land)||void 0===e?void 0:e.sceneJsonData)||void 0===t?void 0:t.scene)||void 0===n?void 0:n.base}));t.getLand=r},function(e,t,n){Object.defineProperty(t,"__esModule",{value:1});t.createLinks=void 0;const i=(e,t,{position:n})=>{const i=new Entity;i.addComponent(new Transform({position:n||new Vector3(0,.35,-.1)}));const r=new Entity;r.addComponent(new PlaneShape);const o=new Material;r.addComponent(o);r.addComponent(new Transform({scale:new Vector3(-2.5,-.5,1)}));const s=(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||"")+"images/links.png",a=(engine["RESOURCE_BASE"]||globalThis["RESOURCE_BASE"]||"")+"images/links_a.png",c=new Texture(s),u=new Texture(a);o.albedoTexture=c;o.alphaTexture=u;r.setParent(i);const l=new Entity;l.addComponent(new PlaneShape);l.addComponent(new Transform({position:new Vector3(-.68,0,-.1),scale:new Vector3(1.2,.6,1)}));const h=new Material;h.albedoColor=new Color4(0,0,0,0);l.addComponent(h);l.setParent(i);l.addComponent(new OnPointerDown(()=>{openExternalURL("https://twitter.com/Pablo_es")},{hoverText:"Follow Pablo on twitter"}));const d=new Entity;d.addComponent(new PlaneShape);d.addComponent(new Transform({position:new Vector3(.68,0,-.1),scale:new Vector3(1.2,.6,1)}));d.addComponent(h);d.setParent(i);d.addComponent(new OnPointerDown(()=>{openExternalURL("https://metazone.io/metas/sammichgame")},{hoverText:"Host this game in your land"}));p();return{show:p,hide:()=>{void 0;i.setParent(null);engine.removeEntity(i)}};function p(){void 0;i.setParent(t)}};t.createLinks=i}]));